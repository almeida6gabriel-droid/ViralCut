(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{8671:(e,t,s)=>{"use strict";s.d(t,{DashboardApp:()=>n});var r=s(5155),l=s(6874),a=s.n(l),i=s(2115);function o(e){switch(e){case"queued":return"Na fila";case"collecting":return"Coletando dados";case"analyzing":return"IA analisando viraliza\xe7\xe3o";case"rendering":return"Renderizando 9:16";case"completed":return"Conclu\xeddo";case"failed":return"Falhou";default:return e}}function d(e){let t=Math.max(0,Math.floor(e)),s=Math.floor(t/60);return"".concat(s,":").concat(String(t%60).padStart(2,"0"))}function n(e){var t,s,l,n,c;let{initialJobId:x}=e,[p,m]=(0,i.useState)([]),[u,h]=(0,i.useState)(x),[b,g]=(0,i.useState)(),[f,v]=(0,i.useState)(),[j,N]=(0,i.useState)(!0),[w,y]=(0,i.useState)(null),[S,k]=(0,i.useState)(null),[C,E]=(0,i.useState)(!1),[T,P]=(0,i.useState)({}),[F,O]=(0,i.useState)({}),_=(0,i.useCallback)(async()=>{try{let e=await fetch("/api/jobs",{cache:"no-store"});if(!e.ok)throw Error("Falha ao buscar hist\xf3rico de jobs.");let t=await e.json();m(t.jobs),h(e=>{var s;return e&&t.jobs.some(t=>t.id===e)?e:x&&t.jobs.some(e=>e.id===x)?x:null===(s=t.jobs[0])||void 0===s?void 0:s.id}),y(null)}catch(e){y(e instanceof Error?e.message:"Erro ao carregar dashboard.")}finally{N(!1)}},[x]);(0,i.useEffect)(()=>{_();let e=setInterval(()=>{_()},3e3);return()=>clearInterval(e)},[_]);let A=(0,i.useMemo)(()=>{var e;return null!==(e=p.find(e=>e.id===u))&&void 0!==e?e:p[0]},[p,u]);(0,i.useEffect)(()=>{if(A){if(h(A.id),!b||!A.clips.some(e=>e.id===b)){var e;g(null===(e=A.clips[0])||void 0===e?void 0:e.id)}O(e=>{let t={...e};for(let e of A.clips)t[e.id]||(t[e.id]={title:e.title,transcriptSnippet:e.transcriptSnippet});return t})}},[A,b]);let z=(0,i.useMemo)(()=>{var e;return null!==(e=null==A?void 0:A.clips.find(e=>e.id===b))&&void 0!==e?e:null==A?void 0:A.clips[0]},[A,b]);async function D(e){if(!A)return;let t=F[e];if(t){k(e);try{let r=await fetch("/api/jobs/".concat(A.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({clipId:e,title:t.title,transcriptSnippet:t.transcriptSnippet})});if(!r.ok){var s;let e=await r.json();throw Error(null!==(s=e.error)&&void 0!==s?s:"Falha ao salvar altera\xe7\xf5es.")}await _(),v(void 0)}catch(e){y(e instanceof Error?e.message:"Falha ao salvar corte.")}finally{k(null)}}}async function I(){if(A){E(!0),y(null);try{let t=await fetch("/api/jobs/".concat(A.id,"/regenerate"),{method:"POST"}),s=await t.json();if(!t.ok){var e;throw Error(null!==(e=s.error)&&void 0!==e?e:"Falha ao gerar mais cortes.")}await _()}catch(e){y(e instanceof Error?e.message:"N\xe3o foi poss\xedvel regenerar cortes.")}finally{E(!1)}}}async function M(e){k(e.id);try{let s=await fetch("/api/seo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceText:e.transcriptSnippet,contextTitle:e.title})}),r=await s.json();if(!s.ok){var t;throw Error(null!==(t=r.error)&&void 0!==t?t:"Falha ao gerar SEO.")}P(t=>({...t,[e.id]:{titles:r.titles,description:r.description,hashtags:r.hashtags}}))}catch(e){y(e instanceof Error?e.message:"Erro ao gerar t\xedtulos.")}finally{k(null)}}return(0,r.jsxs)("main",{className:"mx-auto flex min-h-screen w-full max-w-7xl flex-col gap-6 px-4 pb-12 pt-6 sm:px-6 lg:px-8",children:[(0,r.jsx)("header",{className:"glass grid-lights rounded-3xl p-5 md:p-6",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.22em] text-electric",children:"Dashboard"}),(0,r.jsx)("h1",{className:"mt-1 text-2xl font-semibold text-white md:text-3xl",children:"Painel de cortes virais"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-slate-300",children:"Acompanhe processamento, edite legendas e exporte cortes otimizados para Shorts, Reels e TikTok."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(a(),{href:"/",className:"rounded-xl border border-indigo-300/35 px-4 py-2 text-xs font-semibold text-slate-100 transition hover:border-electric",children:"Novo v\xeddeo"}),(0,r.jsx)("a",{href:"/api/auth/signin?callbackUrl=/dashboard",className:"rounded-xl border border-electric/35 bg-electric/10 px-4 py-2 text-xs font-semibold text-electric transition hover:bg-electric/20",children:"Login com Google"})]})]})}),(0,r.jsxs)("section",{className:"grid gap-5 lg:grid-cols-[320px_1fr]",children:[(0,r.jsxs)("aside",{className:"glass soft-scroll rounded-3xl p-4 lg:max-h-[calc(100vh-170px)] lg:overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-sm font-semibold text-slate-200",children:"Hist\xf3rico de v\xeddeos"}),(0,r.jsx)("span",{className:"rounded-full border border-indigo-300/30 px-2 py-1 text-xs text-slate-300",children:p.length})]}),j?(0,r.jsx)("p",{className:"mt-4 text-sm text-slate-400",children:"Carregando hist\xf3rico..."}):null,j||0!==p.length?null:(0,r.jsx)("p",{className:"mt-4 rounded-xl border border-dashed border-indigo-300/20 p-4 text-sm text-slate-300",children:"Nenhum v\xeddeo processado ainda. Volte para a landing e envie um link."}),(0,r.jsx)("div",{className:"mt-4 grid gap-3",children:p.map(e=>{var t,s,l;return(0,r.jsxs)("button",{type:"button",onClick:()=>h(e.id),className:"w-full rounded-2xl border p-3 text-left transition ".concat((null==A?void 0:A.id)===e.id?"border-electric bg-electric/10":"border-indigo-300/20 bg-slate/60 hover:border-indigo-300/45"),children:[(0,r.jsx)("p",{className:"line-clamp-2 text-xs font-semibold text-white",children:null!==(s=null===(t=e.video)||void 0===t?void 0:t.title)&&void 0!==s?s:e.input.youtubeUrl}),(0,r.jsxs)("div",{className:"mt-2 flex items-center justify-between text-[11px] text-slate-300",children:[(0,r.jsx)("span",{children:o(e.stage)}),(0,r.jsxs)("span",{children:[e.progress,"%"]})]}),(0,r.jsx)("p",{className:"mt-1 text-[10px] text-slate-400",children:(l=e.createdAt,new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(l)))})]},e.id)})})]}),(0,r.jsxs)("div",{className:"glass soft-scroll rounded-3xl p-4 md:p-5 lg:max-h-[calc(100vh-170px)] lg:overflow-y-auto",children:[w?(0,r.jsx)("div",{className:"mb-4 rounded-xl border border-red-400/30 bg-red-900/20 p-3 text-sm text-red-200",children:w}):null,A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("section",{className:"rounded-2xl border border-indigo-300/20 bg-slate/60 p-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-white",children:null!==(l=null===(t=A.video)||void 0===t?void 0:t.title)&&void 0!==l?l:"Processando v\xeddeo"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-slate-300",children:null!==(n=null===(s=A.video)||void 0===s?void 0:s.channelName)&&void 0!==n?n:"Canal"})]}),(0,r.jsx)("div",{className:"rounded-full border border-indigo-300/30 px-3 py-1 text-xs text-slate-100",children:o(A.stage)})]}),(0,r.jsx)("div",{className:"mt-4 h-2 overflow-hidden rounded-full bg-slate-800",children:(0,r.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-electric to-neon transition-all",style:{width:"".concat(A.progress,"%")}})}),(0,r.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:I,disabled:"completed"!==A.stage||C,className:"rounded-xl border border-electric/45 px-4 py-2 text-xs font-semibold text-electric transition hover:bg-electric/15 disabled:cursor-not-allowed disabled:opacity-50",children:C?"Gerando...":"Gerar mais cortes"}),(0,r.jsxs)("span",{className:"rounded-xl border border-indigo-300/30 px-4 py-2 text-xs text-slate-300",children:[A.clips.length," cortes gerados"]})]}),(0,r.jsx)("div",{className:"mt-4 grid gap-2",children:A.logs.slice(0,4).map(e=>(0,r.jsxs)("div",{className:"rounded-xl border border-indigo-300/15 bg-slate-900/40 px-3 py-2 text-xs text-slate-300",children:[(0,r.jsx)("span",{className:"font-semibold text-electric",children:o(e.stage)})," ",e.message]},"".concat(e.at,"-").concat(e.message)))})]}),A.clips.length>0?(0,r.jsxs)("section",{className:"mt-5 grid gap-4 xl:grid-cols-[360px_1fr]",children:[(0,r.jsxs)("article",{className:"rounded-2xl border border-indigo-300/20 bg-slate/60 p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-slate-100",children:"Preview estilo TikTok"}),z?(0,r.jsx)("div",{className:"mt-4 flex justify-center",children:(0,r.jsxs)("div",{className:"relative aspect-[9/16] w-64 overflow-hidden rounded-[2.4rem] border border-indigo-300/30 bg-black p-2 shadow-glow",children:[(0,r.jsx)("video",{src:z.previewUrl,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"h-full w-full rounded-[2rem] object-cover"},z.id),(0,r.jsx)("div",{className:"pointer-events-none absolute inset-x-3 bottom-4 rounded-xl bg-black/45 p-2 text-[11px] font-semibold leading-snug text-white",children:z.subtitles.slice(0,10).map(e=>"".concat(e.text).concat(e.emoji?" ".concat(e.emoji):"")).join(" ")}),(0,r.jsx)("div",{className:"absolute left-3 right-3 top-4 rounded-lg bg-black/45 px-2 py-1 text-center text-[10px] font-semibold text-white",children:z.title})]})}):(0,r.jsx)("p",{className:"mt-4 text-xs text-slate-300",children:"Selecione um corte para visualizar."})]}),(0,r.jsxs)("article",{className:"rounded-2xl border border-indigo-300/20 bg-slate/60 p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-slate-100",children:"Cortes gerados"}),(0,r.jsx)("div",{className:"mt-3 grid gap-3",children:A.clips.map(e=>{var t;let s=null!==(t=F[e.id])&&void 0!==t?t:{title:e.title,transcriptSnippet:e.transcriptSnippet},l=T[e.id];return(0,r.jsxs)("div",{className:"rounded-2xl border p-3 ".concat((null==z?void 0:z.id)===e.id?"border-electric bg-electric/10":"border-indigo-300/20 bg-slate-900/35"),children:[(0,r.jsxs)("button",{type:"button",onClick:()=>g(e.id),className:"w-full text-left",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:e.title}),(0,r.jsxs)("span",{className:"rounded-full border border-indigo-300/35 px-2 py-1 text-[11px] text-slate-200",children:["Score ",e.score]})]}),(0,r.jsxs)("p",{className:"mt-1 text-xs text-slate-300",children:[d(e.startSec)," - ",d(e.endSec)," | ",e.durationSec,"s"]})]}),(0,r.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,r.jsx)("a",{href:e.downloadUrl,download:!0,className:"rounded-lg border border-indigo-300/35 px-3 py-1.5 text-xs font-semibold text-slate-100 transition hover:border-electric",children:"Download"}),(0,r.jsx)("button",{type:"button",onClick:()=>v(f===e.id?void 0:e.id),className:"rounded-lg border border-indigo-300/35 px-3 py-1.5 text-xs font-semibold text-slate-100 transition hover:border-electric",children:"Editar corte"}),(0,r.jsx)("button",{type:"button",onClick:()=>M(e),disabled:S===e.id,className:"rounded-lg border border-electric/45 px-3 py-1.5 text-xs font-semibold text-electric transition hover:bg-electric/15 disabled:opacity-55",children:"Gerar t\xedtulos virais"})]}),f===e.id?(0,r.jsxs)("div",{className:"mt-3 grid gap-2 rounded-xl border border-indigo-300/20 bg-slate-950/40 p-3",children:[(0,r.jsx)("input",{value:s.title,onChange:t=>O(r=>({...r,[e.id]:{...s,title:t.target.value}})),className:"rounded-lg border border-indigo-300/30 bg-slate/70 px-3 py-2 text-xs text-white outline-none focus:border-electric"}),(0,r.jsx)("textarea",{value:s.transcriptSnippet,onChange:t=>O(r=>({...r,[e.id]:{...s,transcriptSnippet:t.target.value}})),rows:3,className:"rounded-lg border border-indigo-300/30 bg-slate/70 px-3 py-2 text-xs text-white outline-none focus:border-electric"}),(0,r.jsx)("button",{type:"button",onClick:()=>D(e.id),disabled:S===e.id,className:"rounded-lg bg-gradient-to-r from-electric to-neon px-3 py-2 text-xs font-semibold text-slate-950 disabled:opacity-60",children:S===e.id?"Salvando...":"Salvar edi\xe7\xe3o"})]}):null,l?(0,r.jsxs)("div",{className:"mt-3 rounded-xl border border-electric/25 bg-electric/10 p-3 text-xs text-slate-100",children:[(0,r.jsx)("p",{className:"font-semibold text-electric",children:"T\xedtulos sugeridos"}),(0,r.jsx)("div",{className:"mt-1 grid gap-1",children:l.titles.slice(0,3).map(e=>(0,r.jsxs)("p",{children:["â€¢ ",e]},e))}),(0,r.jsx)("p",{className:"mt-2 font-semibold text-electric",children:"Descri\xe7\xe3o + hashtags"}),(0,r.jsx)("p",{className:"mt-1 whitespace-pre-wrap text-slate-200",children:l.description})]}):null]},e.id)})})]})]}):(0,r.jsx)("section",{className:"mt-5 rounded-2xl border border-dashed border-indigo-300/20 bg-slate/45 p-5 text-sm text-slate-300",children:"failed"===A.stage?null!==(c=A.error)&&void 0!==c?c:"Processamento falhou.":"A IA ainda est\xe1 processando este v\xeddeo. Os cortes aparecer\xe3o aqui automaticamente."})]}):(0,r.jsx)("div",{className:"rounded-2xl border border-indigo-300/20 bg-slate/50 p-6 text-sm text-slate-300",children:"Selecione um job para visualizar os cortes."})]})]})]})}},8896:(e,t,s)=>{Promise.resolve().then(s.bind(s,8671))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(8896)),_N_E=e.O()}]);