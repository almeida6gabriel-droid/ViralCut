exports.id=469,exports.ids=[469],exports.modules={2473:(e,t,r)=>{"use strict";r.d(t,{jh:()=>K,JG:()=>eo,ax:()=>ee,N6:()=>Q,r4:()=>er,rY:()=>et});var o=r(7598),a=r(3024),i=r(1421),n=r(6760),s=r.n(n),l=r(7975),c=r(5950),d=r.n(c);let u=null;function p(){if(u)return u;let e="win32"===process.platform?"ffmpeg.exe":"ffmpeg";for(let t of[process.env.FFMPEG_BIN?.trim()||"",d()||"",s().join(process.cwd(),"node_modules","ffmpeg-static",e),"ffmpeg"])if(t&&function(e){if(!e)return!1;if(e.includes(s().sep))return(0,a.existsSync)(e);try{return(0,i.execFileSync)(e,["-version"],{stdio:"ignore"}),!0}catch{return!1}}(t))return u=t,t;throw Error("FFmpeg n\xe3o encontrado. Configure FFMPEG_BIN ou instale ffmpeg no sistema para habilitar cortes reais.")}let m=new Set([".mp4",".mov",".mkv",".webm",".m4v"]),g=s().join(process.cwd(),"storage","jobs");function h(e){let t=s().join(g,e);return{jobDir:t,clipsDir:s().join(t,"clips"),workDir:s().join(t,"work"),sourceTemplate:s().join(t,"source.%(ext)s"),sourcePrefix:s().join(t,"source")}}async function f(e){let t=h(e);return await a.promises.mkdir(t.clipsDir,{recursive:!0}),await a.promises.mkdir(t.workDir,{recursive:!0}),t}async function v(e){let t=h(e),r=[];try{r=await a.promises.readdir(t.jobDir)}catch{return null}let o=r.filter(e=>e.startsWith("source.")).find(e=>m.has(s().extname(e).toLowerCase()));return o?s().join(t.jobDir,o):null}function y(e,t){let{clipsDir:r}=h(e);return s().join(r,`${t}.mp4`)}let x=(0,l.promisify)(i.execFile);function b(e){let t=Math.max(0,Math.floor(e)),r=String(Math.floor(t/3600)).padStart(2,"0"),o=String(Math.floor(t%3600/60)).padStart(2,"0"),a=String(t%60).padStart(2,"0");return`${r}:${o}:${a}`}function S(e){let t=Math.max(0,e),r=Math.floor(t/3600),o=Math.floor(t%3600/60),a=Math.floor(t%60),i=Math.floor((t-Math.floor(t))*100);return`${r}:${String(o).padStart(2,"0")}:${String(a).padStart(2,"0")}.${String(i).padStart(2,"0")}`}function w(e){return e.replace(/\\/g,"\\\\").replace(/{/g,"\\{").replace(/}/g,"\\}").replace(/\n/g,"\\N")}async function $(e){let{clip:t,subtitlePath:r}=e,o=t.subtitles.filter(e=>e.time>=t.startSec&&e.time<=t.endSec+.8).sort((e,t)=>e.time-t.time),i=[];if(0===o.length){let e=t.hookLine||t.title;i.push(`Dialogue: 0,${S(0)},${S(Math.max(1.8,t.durationSec-.2))},Caption,,0,0,80,,{\\b1}${w(e)}`)}else for(let e=0;e<o.length;e+=4){let r=o.slice(e,e+4),a=o[e+4],n=Math.max(0,r[0].time-t.startSec),s=r[r.length-1].time-t.startSec+.9,l=Math.min(t.durationSec,Math.max(n+.45,a?a.time-t.startSec:s)),c=r.map(e=>e.highlight?`{\\c&H66FFFF&}${e.text}{\\c&HFFFFFF&}`:e.text).join(" ");i.push(`Dialogue: 0,${S(n)},${S(l)},Caption,,0,0,80,,{\\b1}${w(c)}`)}let n=`[Script Info]
Title: ViralCut Caption
ScriptType: v4.00+
WrapStyle: 2
ScaledBorderAndShadow: yes
YCbCr Matrix: TV.709

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Caption,Arial,72,&H00FFFFFF,&H0000FFFF,&H00000000,&H40000000,-1,0,0,0,100,100,0,0,1,3,0,2,80,80,110,1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
${i.join("\n")}
`;await a.promises.writeFile(r,n,"utf8")}async function M(e){let{sourceVideoPath:t,clip:r,subtitleFileName:o,outputPath:a,workDir:i}=e,n=p(),s=`scale=1080:1920:force_original_aspect_ratio=increase,crop=1080:1920,ass=${o}`;await x(n,["-y","-ss",r.startSec.toFixed(3),"-to",r.endSec.toFixed(3),"-i",t,"-vf",s,"-c:v","libx264","-preset","veryfast","-crf","22","-c:a","aac","-b:a","128k","-movflags","+faststart",a],{cwd:i,maxBuffer:0x1000000})}async function F(e){let{jobId:t,video:r,sourceVideoPath:o,clips:a,log:i}=e;await f(t);let{workDir:n}=h(t),l=[];for(let e of a){let r=y(t,e.id),a=function(e,t){let{workDir:r}=h(e);return s().join(r,`${t}.ass`)}(t,e.id),c=s().basename(a);i?.(`Renderizando corte ${e.id} (${e.durationSec}s)`),await $({clip:e,subtitlePath:a}),await M({sourceVideoPath:o,clip:e,subtitleFileName:c,outputPath:r,workDir:n});let d=function(e){let{sourceVideoPath:t,subtitlePath:r,outputPath:o,clip:a}=e,i=`scale=1080:1920:force_original_aspect_ratio=increase,crop=1080:1920,ass=${r}`;return[`ffmpeg -y -ss ${b(a.startSec)} -to ${b(a.endSec)} -i ${t} -vf "${i}" -c:v libx264 -preset veryfast -crf 22 -c:a aac -movflags +faststart ${o}`]}({sourceVideoPath:o,subtitlePath:a,outputPath:r,clip:e});l.push({...e,ffmpegPlan:d,previewUrl:`/api/jobs/${t}/clips/${e.id}/stream`,downloadUrl:`/api/jobs/${t}/clips/${e.id}/download`})}return i?.(`Renderiza\xe7\xe3o finalizada: ${l.length} cortes reais`),l}let k=(0,l.promisify)(i.execFile),j=[{tag:"hook",regex:/agora|urgente|olha|aten[Ã§c][aÃ£]o|n[Ã£a]o acredita|chocante/i},{tag:"curiosidade",regex:/como|por que|segredo|detalhe|curiosidade|descobri/i},{tag:"pol[e\xea]mica",regex:/pol[eÃª]mica|discordo|absurdo|treta|discuss[aÃ£]o/i},{tag:"humor",regex:/risos|engra[Ã§c]ado|meme|zoeira|kkk|haha/i},{tag:"storytelling",regex:/aconteceu|quando|depois|hist[oÃ³]ria|ent[aÃ£]o/i},{tag:"valor",regex:/dica|estrat[eÃ©]gia|resultado|li[Ã§c][aÃ£]o|aprendi/i}],E=new Set(["para","com","sem","sobre","porque","quando","onde","depois","antes","entre","muito","pouco","essa","esse","isso","como","mais","menos","ainda","tambem","voces","voc\xea","voce","aqui","ali","seu","sua","das","dos","uma","uns","umas","que","pra"]);function C(e){let t=e.trim().replace(",","."),r=t.split(":").map(Number);if(3===r.length){let[e,t,o]=r;return 3600*e+60*t+o}if(2===r.length){let[e,t]=r;return 60*e+t}return Number(t)||0}function T(e,t){let r=j.filter(t=>t.regex.test(e)).map(e=>e.tag);return t>=.75&&!r.includes("hook")&&r.push("hook"),t<=.2&&!r.includes("storytelling")&&r.push("storytelling"),0===r.length&&r.push("valor"),r}function I(e,t){return Math.max(.1,Math.min(1,.7*t+.06*(e.match(/[!?]/g)??[]).length+.1*!!/[A-ZÃÃ‰ÃÃ“ÃšÃ‡]{4,}/.test(e)+.16))}async function _(e){let{sourceVideoPath:t,audioPcmPath:r,durationSec:o}=e,i=p();await k(i,["-y","-i",t,"-vn","-ac","1","-ar","16000","-f","s16le",r]);let n=await a.promises.readFile(r);if(n.length<2)return[{startSec:0,endSec:Math.max(1,o),energy:.45}];let s=Math.floor(n.length/2),l=[],c=0;for(let e=0;e<s;e+=16e3){let t=Math.min(s,e+16e3),r=t-e;if(r<=0)continue;let o=0;for(let r=e;r<t;r+=1){let e=n.readInt16LE(2*r)/32768;o+=e*e}let a=Math.sqrt(o/r);a>c&&(c=a),l.push({startSec:e/16e3,endSec:t/16e3,energy:a})}let d=c>0?c:1;return l.map(e=>({...e,energy:Math.max(.01,Math.min(1,e.energy/d))}))}function q(e,t,r){let o=e.filter(e=>e.startSec<r&&e.endSec>t);if(0===o.length){let r=e.find(e=>e.startSec<=t&&e.endSec>=t);return r?.energy??.45}return o.reduce((e,t)=>e+t.energy,0)/o.length}function L(e){let{video:t,buckets:r,keywords:o}=e,a=[];for(let e=0;e<t.durationSec;e+=8){let i=Math.min(t.durationSec,e+8),n=q(r,e,i),s=o[a.length%Math.max(1,o.length)]||"momento",l=n>=.7?`Pico de energia com foco em ${s}. Rea\xe7\xe3o forte da audi\xeancia nesse trecho.`:n<=.25?`Pausa dram\xe1tica e constru\xe7\xe3o de contexto sobre ${s}.`:`Trecho com narrativa cont\xednua sobre ${s}, bom para reten\xe7\xe3o.`;a.push({id:`${t.videoId}-energy-${a.length+1}`,startSec:e,endSec:i,text:l,energy:n,emotion:I(l,n),tags:T(l,n)})}return a}async function P(e){let{jobId:t,video:r,sourceVideoPath:o,subtitleVttPath:i,keywordHints:n,descriptionHint:l,log:c}=e;c?.("Extraindo energia de \xe1udio para detectar picos e pausas dram\xe1ticas");let d=await _({sourceVideoPath:o,audioPcmPath:function(e){let{workDir:t}=h(e);return s().join(t,"audio-16k-mono.pcm")}(t),durationSec:r.durationSec}),u=function(e,t,r){let o=[e.title,...t,r].join(" "),a=new Map;for(let e of o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(/[^a-z0-9]+/).filter(e=>e.length>=4&&!E.has(e)))a.set(e,(a.get(e)??0)+1);return[...a.entries()].sort((e,t)=>t[1]-e[1]).slice(0,8).map(([e])=>e)}(r,n,l);if(!i)return c?.("Legendas autom\xe1ticas n\xe3o dispon\xedveis; usando transcri\xe7\xe3o temporal por energia"),L({video:r,buckets:d,keywords:u});let p="";try{p=await a.promises.readFile(i,"utf8")}catch{return c?.("Falha ao ler arquivo de legenda VTT; aplicando fallback por energia"),L({video:r,buckets:d,keywords:u})}let m=function(e){let t=e.replace(/^\uFEFF/,"").split(/\r?\n/),r=[],o=0;for(;o<t.length;){let e=t[o].trim();if(!e.includes("--\x3e")){o+=1;continue}let[a,i]=e.split("--\x3e"),n=i.trim().split(/\s+/)[0],s=C(a),l=C(n);o+=1;let c=[];for(;o<t.length&&""!==t[o].trim();)c.push(t[o]),o+=1;let d=c.join(" ").replace(/<\d{2}:\d{2}:\d{2}\.\d{3}>/g,"").replace(/<\d{2}:\d{2}\.\d{3}>/g,"").replace(/<[^>]+>/g,"").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\s+/g," ").trim();for(d&&l>s&&r.push({startSec:s,endSec:l,text:d});o<t.length&&""===t[o].trim();)o+=1}return r}(p);if(m.length<5)return c?.("Legenda autom\xe1tica insuficiente; aplicando fallback por energia"),L({video:r,buckets:d,keywords:u});let g=m.map((e,t)=>{let o=q(d,e.startSec,e.endSec),a=e.text;return{id:`${r.videoId}-${t+1}`,startSec:e.startSec,endSec:e.endSec,text:a,energy:o,emotion:I(a,o),tags:T(a,o)}});return c?.(`Transcri\xe7\xe3o pronta com ${g.length} segmentos`),g}var D=r(5326),N=r(9939);let A=(0,l.promisify)(i.execFile),R=["-W","ignore","-m","yt_dlp"],B=["--extractor-args","youtube:player_client=android"];async function z(e,t){try{let r=await A("python3",[...R,...B,...e],{cwd:t,maxBuffer:0x2000000});return{stdout:r.stdout,stderr:r.stderr}}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido no yt-dlp.";throw Error(`yt-dlp falhou: ${e}`)}}async function U(e,t){let{jobDir:r}=h(t),{stdout:o}=await z(["--dump-single-json","--skip-download","--no-playlist","--no-warnings",e],r);return function(e){let t=e.indexOf("{");if(t<0)throw Error("N\xe3o foi poss\xedvel ler os metadados retornados pelo yt-dlp.");try{return JSON.parse(e.slice(t))}catch{throw Error("Falha ao interpretar metadados JSON do yt-dlp.")}}(o)}async function V(e){let{jobId:t,url:r,videoId:o,log:a}=e,i=h(t);a?.(`Iniciando download do v\xeddeo ${o} com yt-dlp`);let n=await U(r,t),l=["--no-playlist","--no-warnings","--newline","-f","18/best[ext=mp4]/best","--output",i.sourceTemplate,"--print","after_move:filepath",r],{stdout:c}=await z(l,i.jobDir),d=c.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).find(e=>e.includes(`${s().sep}source.`))??null;if(d||(d=await v(t)),!d)throw Error("O v\xeddeo foi solicitado ao yt-dlp, mas nenhum arquivo local foi encontrado.");a?.(`Download conclu\xeddo em ${d}`);let u=Number(n.duration??0),p=n.title?.trim()||`V\xeddeo ${o}`,m=n.uploader?.trim()||"Canal YouTube",g=n.thumbnail||`https://i.ytimg.com/vi/${o}/hqdefault.jpg`,f=n.webpage_url||`https://www.youtube.com/watch?v=${o}`;if(!Number.isFinite(u)||u<5)throw Error("N\xe3o foi poss\xedvel identificar a dura\xe7\xe3o do v\xeddeo para gerar cortes.");return{sourceVideoPath:d,video:{videoId:o,canonicalUrl:f,title:p,channelName:m,durationSec:u,thumbnailUrl:g},keywords:Array.isArray(n.tags)?n.tags.slice(0,20):[],description:n.description?.slice(0,2e3)||""}}async function O(e){let{jobId:t,url:o,log:a}=e,i=h(t),n=["--skip-download","--no-warnings","--ignore-errors","--no-playlist","--write-auto-subs","--sub-langs","pt.*,en.*,es.*","--sub-format","vtt","--output",i.sourceTemplate,o];try{await z(n,i.jobDir)}catch(t){let e=t instanceof Error?t.message:"Falha desconhecida ao baixar legenda.";return a?.(`Legendas autom\xe1ticas indispon\xedveis no momento (${e}). Seguindo com fallback por energia.`),null}let{readdir:l}=await Promise.resolve().then(r.t.bind(r,1455,23)),c=(await l(i.jobDir)).filter(e=>e.startsWith("source.")&&e.endsWith(".vtt")).sort((e,t)=>{let r=e=>e.includes(".pt")?0:e.includes(".en")?1:2;return r(e)-r(t)});if(0===c.length)return a?.("Nenhuma legenda autom\xe1tica dispon\xedvel no YouTube para este v\xeddeo"),null;let d=s().join(i.jobDir,c[0]);return a?.(`Legenda autom\xe1tica encontrada: ${c[0]}`),d}function H(){return globalThis.__viralCutRuntime||(globalThis.__viralCutRuntime={jobs:new Map,queue:[],active:new Set,concurrency:2,pumpScheduled:!1}),globalThis.__viralCutRuntime}function G(){return new Date().toISOString()}function Y(e,t,r){let o=G();e.logs.unshift({at:o,stage:t,message:r}),e.updatedAt=o,console.info(`[job:${e.id}] [${t}] ${r}`)}function J(e,t,r,o){e.stage=t,e.progress=r,Y(e,t,o)}function W(){let e=H();e.pumpScheduled||(e.pumpScheduled=!0,setTimeout(()=>{e.pumpScheduled=!1,Z()},0))}async function Z(){let e=H();for(;e.active.size<e.concurrency&&e.queue.length>0;){let t=e.queue.shift();if(!t)break;e.active.add(t.jobId),X(t.jobId).catch(()=>{}).finally(()=>{e.active.delete(t.jobId),W()})}}async function X(e){let t=H().jobs.get(e);if(!t)return;let r=e=>Y(t,t.stage,e);try{J(t,"collecting",6,`URL recebida: ${t.input.youtubeUrl}`);let o=(0,N.c)(t.input.youtubeUrl);if(!o)throw Error("Link de YouTube inv\xe1lido. Envie uma URL p\xfablica v\xe1lida.");o.videoId!==t.input.videoId&&Y(t,"collecting",`videoId divergente detectado (input=${t.input.videoId}, parsed=${o.videoId})`),J(t,"collecting",10,`videoId extra\xeddo: ${o.videoId}`),await f(e),J(t,"collecting",16,"Iniciando download do v\xeddeo original");let a=await V({jobId:e,url:o.canonicalUrl,videoId:o.videoId,log:r});t.video=a.video,J(t,"collecting",44,"Download conclu\xeddo. Verificando legendas autom\xe1ticas do v\xeddeo");let i=await O({jobId:e,url:o.canonicalUrl,log:r});if(J(t,"collecting",58,"Extraindo sinais de \xe1udio e gerando transcri\xe7\xe3o temporal"),t.transcript=await P({jobId:e,video:a.video,sourceVideoPath:a.sourceVideoPath,subtitleVttPath:i,keywordHints:a.keywords,descriptionHint:a.description,log:r}),0===t.transcript.length)throw Error("N\xe3o foi poss\xedvel gerar segmentos de transcri\xe7\xe3o para este v\xeddeo.");J(t,"analyzing",74,"IA detectando momentos virais e calculando score");let n=(0,D.l)({videoTitle:a.video.title,segments:t.transcript,durationSec:a.video.durationSec,requestedCuts:6});if(0===n.length)throw Error("A IA n\xe3o conseguiu sugerir cortes para este v\xeddeo.");J(t,"rendering",84,`Gerando ${n.length} cortes reais em formato 9:16`),t.clips=await F({jobId:e,video:a.video,sourceVideoPath:a.sourceVideoPath,clips:n,log:r}),J(t,"completed",100,"Cortes gerados com sucesso a partir do v\xeddeo enviado")}catch(r){let e=r instanceof Error?r.message:"Falha inesperada no pipeline.";t.error=e,J(t,"failed",t.progress||0,`Processamento interrompido: ${e}`)}}function K(e,t){let r=H(),a=G(),i=(0,o.randomUUID)(),n={id:i,createdAt:a,updatedAt:a,input:{youtubeUrl:e,videoId:t},stage:"queued",progress:2,logs:[{at:a,stage:"queued",message:`Job criado para ${e}`}],transcript:[],clips:[]};return r.jobs.set(i,n),r.queue.push({type:"initial",jobId:i}),W(),n}function Q(){return Array.from(H().jobs.values()).sort((e,t)=>t.createdAt.localeCompare(e.createdAt))}function ee(e){return H().jobs.get(e)}function et(e,t,r){let o=ee(e);if(!o)return null;let a=o.clips.findIndex(e=>e.id===t);if(a<0)return null;let i=o.clips[a],n={...i,title:r.title??i.title,transcriptSnippet:r.transcriptSnippet??i.transcriptSnippet};return o.clips[a]=n,Y(o,o.stage,`Corte ${t} atualizado no editor.`),n}async function er(e){let t=ee(e);if(!t)throw Error("Job n\xe3o encontrado.");if(!t.video||0===t.transcript.length)throw Error("Este job ainda n\xe3o possui transcri\xe7\xe3o para regenerar cortes.");if(t.clips.length>=10)throw Error("Limite m\xe1ximo de 10 cortes j\xe1 atingido.");let r=await v(e);if(!r)throw Error("Arquivo fonte do v\xeddeo n\xe3o encontrado para gerar novos cortes.");J(t,"analyzing",64,"Gerando novas sugest\xf5es virais");let o=Math.min(10,Math.max(t.clips.length+3,6)),a=(0,D.l)({videoTitle:t.video.title,segments:t.transcript,durationSec:t.video.durationSec,requestedCuts:o}),i=new Set(t.clips.map(e=>Math.round(e.startSec))),n=a.filter(e=>!i.has(Math.round(e.startSec))).slice(0,10-t.clips.length).map((e,r)=>({...e,id:`${e.id}-extra-${t.clips.length+r+1}`}));if(0===n.length)throw Error("N\xe3o h\xe1 novos cortes relevantes para adicionar neste v\xeddeo.");J(t,"rendering",86,"Renderizando novos cortes reais");let s=await F({jobId:e,video:t.video,sourceVideoPath:r,clips:n,log:e=>Y(t,"rendering",e)});return t.clips=[...t.clips,...s].slice(0,10),J(t,"completed",100,"Novos cortes adicionados com sucesso"),t}function eo(e,t){let r=ee(e);if(!r?.video)return null;let o=r.clips.find(e=>e.id===t);if(!o)return null;let i=y(e,t);return(0,a.existsSync)(i)?{filePath:i,filename:`${r.video.videoId}-${o.id}.mp4`,contentType:"video/mp4"}:null}},5326:(e,t,r)=>{"use strict";r.d(t,{e:()=>f,l:()=>h});let o=["agora","ninguem","virada","erro","absurdo","detalhe","chocante"],a=["como","por que","segredo","quase","detalhe","numero","curiosidade"],i=["pol","controvers","discorda","treta","debate","absurdo"],n=["meme","engracado","rir","zoeira","risos","haha"],s=["historia","aconteceu","virada","quando","entao","depois"],l=["estrategia","reten","resultado","explicacao","aplicar","dica","aprendi"],c=["viral","reten","gancho","meme","controversa","detalhe","resultado","agora","chocante","absurdo"],d=["\uD83D\uDD25","\uD83D\uDE2E","\uD83D\uDC40","âš¡","\uD83D\uDCA5","\uD83C\uDFAF","\uD83E\uDD2F"],u={hook:["#HookPerfeito","#RetencaoAlta","#AberturaForte"],curiosity:["#Curiosidade","#VejaIsso","#NaoPule"],controversy:["#OpiniaoForte","#Debate","#Pol\xeamica"],humor:["#Humor","#Meme","#CorteEngracado"],storytelling:["#Storytelling","#PlotTwist","#HistoriaReal"],value:["#DicaRapida","#CriadorDeConteudo","#MarketingDigital"]};function p(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function m(e,t){return t.reduce((t,r)=>t+ +!!e.includes(r),0)}function g(e,t){return e.split(/\s+/).filter(Boolean).slice(0,18).map((e,r)=>({time:Number((t+.45*r).toFixed(2)),text:e,highlight:r%4==0,emoji:r%6==0?d[r%d.length]:void 0}))}function h(e){let{videoTitle:t,segments:r,durationSec:h}=e,f=Math.min(10,Math.max(3,e.requestedCuts??5)),v=r.map(e=>(function(e,t){let r=p(e.text),c=e.startSec<30,d=1-e.startSec/Math.max(t,1),u={hook:Math.min(100,20*m(r,o)+20*!!c+20*e.energy),curiosity:Math.min(100,20*m(r,a)+12),controversy:Math.min(100,34*m(r,i)),humor:Math.min(100,36*m(r,n)),storytelling:Math.min(100,16*m(r,s)+8),value:Math.min(100,20*m(r,l)+10),emotion:Math.round(100*e.emotion)},g=Math.round(Math.min(100,.21*u.hook+.17*u.curiosity+.14*u.controversy+.14*u.humor+.12*u.storytelling+.1*u.value+.07*u.emotion+5*e.energy+7*d));return{segment:e,score:g,signals:u}})(e,h));v.sort((e,t)=>t.score-e.score);let y=[];for(let e of v){var x,b;if(y.length>=f)break;let o=Math.max(30,Math.min(75,30+Math.round(.32*e.score))),a=Math.max(0,e.segment.startSec-5),i=Math.min(h,a+o),n=Math.round(i-a);if(n<30||y.some(e=>{var t;return t=e.startSec,Math.max(0,Math.min(i,e.endSec)-Math.max(a,t))>14}))continue;let s=r.filter(e=>e.startSec<i&&e.endSec>a),l=s.slice(0,4).map(e=>e.text).join(" ").slice(0,420).trim(),m=function(e){let t=[["hook",e.hook],["curiosity",e.curiosity],["controversy",e.controversy],["humor",e.humor],["storytelling",e.storytelling],["value",e.value]];return t.sort((e,t)=>t[1]-e[1]),t[0][0]}(e.signals),v=(x=m,b=e.segment.tags,Array.from(new Set([...u[x],"#TikTokBrasil","#YouTubeShorts","#CortesVirais",...b.map(e=>`#${e.replace(/[^a-z0-9]/gi,"")}`).slice(0,2)]))),S=function(e,t,r){let o=t.replace(/\.$/,""),a={hook:[`Gancho forte para segurar audi\xeancia (${r+1})`,`Abertura com alto potencial de reten\xe7\xe3o`],curiosity:[`Trecho que gera curiosidade instant\xe2nea`,`Esse detalhe prende at\xe9 o final`],controversy:[`Momento pol\xeamico para aumentar coment\xe1rios`,`Trecho que divide opini\xf5es e gera debate`],humor:["Corte com humor e replay alto",`Timing engra\xe7ado para Shorts e Reels`],storytelling:["Virada de narrativa em menos de 1 minuto",`Storytelling com ritmo de reten\xe7\xe3o`],value:[`Dica r\xe1pida com valor imediato`,`Explica\xe7\xe3o pr\xe1tica com potencial viral`]},i=o.length>45?`${o.slice(0,45)}...`:o;return a[e][r%a[e].length]||i}(m,e.segment.text,y.length),w=s.length>0?function(e){let t=[];for(let r of e){let e=r.text.split(/\s+/).filter(Boolean).slice(0,20);if(0===e.length)continue;let o=Math.max(.7,r.endSec-r.startSec)/e.length;for(let a=0;a<e.length;a+=1){let i=e[a].replace(/[.,!?]/g,"");if(!i)continue;let n=p(i),s=c.some(e=>n.includes(e)),l=s&&(t.length+a)%5==0?d[(t.length+a)%d.length]:void 0;t.push({time:Number((r.startSec+o*a).toFixed(2)),text:i,highlight:s,emoji:l})}}return t.slice(0,90)}(s):g(e.segment.text,a);y.push({id:`clip-${y.length+1}-${e.segment.id.slice(-8)}`,title:S,score:e.score,angle:m,startSec:a,endSec:i,durationSec:n,hookLine:e.segment.text,transcriptSnippet:l||e.segment.text,hashtags:v,suggestedDescription:`Recorte de ${t} com foco em ${m}. Corte otimizado para reten\xe7\xe3o e compartilhamento r\xe1pido.`,subtitles:w,ffmpegPlan:[],previewUrl:"",downloadUrl:"",render:{aspectRatio:"9:16",zoomMode:"face-smart",cameraStyle:"dynamic-cut",captionsStyle:"reels-bold",headline:S,showProgressBar:!0},signals:e.signals})}if(0===y.length){let e=Math.min(h,35);y.push({id:"clip-1-fallback",title:"Trecho inicial com potencial de reten\xe7\xe3o",score:45,angle:"hook",startSec:0,endSec:e,durationSec:Math.round(e-0),hookLine:r[0]?.text??"In\xedcio do v\xeddeo",transcriptSnippet:r.slice(0,4).map(e=>e.text).join(" "),hashtags:["#CortesVirais","#Shorts","#TikTokBrasil"],suggestedDescription:"Trecho inicial otimizado para reten\xe7\xe3o.",subtitles:g(r[0]?.text??"Trecho inicial",0),ffmpegPlan:[],previewUrl:"",downloadUrl:"",render:{aspectRatio:"9:16",zoomMode:"face-smart",cameraStyle:"dynamic-cut",captionsStyle:"reels-bold",headline:"Corte sugerido",showProgressBar:!0},signals:{hook:55,curiosity:35,controversy:10,humor:10,storytelling:30,value:35,emotion:40}})}return y.slice(0,f)}function f(e,t){let r=e.trim().slice(0,240),o=t?.trim()||"corte viral";return{titles:[`${o}: o trecho que prendeu geral`,`Esse momento de ${o.toLowerCase()} est\xe1 absurdo`,`Poucos segundos de ${o.toLowerCase()} que geram replay`,`O melhor corte de ${o.toLowerCase()} para Shorts`,`Se liga nesse recorte de ${o.toLowerCase()}!`],description:`ðŸŽ¬ ${r}

Esse corte foi otimizado para reten\xe7\xe3o, impacto e compartilhamento.

#CortesVirais #YouTubeShorts #TikTokBrasil #ReelsBrasil #CreatorEconomy`,hashtags:["#CortesVirais","#YouTubeShorts","#TikTokBrasil","#ReelsBrasil","#ConteudoDigital"]}}},5950:(e,t,r)=>{"use strict";let o=r(8465),{"binary-path-env-var":a,"executable-base-name":i}=o[o.name];if("string"!=typeof a)throw Error(`package.json: invalid/missing ${o.name}.binary-path-env-var entry`);if("string"!=typeof i)throw Error(`package.json: invalid/missing ${o.name}.executable-base-name entry`);if(process.env[a])e.exports=process.env[a];else{var n=r(1820),s=r(3873),l=Object.assign(Object.create(null),{darwin:["x64","arm64"],freebsd:["x64"],linux:["x64","ia32","arm64","arm"],win32:["x64","ia32"]}),c=process.env.npm_config_platform||n.platform(),d=process.env.npm_config_arch||n.arch();let t=s.join(__dirname,i+("win32"===c?".exe":""));l[c]&&-1!==l[c].indexOf(d)||(t=null),e.exports=t}},6487:()=>{},8335:()=>{},8465:e=>{"use strict";e.exports=JSON.parse('{"name":"ffmpeg-static","version":"5.3.0","description":"ffmpeg binaries for macOS, Linux and Windows","scripts":{"install":"node install.js","prepublishOnly":"npm run install"},"ffmpeg-static":{"binary-path-env-var":"FFMPEG_BIN","binary-release-tag-env-var":"FFMPEG_BINARY_RELEASE","binary-release-tag":"b6.1.1","binaries-url-env-var":"FFMPEG_BINARIES_URL","executable-base-name":"ffmpeg"},"repository":{"type":"git","url":"https://github.com/eugeneware/ffmpeg-static"},"keywords":["ffmpeg","static","binary","binaries","mac","linux","windows"],"authors":["Eugene Ware <eugene@noblesamurai.com>","Jannis R <mail@jannisr.de>"],"contributors":["Thefrank (https://github.com/Thefrank)","Emil Sivervik <emil@sivervik.com>"],"license":"GPL-3.0-or-later","bugs":{"url":"https://github.com/eugeneware/ffmpeg-static/issues"},"engines":{"node":">=16"},"dependencies":{"@derhuerst/http-basic":"^8.2.0","env-paths":"^2.2.0","https-proxy-agent":"^5.0.0","progress":"^2.0.3"},"devDependencies":{"any-shell-escape":"^0.1.1"},"main":"index.js","files":["index.js","install.js","example.js","types"],"types":"types/index.d.ts"}')},9939:(e,t,r)=>{"use strict";r.d(t,{c:()=>a});let o=/^[A-Za-z0-9_-]{11}$/;function a(e){try{var t;let r;let a=new URL(e.trim()),i=a.hostname.replace(/^www\./,"").toLowerCase();if(!["youtube.com","m.youtube.com","music.youtube.com","youtu.be","youtube-nocookie.com"].includes(i)||!((t=r="youtu.be"===i?a.pathname.split("/").filter(Boolean)[0]:a.searchParams.get("v")??a.pathname.match(/\/(shorts|embed|live)\/([A-Za-z0-9_-]{11})/)?.[2]??void 0)&&o.test(t)))return null;return{videoId:r,canonicalUrl:`https://www.youtube.com/watch?v=${r}`}}catch{return null}}}};