/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/jobs/[id]/route";
exports.ids = ["app/api/jobs/[id]/route"];
exports.modules = {

/***/ "(rsc)/./app/api/jobs/[id]/route.ts":
/*!************************************!*\
  !*** ./app/api/jobs/[id]/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PATCH: () => (/* binding */ PATCH)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var _lib_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/queue */ \"(rsc)/./lib/queue.ts\");\n\n\n\nconst updateClipSchema = zod__WEBPACK_IMPORTED_MODULE_2__.object({\n    clipId: zod__WEBPACK_IMPORTED_MODULE_2__.string().min(1),\n    title: zod__WEBPACK_IMPORTED_MODULE_2__.string().min(3).max(140).optional(),\n    transcriptSnippet: zod__WEBPACK_IMPORTED_MODULE_2__.string().min(3).max(500).optional()\n});\nasync function GET(_request, context) {\n    const params = await context.params;\n    const job = (0,_lib_queue__WEBPACK_IMPORTED_MODULE_1__.getJob)(params.id);\n    if (!job) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Job não encontrado.\"\n        }, {\n            status: 404\n        });\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        job\n    });\n}\nasync function PATCH(request, context) {\n    const params = await context.params;\n    try {\n        const body = await request.json();\n        const parsed = updateClipSchema.safeParse(body);\n        if (!parsed.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Payload inválido para atualizar corte.\"\n            }, {\n                status: 400\n            });\n        }\n        const updated = (0,_lib_queue__WEBPACK_IMPORTED_MODULE_1__.updateClipCopy)(params.id, parsed.data.clipId, {\n            title: parsed.data.title,\n            transcriptSnippet: parsed.data.transcriptSnippet\n        });\n        if (!updated) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Corte não encontrado.\"\n            }, {\n                status: 404\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            clip: updated\n        });\n    } catch  {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Não foi possível atualizar o corte.\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2pvYnMvW2lkXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEyQztBQUNuQjtBQUU2QjtBQUVyRCxNQUFNSSxtQkFBbUJILHVDQUFRLENBQUM7SUFDaENLLFFBQVFMLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQztJQUN2QkMsT0FBT1IsdUNBQVEsR0FBR08sR0FBRyxDQUFDLEdBQUdFLEdBQUcsQ0FBQyxLQUFLQyxRQUFRO0lBQzFDQyxtQkFBbUJYLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQyxHQUFHRSxHQUFHLENBQUMsS0FBS0MsUUFBUTtBQUN4RDtBQUVPLGVBQWVFLElBQUlDLFFBQWlCLEVBQUVDLE9BQTRDO0lBQ3ZGLE1BQU1DLFNBQVMsTUFBTUQsUUFBUUMsTUFBTTtJQUNuQyxNQUFNQyxNQUFNZixrREFBTUEsQ0FBQ2MsT0FBT0UsRUFBRTtJQUU1QixJQUFJLENBQUNELEtBQUs7UUFDUixPQUFPakIscURBQVlBLENBQUNtQixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFzQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUMzRTtJQUVBLE9BQU9yQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztRQUFFRjtJQUFJO0FBQ2pDO0FBRU8sZUFBZUssTUFBTUMsT0FBZ0IsRUFBRVIsT0FBNEM7SUFDeEYsTUFBTUMsU0FBUyxNQUFNRCxRQUFRQyxNQUFNO0lBRW5DLElBQUk7UUFDRixNQUFNUSxPQUFPLE1BQU1ELFFBQVFKLElBQUk7UUFDL0IsTUFBTU0sU0FBU3JCLGlCQUFpQnNCLFNBQVMsQ0FBQ0Y7UUFFMUMsSUFBSSxDQUFDQyxPQUFPRSxPQUFPLEVBQUU7WUFDbkIsT0FBTzNCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXlDLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUM5RjtRQUVBLE1BQU1PLFVBQVV6QiwwREFBY0EsQ0FBQ2EsT0FBT0UsRUFBRSxFQUFFTyxPQUFPSSxJQUFJLENBQUN2QixNQUFNLEVBQUU7WUFDNURHLE9BQU9nQixPQUFPSSxJQUFJLENBQUNwQixLQUFLO1lBQ3hCRyxtQkFBbUJhLE9BQU9JLElBQUksQ0FBQ2pCLGlCQUFpQjtRQUNsRDtRQUVBLElBQUksQ0FBQ2dCLFNBQVM7WUFDWixPQUFPNUIscURBQVlBLENBQUNtQixJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBd0IsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzdFO1FBRUEsT0FBT3JCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO1lBQUVXLE1BQU1GO1FBQVE7SUFDM0MsRUFBRSxPQUFNO1FBQ04sT0FBTzVCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBc0MsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDM0Y7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2FsbWVpZGFnYWJyaWVsL0RvY3VtZW50cy9DQU5BL2FwcC9hcGkvam9icy9baWRdL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcblxuaW1wb3J0IHsgZ2V0Sm9iLCB1cGRhdGVDbGlwQ29weSB9IGZyb20gXCJAL2xpYi9xdWV1ZVwiO1xuXG5jb25zdCB1cGRhdGVDbGlwU2NoZW1hID0gei5vYmplY3Qoe1xuICBjbGlwSWQ6IHouc3RyaW5nKCkubWluKDEpLFxuICB0aXRsZTogei5zdHJpbmcoKS5taW4oMykubWF4KDE0MCkub3B0aW9uYWwoKSxcbiAgdHJhbnNjcmlwdFNuaXBwZXQ6IHouc3RyaW5nKCkubWluKDMpLm1heCg1MDApLm9wdGlvbmFsKCksXG59KTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChfcmVxdWVzdDogUmVxdWVzdCwgY29udGV4dDogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH0pIHtcbiAgY29uc3QgcGFyYW1zID0gYXdhaXQgY29udGV4dC5wYXJhbXM7XG4gIGNvbnN0IGpvYiA9IGdldEpvYihwYXJhbXMuaWQpO1xuXG4gIGlmICgham9iKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiSm9iIG7Do28gZW5jb250cmFkby5cIiB9LCB7IHN0YXR1czogNDA0IH0pO1xuICB9XG5cbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgam9iIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUEFUQ0gocmVxdWVzdDogUmVxdWVzdCwgY29udGV4dDogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH0pIHtcbiAgY29uc3QgcGFyYW1zID0gYXdhaXQgY29udGV4dC5wYXJhbXM7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgcGFyc2VkID0gdXBkYXRlQ2xpcFNjaGVtYS5zYWZlUGFyc2UoYm9keSk7XG5cbiAgICBpZiAoIXBhcnNlZC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJQYXlsb2FkIGludsOhbGlkbyBwYXJhIGF0dWFsaXphciBjb3J0ZS5cIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWQgPSB1cGRhdGVDbGlwQ29weShwYXJhbXMuaWQsIHBhcnNlZC5kYXRhLmNsaXBJZCwge1xuICAgICAgdGl0bGU6IHBhcnNlZC5kYXRhLnRpdGxlLFxuICAgICAgdHJhbnNjcmlwdFNuaXBwZXQ6IHBhcnNlZC5kYXRhLnRyYW5zY3JpcHRTbmlwcGV0LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1cGRhdGVkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJDb3J0ZSBuw6NvIGVuY29udHJhZG8uXCIgfSwgeyBzdGF0dXM6IDQwNCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBjbGlwOiB1cGRhdGVkIH0pO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJOw6NvIGZvaSBwb3Nzw612ZWwgYXR1YWxpemFyIG8gY29ydGUuXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJnZXRKb2IiLCJ1cGRhdGVDbGlwQ29weSIsInVwZGF0ZUNsaXBTY2hlbWEiLCJvYmplY3QiLCJjbGlwSWQiLCJzdHJpbmciLCJtaW4iLCJ0aXRsZSIsIm1heCIsIm9wdGlvbmFsIiwidHJhbnNjcmlwdFNuaXBwZXQiLCJHRVQiLCJfcmVxdWVzdCIsImNvbnRleHQiLCJwYXJhbXMiLCJqb2IiLCJpZCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsIlBBVENIIiwicmVxdWVzdCIsImJvZHkiLCJwYXJzZWQiLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwidXBkYXRlZCIsImRhdGEiLCJjbGlwIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/jobs/[id]/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/ffmpeg-bin.ts":
/*!***************************!*\
  !*** ./lib/ffmpeg-bin.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getFfmpegBinaryPath: () => (/* binding */ getFfmpegBinaryPath)\n/* harmony export */ });\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ffmpeg-static */ \"(rsc)/./node_modules/ffmpeg-static/index.js\");\n/* harmony import */ var ffmpeg_static__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(ffmpeg_static__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nlet cachedPath = null;\nfunction isExecutablePath(candidate) {\n    if (!candidate) return false;\n    if (candidate.includes((node_path__WEBPACK_IMPORTED_MODULE_1___default().sep))) {\n        return (0,node_fs__WEBPACK_IMPORTED_MODULE_0__.existsSync)(candidate);\n    }\n    try {\n        (0,node_child_process__WEBPACK_IMPORTED_MODULE_2__.execFileSync)(candidate, [\n            \"-version\"\n        ], {\n            stdio: \"ignore\"\n        });\n        return true;\n    } catch  {\n        return false;\n    }\n}\nfunction getFfmpegBinaryPath() {\n    if (cachedPath) {\n        return cachedPath;\n    }\n    const platformExecutable = process.platform === \"win32\" ? \"ffmpeg.exe\" : \"ffmpeg\";\n    const candidates = [\n        process.env.FFMPEG_BIN?.trim() || \"\",\n        (ffmpeg_static__WEBPACK_IMPORTED_MODULE_3___default()) || \"\",\n        node_path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"node_modules\", \"ffmpeg-static\", platformExecutable),\n        \"ffmpeg\"\n    ];\n    for (const candidate of candidates){\n        if (!candidate) continue;\n        if (isExecutablePath(candidate)) {\n            cachedPath = candidate;\n            return candidate;\n        }\n    }\n    throw new Error(\"FFmpeg não encontrado. Configure FFMPEG_BIN ou instale ffmpeg no sistema para habilitar cortes reais.\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZmZtcGVnLWJpbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBcUM7QUFDUjtBQUNxQjtBQUVUO0FBRXpDLElBQUlJLGFBQTRCO0FBRWhDLFNBQVNDLGlCQUFpQkMsU0FBaUI7SUFDekMsSUFBSSxDQUFDQSxXQUFXLE9BQU87SUFDdkIsSUFBSUEsVUFBVUMsUUFBUSxDQUFDTixzREFBUSxHQUFHO1FBQ2hDLE9BQU9ELG1EQUFVQSxDQUFDTTtJQUNwQjtJQUVBLElBQUk7UUFDRkosZ0VBQVlBLENBQUNJLFdBQVc7WUFBQztTQUFXLEVBQUU7WUFBRUcsT0FBTztRQUFTO1FBQ3hELE9BQU87SUFDVCxFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRjtBQUVPLFNBQVNDO0lBQ2QsSUFBSU4sWUFBWTtRQUNkLE9BQU9BO0lBQ1Q7SUFFQSxNQUFNTyxxQkFBcUJDLFFBQVFDLFFBQVEsS0FBSyxVQUFVLGVBQWU7SUFFekUsTUFBTUMsYUFBYTtRQUNqQkYsUUFBUUcsR0FBRyxDQUFDQyxVQUFVLEVBQUVDLFVBQVU7UUFDbENkLHNEQUFZQSxJQUFJO1FBQ2hCRixxREFBUyxDQUFDVyxRQUFRTyxHQUFHLElBQUksZ0JBQWdCLGlCQUFpQlI7UUFDMUQ7S0FDRDtJQUVELEtBQUssTUFBTUwsYUFBYVEsV0FBWTtRQUNsQyxJQUFJLENBQUNSLFdBQVc7UUFDaEIsSUFBSUQsaUJBQWlCQyxZQUFZO1lBQy9CRixhQUFhRTtZQUNiLE9BQU9BO1FBQ1Q7SUFDRjtJQUVBLE1BQU0sSUFBSWMsTUFDUjtBQUVKIiwic291cmNlcyI6WyIvVXNlcnMvYWxtZWlkYWdhYnJpZWwvRG9jdW1lbnRzL0NBTkEvbGliL2ZmbXBlZy1iaW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XG5pbXBvcnQgeyBleGVjRmlsZVN5bmMgfSBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XG5cbmltcG9ydCBmZm1wZWdTdGF0aWMgZnJvbSBcImZmbXBlZy1zdGF0aWNcIjtcblxubGV0IGNhY2hlZFBhdGg6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBpc0V4ZWN1dGFibGVQYXRoKGNhbmRpZGF0ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGlmICghY2FuZGlkYXRlKSByZXR1cm4gZmFsc2U7XG4gIGlmIChjYW5kaWRhdGUuaW5jbHVkZXMocGF0aC5zZXApKSB7XG4gICAgcmV0dXJuIGV4aXN0c1N5bmMoY2FuZGlkYXRlKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgZXhlY0ZpbGVTeW5jKGNhbmRpZGF0ZSwgW1wiLXZlcnNpb25cIl0sIHsgc3RkaW86IFwiaWdub3JlXCIgfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmZtcGVnQmluYXJ5UGF0aCgpOiBzdHJpbmcge1xuICBpZiAoY2FjaGVkUGF0aCkge1xuICAgIHJldHVybiBjYWNoZWRQYXRoO1xuICB9XG5cbiAgY29uc3QgcGxhdGZvcm1FeGVjdXRhYmxlID0gcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gXCJ3aW4zMlwiID8gXCJmZm1wZWcuZXhlXCIgOiBcImZmbXBlZ1wiO1xuXG4gIGNvbnN0IGNhbmRpZGF0ZXMgPSBbXG4gICAgcHJvY2Vzcy5lbnYuRkZNUEVHX0JJTj8udHJpbSgpIHx8IFwiXCIsXG4gICAgZmZtcGVnU3RhdGljIHx8IFwiXCIsXG4gICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwibm9kZV9tb2R1bGVzXCIsIFwiZmZtcGVnLXN0YXRpY1wiLCBwbGF0Zm9ybUV4ZWN1dGFibGUpLFxuICAgIFwiZmZtcGVnXCIsXG4gIF07XG5cbiAgZm9yIChjb25zdCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykge1xuICAgIGlmICghY2FuZGlkYXRlKSBjb250aW51ZTtcbiAgICBpZiAoaXNFeGVjdXRhYmxlUGF0aChjYW5kaWRhdGUpKSB7XG4gICAgICBjYWNoZWRQYXRoID0gY2FuZGlkYXRlO1xuICAgICAgcmV0dXJuIGNhbmRpZGF0ZTtcbiAgICB9XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgXCJGRm1wZWcgbsOjbyBlbmNvbnRyYWRvLiBDb25maWd1cmUgRkZNUEVHX0JJTiBvdSBpbnN0YWxlIGZmbXBlZyBubyBzaXN0ZW1hIHBhcmEgaGFiaWxpdGFyIGNvcnRlcyByZWFpcy5cIlxuICApO1xufVxuIl0sIm5hbWVzIjpbImV4aXN0c1N5bmMiLCJwYXRoIiwiZXhlY0ZpbGVTeW5jIiwiZmZtcGVnU3RhdGljIiwiY2FjaGVkUGF0aCIsImlzRXhlY3V0YWJsZVBhdGgiLCJjYW5kaWRhdGUiLCJpbmNsdWRlcyIsInNlcCIsInN0ZGlvIiwiZ2V0RmZtcGVnQmluYXJ5UGF0aCIsInBsYXRmb3JtRXhlY3V0YWJsZSIsInByb2Nlc3MiLCJwbGF0Zm9ybSIsImNhbmRpZGF0ZXMiLCJlbnYiLCJGRk1QRUdfQklOIiwidHJpbSIsImpvaW4iLCJjd2QiLCJFcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/ffmpeg-bin.ts\n");

/***/ }),

/***/ "(rsc)/./lib/queue.ts":
/*!**********************!*\
  !*** ./lib/queue.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createProcessingJob: () => (/* binding */ createProcessingJob),\n/* harmony export */   getClipFileAsset: () => (/* binding */ getClipFileAsset),\n/* harmony export */   getJob: () => (/* binding */ getJob),\n/* harmony export */   listJobs: () => (/* binding */ listJobs),\n/* harmony export */   regenerateMoreCuts: () => (/* binding */ regenerateMoreCuts),\n/* harmony export */   updateClipCopy: () => (/* binding */ updateClipCopy)\n/* harmony export */ });\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:crypto */ \"node:crypto\");\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_render__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/render */ \"(rsc)/./lib/render.ts\");\n/* harmony import */ var _lib_storage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/storage */ \"(rsc)/./lib/storage.ts\");\n/* harmony import */ var _lib_transcription__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/transcription */ \"(rsc)/./lib/transcription.ts\");\n/* harmony import */ var _lib_viral__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/viral */ \"(rsc)/./lib/viral.ts\");\n/* harmony import */ var _lib_youtube__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/youtube */ \"(rsc)/./lib/youtube.ts\");\n/* harmony import */ var _lib_ytdlp__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/ytdlp */ \"(rsc)/./lib/ytdlp.ts\");\n\n\n\n\n\n\n\n\nfunction getRuntime() {\n    if (!globalThis.__viralCutRuntime) {\n        globalThis.__viralCutRuntime = {\n            jobs: new Map(),\n            queue: [],\n            active: new Set(),\n            concurrency: 2,\n            pumpScheduled: false\n        };\n    }\n    return globalThis.__viralCutRuntime;\n}\nfunction nowIso() {\n    return new Date().toISOString();\n}\nfunction pushLog(job, stage, message) {\n    const timestamp = nowIso();\n    job.logs.unshift({\n        at: timestamp,\n        stage,\n        message\n    });\n    job.updatedAt = timestamp;\n    console.info(`[job:${job.id}] [${stage}] ${message}`);\n}\nfunction updateStage(job, stage, progress, message) {\n    job.stage = stage;\n    job.progress = progress;\n    pushLog(job, stage, message);\n}\nfunction schedulePump() {\n    const runtime = getRuntime();\n    if (runtime.pumpScheduled) return;\n    runtime.pumpScheduled = true;\n    setTimeout(()=>{\n        runtime.pumpScheduled = false;\n        void pumpQueue();\n    }, 0);\n}\nasync function pumpQueue() {\n    const runtime = getRuntime();\n    while(runtime.active.size < runtime.concurrency && runtime.queue.length > 0){\n        const next = runtime.queue.shift();\n        if (!next) break;\n        runtime.active.add(next.jobId);\n        void processJob(next.jobId).catch(()=>{\n        // processJob already updates state with error.\n        }).finally(()=>{\n            runtime.active.delete(next.jobId);\n            schedulePump();\n        });\n    }\n}\nasync function processJob(jobId) {\n    const runtime = getRuntime();\n    const job = runtime.jobs.get(jobId);\n    if (!job) return;\n    const log = (message)=>pushLog(job, job.stage, message);\n    try {\n        updateStage(job, \"collecting\", 6, `URL recebida: ${job.input.youtubeUrl}`);\n        const parsed = (0,_lib_youtube__WEBPACK_IMPORTED_MODULE_6__.parseYouTubeUrl)(job.input.youtubeUrl);\n        if (!parsed) {\n            throw new Error(\"Link de YouTube inválido. Envie uma URL pública válida.\");\n        }\n        if (parsed.videoId !== job.input.videoId) {\n            pushLog(job, \"collecting\", `videoId divergente detectado (input=${job.input.videoId}, parsed=${parsed.videoId})`);\n        }\n        updateStage(job, \"collecting\", 10, `videoId extraído: ${parsed.videoId}`);\n        await (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.ensureJobStorage)(jobId);\n        updateStage(job, \"collecting\", 16, \"Iniciando download do vídeo original\");\n        const downloaded = await (0,_lib_ytdlp__WEBPACK_IMPORTED_MODULE_7__.downloadVideoFromYoutube)({\n            jobId,\n            url: parsed.canonicalUrl,\n            videoId: parsed.videoId,\n            log\n        });\n        job.video = downloaded.video;\n        updateStage(job, \"collecting\", 44, \"Download concluído. Verificando legendas automáticas do vídeo\");\n        const subtitleVttPath = await (0,_lib_ytdlp__WEBPACK_IMPORTED_MODULE_7__.downloadAutoSubtitlesVtt)({\n            jobId,\n            url: parsed.canonicalUrl,\n            log\n        });\n        updateStage(job, \"collecting\", 58, \"Extraindo sinais de áudio e gerando transcrição temporal\");\n        job.transcript = await (0,_lib_transcription__WEBPACK_IMPORTED_MODULE_4__.transcribeYouTubeVideo)({\n            jobId,\n            video: downloaded.video,\n            sourceVideoPath: downloaded.sourceVideoPath,\n            subtitleVttPath,\n            keywordHints: downloaded.keywords,\n            descriptionHint: downloaded.description,\n            log\n        });\n        if (job.transcript.length === 0) {\n            throw new Error(\"Não foi possível gerar segmentos de transcrição para este vídeo.\");\n        }\n        updateStage(job, \"analyzing\", 74, \"IA detectando momentos virais e calculando score\");\n        const suggested = (0,_lib_viral__WEBPACK_IMPORTED_MODULE_5__.generateViralCuts)({\n            videoTitle: downloaded.video.title,\n            segments: job.transcript,\n            durationSec: downloaded.video.durationSec,\n            requestedCuts: 6\n        });\n        if (suggested.length === 0) {\n            throw new Error(\"A IA não conseguiu sugerir cortes para este vídeo.\");\n        }\n        updateStage(job, \"rendering\", 84, `Gerando ${suggested.length} cortes reais em formato 9:16`);\n        job.clips = await (0,_lib_render__WEBPACK_IMPORTED_MODULE_2__.renderViralClips)({\n            jobId,\n            video: downloaded.video,\n            sourceVideoPath: downloaded.sourceVideoPath,\n            clips: suggested,\n            log\n        });\n        updateStage(job, \"completed\", 100, \"Cortes gerados com sucesso a partir do vídeo enviado\");\n    } catch (error) {\n        const message = error instanceof Error ? error.message : \"Falha inesperada no pipeline.\";\n        job.error = message;\n        updateStage(job, \"failed\", job.progress || 0, `Processamento interrompido: ${message}`);\n    }\n}\nfunction createProcessingJob(youtubeUrl, videoId) {\n    const runtime = getRuntime();\n    const timestamp = nowIso();\n    const id = (0,node_crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n    const job = {\n        id,\n        createdAt: timestamp,\n        updatedAt: timestamp,\n        input: {\n            youtubeUrl,\n            videoId\n        },\n        stage: \"queued\",\n        progress: 2,\n        logs: [\n            {\n                at: timestamp,\n                stage: \"queued\",\n                message: `Job criado para ${youtubeUrl}`\n            }\n        ],\n        transcript: [],\n        clips: []\n    };\n    runtime.jobs.set(id, job);\n    runtime.queue.push({\n        type: \"initial\",\n        jobId: id\n    });\n    schedulePump();\n    return job;\n}\nfunction listJobs() {\n    return Array.from(getRuntime().jobs.values()).sort((a, b)=>b.createdAt.localeCompare(a.createdAt));\n}\nfunction getJob(jobId) {\n    return getRuntime().jobs.get(jobId);\n}\nfunction updateClipCopy(jobId, clipId, payload) {\n    const job = getJob(jobId);\n    if (!job) return null;\n    const clipIndex = job.clips.findIndex((clip)=>clip.id === clipId);\n    if (clipIndex < 0) return null;\n    const current = job.clips[clipIndex];\n    const updated = {\n        ...current,\n        title: payload.title ?? current.title,\n        transcriptSnippet: payload.transcriptSnippet ?? current.transcriptSnippet\n    };\n    job.clips[clipIndex] = updated;\n    pushLog(job, job.stage, `Corte ${clipId} atualizado no editor.`);\n    return updated;\n}\nasync function regenerateMoreCuts(jobId) {\n    const job = getJob(jobId);\n    if (!job) {\n        throw new Error(\"Job não encontrado.\");\n    }\n    if (!job.video || job.transcript.length === 0) {\n        throw new Error(\"Este job ainda não possui transcrição para regenerar cortes.\");\n    }\n    if (job.clips.length >= 10) {\n        throw new Error(\"Limite máximo de 10 cortes já atingido.\");\n    }\n    const sourceVideoPath = await (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.findDownloadedSourceVideo)(jobId);\n    if (!sourceVideoPath) {\n        throw new Error(\"Arquivo fonte do vídeo não encontrado para gerar novos cortes.\");\n    }\n    updateStage(job, \"analyzing\", 64, \"Gerando novas sugestões virais\");\n    const desired = Math.min(10, Math.max(job.clips.length + 3, 6));\n    const generated = (0,_lib_viral__WEBPACK_IMPORTED_MODULE_5__.generateViralCuts)({\n        videoTitle: job.video.title,\n        segments: job.transcript,\n        durationSec: job.video.durationSec,\n        requestedCuts: desired\n    });\n    const existingStarts = new Set(job.clips.map((clip)=>Math.round(clip.startSec)));\n    const additions = generated.filter((clip)=>!existingStarts.has(Math.round(clip.startSec))).slice(0, 10 - job.clips.length).map((clip, index)=>({\n            ...clip,\n            id: `${clip.id}-extra-${job.clips.length + index + 1}`\n        }));\n    if (additions.length === 0) {\n        throw new Error(\"Não há novos cortes relevantes para adicionar neste vídeo.\");\n    }\n    updateStage(job, \"rendering\", 86, \"Renderizando novos cortes reais\");\n    const rendered = await (0,_lib_render__WEBPACK_IMPORTED_MODULE_2__.renderViralClips)({\n        jobId,\n        video: job.video,\n        sourceVideoPath,\n        clips: additions,\n        log: (message)=>pushLog(job, \"rendering\", message)\n    });\n    job.clips = [\n        ...job.clips,\n        ...rendered\n    ].slice(0, 10);\n    updateStage(job, \"completed\", 100, \"Novos cortes adicionados com sucesso\");\n    return job;\n}\nfunction getClipFileAsset(jobId, clipId) {\n    const job = getJob(jobId);\n    if (!job?.video) return null;\n    const clip = job.clips.find((item)=>item.id === clipId);\n    if (!clip) return null;\n    const filePath = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.getClipOutputPath)(jobId, clipId);\n    if (!(0,node_fs__WEBPACK_IMPORTED_MODULE_1__.existsSync)(filePath)) {\n        return null;\n    }\n    return {\n        filePath,\n        filename: `${job.video.videoId}-${clip.id}.mp4`,\n        contentType: \"video/mp4\"\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxNQUFNMkYsV0FBVyxNQUFNbEgsNkRBQWdCQSxDQUFDO1FBQ3RDNkM7UUFDQWUsT0FBT3JDLElBQUlxQyxLQUFLO1FBQ2hCRztRQUNBVyxPQUFPbUM7UUFDUDFELEtBQUssQ0FBQzFCLFVBQVlILFFBQVFDLEtBQUssYUFBYUU7SUFDOUM7SUFFQUYsSUFBSW1ELEtBQUssR0FBRztXQUFJbkQsSUFBSW1ELEtBQUs7V0FBS3dDO0tBQVMsQ0FBQ0YsS0FBSyxDQUFDLEdBQUc7SUFFakQ5RSxZQUFZWCxLQUFLLGFBQWEsS0FBSztJQUNuQyxPQUFPQTtBQUNUO0FBUU8sU0FBUzRGLGlCQUFpQnRFLEtBQWEsRUFBRThDLE1BQWM7SUFDNUQsTUFBTXBFLE1BQU1rRSxPQUFPNUM7SUFDbkIsSUFBSSxDQUFDdEIsS0FBS3FDLE9BQU8sT0FBTztJQUV4QixNQUFNbUMsT0FBT3hFLElBQUltRCxLQUFLLENBQUMwQyxJQUFJLENBQUMsQ0FBQ0MsT0FBU0EsS0FBS3BGLEVBQUUsS0FBSzBEO0lBQ2xELElBQUksQ0FBQ0ksTUFBTSxPQUFPO0lBRWxCLE1BQU11QixXQUFXcEgsK0RBQWlCQSxDQUFDMkMsT0FBTzhDO0lBRTFDLElBQUksQ0FBQzVGLG1EQUFVQSxDQUFDdUgsV0FBVztRQUN6QixPQUFPO0lBQ1Q7SUFFQSxPQUFPO1FBQ0xBO1FBQ0FDLFVBQVUsR0FBR2hHLElBQUlxQyxLQUFLLENBQUNKLE9BQU8sQ0FBQyxDQUFDLEVBQUV1QyxLQUFLOUQsRUFBRSxDQUFDLElBQUksQ0FBQztRQUMvQ3VGLGFBQWE7SUFDZjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvYWxtZWlkYWdhYnJpZWwvRG9jdW1lbnRzL0NBTkEvbGliL3F1ZXVlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJhbmRvbVVVSUQgfSBmcm9tIFwibm9kZTpjcnlwdG9cIjtcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwibm9kZTpmc1wiO1xuXG5pbXBvcnQgeyByZW5kZXJWaXJhbENsaXBzIH0gZnJvbSBcIkAvbGliL3JlbmRlclwiO1xuaW1wb3J0IHsgZmluZERvd25sb2FkZWRTb3VyY2VWaWRlbywgZ2V0Q2xpcE91dHB1dFBhdGgsIGVuc3VyZUpvYlN0b3JhZ2UgfSBmcm9tIFwiQC9saWIvc3RvcmFnZVwiO1xuaW1wb3J0IHsgdHJhbnNjcmliZVlvdVR1YmVWaWRlbyB9IGZyb20gXCJAL2xpYi90cmFuc2NyaXB0aW9uXCI7XG5pbXBvcnQgeyBQcm9jZXNzaW5nSm9iLCBWaXJhbENsaXAgfSBmcm9tIFwiQC9saWIvdHlwZXNcIjtcbmltcG9ydCB7IGdlbmVyYXRlVmlyYWxDdXRzIH0gZnJvbSBcIkAvbGliL3ZpcmFsXCI7XG5pbXBvcnQgeyBwYXJzZVlvdVR1YmVVcmwgfSBmcm9tIFwiQC9saWIveW91dHViZVwiO1xuaW1wb3J0IHsgZG93bmxvYWRBdXRvU3VidGl0bGVzVnR0LCBkb3dubG9hZFZpZGVvRnJvbVlvdXR1YmUgfSBmcm9tIFwiQC9saWIveXRkbHBcIjtcblxuaW50ZXJmYWNlIFF1ZXVlVGFzayB7XG4gIHR5cGU6IFwiaW5pdGlhbFwiO1xuICBqb2JJZDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgUnVudGltZVN0YXRlIHtcbiAgam9iczogTWFwPHN0cmluZywgUHJvY2Vzc2luZ0pvYj47XG4gIHF1ZXVlOiBRdWV1ZVRhc2tbXTtcbiAgYWN0aXZlOiBTZXQ8c3RyaW5nPjtcbiAgY29uY3VycmVuY3k6IG51bWJlcjtcbiAgcHVtcFNjaGVkdWxlZDogYm9vbGVhbjtcbn1cblxuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX3ZpcmFsQ3V0UnVudGltZTogUnVudGltZVN0YXRlIHwgdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBnZXRSdW50aW1lKCk6IFJ1bnRpbWVTdGF0ZSB7XG4gIGlmICghZ2xvYmFsVGhpcy5fX3ZpcmFsQ3V0UnVudGltZSkge1xuICAgIGdsb2JhbFRoaXMuX192aXJhbEN1dFJ1bnRpbWUgPSB7XG4gICAgICBqb2JzOiBuZXcgTWFwPHN0cmluZywgUHJvY2Vzc2luZ0pvYj4oKSxcbiAgICAgIHF1ZXVlOiBbXSxcbiAgICAgIGFjdGl2ZTogbmV3IFNldDxzdHJpbmc+KCksXG4gICAgICBjb25jdXJyZW5jeTogMixcbiAgICAgIHB1bXBTY2hlZHVsZWQ6IGZhbHNlLFxuICAgIH07XG4gIH1cblxuICByZXR1cm4gZ2xvYmFsVGhpcy5fX3ZpcmFsQ3V0UnVudGltZTtcbn1cblxuZnVuY3Rpb24gbm93SXNvKCkge1xuICByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xufVxuXG5mdW5jdGlvbiBwdXNoTG9nKGpvYjogUHJvY2Vzc2luZ0pvYiwgc3RhZ2U6IFByb2Nlc3NpbmdKb2JbXCJzdGFnZVwiXSwgbWVzc2FnZTogc3RyaW5nKSB7XG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5vd0lzbygpO1xuICBqb2IubG9ncy51bnNoaWZ0KHsgYXQ6IHRpbWVzdGFtcCwgc3RhZ2UsIG1lc3NhZ2UgfSk7XG4gIGpvYi51cGRhdGVkQXQgPSB0aW1lc3RhbXA7XG4gIGNvbnNvbGUuaW5mbyhgW2pvYjoke2pvYi5pZH1dIFske3N0YWdlfV0gJHttZXNzYWdlfWApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVTdGFnZShcbiAgam9iOiBQcm9jZXNzaW5nSm9iLFxuICBzdGFnZTogUHJvY2Vzc2luZ0pvYltcInN0YWdlXCJdLFxuICBwcm9ncmVzczogbnVtYmVyLFxuICBtZXNzYWdlOiBzdHJpbmdcbikge1xuICBqb2Iuc3RhZ2UgPSBzdGFnZTtcbiAgam9iLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gIHB1c2hMb2coam9iLCBzdGFnZSwgbWVzc2FnZSk7XG59XG5cbmZ1bmN0aW9uIHNjaGVkdWxlUHVtcCgpIHtcbiAgY29uc3QgcnVudGltZSA9IGdldFJ1bnRpbWUoKTtcbiAgaWYgKHJ1bnRpbWUucHVtcFNjaGVkdWxlZCkgcmV0dXJuO1xuICBydW50aW1lLnB1bXBTY2hlZHVsZWQgPSB0cnVlO1xuXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIHJ1bnRpbWUucHVtcFNjaGVkdWxlZCA9IGZhbHNlO1xuICAgIHZvaWQgcHVtcFF1ZXVlKCk7XG4gIH0sIDApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBwdW1wUXVldWUoKSB7XG4gIGNvbnN0IHJ1bnRpbWUgPSBnZXRSdW50aW1lKCk7XG5cbiAgd2hpbGUgKHJ1bnRpbWUuYWN0aXZlLnNpemUgPCBydW50aW1lLmNvbmN1cnJlbmN5ICYmIHJ1bnRpbWUucXVldWUubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IG5leHQgPSBydW50aW1lLnF1ZXVlLnNoaWZ0KCk7XG4gICAgaWYgKCFuZXh0KSBicmVhaztcblxuICAgIHJ1bnRpbWUuYWN0aXZlLmFkZChuZXh0LmpvYklkKTtcblxuICAgIHZvaWQgcHJvY2Vzc0pvYihuZXh0LmpvYklkKVxuICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgLy8gcHJvY2Vzc0pvYiBhbHJlYWR5IHVwZGF0ZXMgc3RhdGUgd2l0aCBlcnJvci5cbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIHJ1bnRpbWUuYWN0aXZlLmRlbGV0ZShuZXh0LmpvYklkKTtcbiAgICAgICAgc2NoZWR1bGVQdW1wKCk7XG4gICAgICB9KTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzSm9iKGpvYklkOiBzdHJpbmcpIHtcbiAgY29uc3QgcnVudGltZSA9IGdldFJ1bnRpbWUoKTtcbiAgY29uc3Qgam9iID0gcnVudGltZS5qb2JzLmdldChqb2JJZCk7XG5cbiAgaWYgKCFqb2IpIHJldHVybjtcblxuICBjb25zdCBsb2cgPSAobWVzc2FnZTogc3RyaW5nKSA9PiBwdXNoTG9nKGpvYiwgam9iLnN0YWdlLCBtZXNzYWdlKTtcblxuICB0cnkge1xuICAgIHVwZGF0ZVN0YWdlKGpvYiwgXCJjb2xsZWN0aW5nXCIsIDYsIGBVUkwgcmVjZWJpZGE6ICR7am9iLmlucHV0LnlvdXR1YmVVcmx9YCk7XG5cbiAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVlvdVR1YmVVcmwoam9iLmlucHV0LnlvdXR1YmVVcmwpO1xuICAgIGlmICghcGFyc2VkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMaW5rIGRlIFlvdVR1YmUgaW52w6FsaWRvLiBFbnZpZSB1bWEgVVJMIHDDumJsaWNhIHbDoWxpZGEuXCIpO1xuICAgIH1cblxuICAgIGlmIChwYXJzZWQudmlkZW9JZCAhPT0gam9iLmlucHV0LnZpZGVvSWQpIHtcbiAgICAgIHB1c2hMb2coXG4gICAgICAgIGpvYixcbiAgICAgICAgXCJjb2xsZWN0aW5nXCIsXG4gICAgICAgIGB2aWRlb0lkIGRpdmVyZ2VudGUgZGV0ZWN0YWRvIChpbnB1dD0ke2pvYi5pbnB1dC52aWRlb0lkfSwgcGFyc2VkPSR7cGFyc2VkLnZpZGVvSWR9KWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImNvbGxlY3RpbmdcIiwgMTAsIGB2aWRlb0lkIGV4dHJhw61kbzogJHtwYXJzZWQudmlkZW9JZH1gKTtcblxuICAgIGF3YWl0IGVuc3VyZUpvYlN0b3JhZ2Uoam9iSWQpO1xuXG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImNvbGxlY3RpbmdcIiwgMTYsIFwiSW5pY2lhbmRvIGRvd25sb2FkIGRvIHbDrWRlbyBvcmlnaW5hbFwiKTtcbiAgICBjb25zdCBkb3dubG9hZGVkID0gYXdhaXQgZG93bmxvYWRWaWRlb0Zyb21Zb3V0dWJlKHtcbiAgICAgIGpvYklkLFxuICAgICAgdXJsOiBwYXJzZWQuY2Fub25pY2FsVXJsLFxuICAgICAgdmlkZW9JZDogcGFyc2VkLnZpZGVvSWQsXG4gICAgICBsb2csXG4gICAgfSk7XG5cbiAgICBqb2IudmlkZW8gPSBkb3dubG9hZGVkLnZpZGVvO1xuXG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImNvbGxlY3RpbmdcIiwgNDQsIFwiRG93bmxvYWQgY29uY2x1w61kby4gVmVyaWZpY2FuZG8gbGVnZW5kYXMgYXV0b23DoXRpY2FzIGRvIHbDrWRlb1wiKTtcbiAgICBjb25zdCBzdWJ0aXRsZVZ0dFBhdGggPSBhd2FpdCBkb3dubG9hZEF1dG9TdWJ0aXRsZXNWdHQoe1xuICAgICAgam9iSWQsXG4gICAgICB1cmw6IHBhcnNlZC5jYW5vbmljYWxVcmwsXG4gICAgICBsb2csXG4gICAgfSk7XG5cbiAgICB1cGRhdGVTdGFnZShqb2IsIFwiY29sbGVjdGluZ1wiLCA1OCwgXCJFeHRyYWluZG8gc2luYWlzIGRlIMOhdWRpbyBlIGdlcmFuZG8gdHJhbnNjcmnDp8OjbyB0ZW1wb3JhbFwiKTtcbiAgICBqb2IudHJhbnNjcmlwdCA9IGF3YWl0IHRyYW5zY3JpYmVZb3VUdWJlVmlkZW8oe1xuICAgICAgam9iSWQsXG4gICAgICB2aWRlbzogZG93bmxvYWRlZC52aWRlbyxcbiAgICAgIHNvdXJjZVZpZGVvUGF0aDogZG93bmxvYWRlZC5zb3VyY2VWaWRlb1BhdGgsXG4gICAgICBzdWJ0aXRsZVZ0dFBhdGgsXG4gICAgICBrZXl3b3JkSGludHM6IGRvd25sb2FkZWQua2V5d29yZHMsXG4gICAgICBkZXNjcmlwdGlvbkhpbnQ6IGRvd25sb2FkZWQuZGVzY3JpcHRpb24sXG4gICAgICBsb2csXG4gICAgfSk7XG5cbiAgICBpZiAoam9iLnRyYW5zY3JpcHQubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOw6NvIGZvaSBwb3Nzw612ZWwgZ2VyYXIgc2VnbWVudG9zIGRlIHRyYW5zY3Jpw6fDo28gcGFyYSBlc3RlIHbDrWRlby5cIik7XG4gICAgfVxuXG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImFuYWx5emluZ1wiLCA3NCwgXCJJQSBkZXRlY3RhbmRvIG1vbWVudG9zIHZpcmFpcyBlIGNhbGN1bGFuZG8gc2NvcmVcIik7XG4gICAgY29uc3Qgc3VnZ2VzdGVkID0gZ2VuZXJhdGVWaXJhbEN1dHMoe1xuICAgICAgdmlkZW9UaXRsZTogZG93bmxvYWRlZC52aWRlby50aXRsZSxcbiAgICAgIHNlZ21lbnRzOiBqb2IudHJhbnNjcmlwdCxcbiAgICAgIGR1cmF0aW9uU2VjOiBkb3dubG9hZGVkLnZpZGVvLmR1cmF0aW9uU2VjLFxuICAgICAgcmVxdWVzdGVkQ3V0czogNixcbiAgICB9KTtcblxuICAgIGlmIChzdWdnZXN0ZWQubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIElBIG7Do28gY29uc2VndWl1IHN1Z2VyaXIgY29ydGVzIHBhcmEgZXN0ZSB2w61kZW8uXCIpO1xuICAgIH1cblxuICAgIHVwZGF0ZVN0YWdlKGpvYiwgXCJyZW5kZXJpbmdcIiwgODQsIGBHZXJhbmRvICR7c3VnZ2VzdGVkLmxlbmd0aH0gY29ydGVzIHJlYWlzIGVtIGZvcm1hdG8gOToxNmApO1xuICAgIGpvYi5jbGlwcyA9IGF3YWl0IHJlbmRlclZpcmFsQ2xpcHMoe1xuICAgICAgam9iSWQsXG4gICAgICB2aWRlbzogZG93bmxvYWRlZC52aWRlbyxcbiAgICAgIHNvdXJjZVZpZGVvUGF0aDogZG93bmxvYWRlZC5zb3VyY2VWaWRlb1BhdGgsXG4gICAgICBjbGlwczogc3VnZ2VzdGVkLFxuICAgICAgbG9nLFxuICAgIH0pO1xuXG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImNvbXBsZXRlZFwiLCAxMDAsIFwiQ29ydGVzIGdlcmFkb3MgY29tIHN1Y2Vzc28gYSBwYXJ0aXIgZG8gdsOtZGVvIGVudmlhZG9cIik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJGYWxoYSBpbmVzcGVyYWRhIG5vIHBpcGVsaW5lLlwiO1xuICAgIGpvYi5lcnJvciA9IG1lc3NhZ2U7XG4gICAgdXBkYXRlU3RhZ2Uoam9iLCBcImZhaWxlZFwiLCBqb2IucHJvZ3Jlc3MgfHwgMCwgYFByb2Nlc3NhbWVudG8gaW50ZXJyb21waWRvOiAke21lc3NhZ2V9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVByb2Nlc3NpbmdKb2IoeW91dHViZVVybDogc3RyaW5nLCB2aWRlb0lkOiBzdHJpbmcpOiBQcm9jZXNzaW5nSm9iIHtcbiAgY29uc3QgcnVudGltZSA9IGdldFJ1bnRpbWUoKTtcbiAgY29uc3QgdGltZXN0YW1wID0gbm93SXNvKCk7XG4gIGNvbnN0IGlkID0gcmFuZG9tVVVJRCgpO1xuXG4gIGNvbnN0IGpvYjogUHJvY2Vzc2luZ0pvYiA9IHtcbiAgICBpZCxcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcbiAgICB1cGRhdGVkQXQ6IHRpbWVzdGFtcCxcbiAgICBpbnB1dDoge1xuICAgICAgeW91dHViZVVybCxcbiAgICAgIHZpZGVvSWQsXG4gICAgfSxcbiAgICBzdGFnZTogXCJxdWV1ZWRcIixcbiAgICBwcm9ncmVzczogMixcbiAgICBsb2dzOiBbXG4gICAgICB7XG4gICAgICAgIGF0OiB0aW1lc3RhbXAsXG4gICAgICAgIHN0YWdlOiBcInF1ZXVlZFwiLFxuICAgICAgICBtZXNzYWdlOiBgSm9iIGNyaWFkbyBwYXJhICR7eW91dHViZVVybH1gLFxuICAgICAgfSxcbiAgICBdLFxuICAgIHRyYW5zY3JpcHQ6IFtdLFxuICAgIGNsaXBzOiBbXSxcbiAgfTtcblxuICBydW50aW1lLmpvYnMuc2V0KGlkLCBqb2IpO1xuICBydW50aW1lLnF1ZXVlLnB1c2goeyB0eXBlOiBcImluaXRpYWxcIiwgam9iSWQ6IGlkIH0pO1xuXG4gIHNjaGVkdWxlUHVtcCgpO1xuXG4gIHJldHVybiBqb2I7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0Sm9icygpOiBQcm9jZXNzaW5nSm9iW10ge1xuICByZXR1cm4gQXJyYXkuZnJvbShnZXRSdW50aW1lKCkuam9icy52YWx1ZXMoKSkuc29ydCgoYSwgYikgPT4gYi5jcmVhdGVkQXQubG9jYWxlQ29tcGFyZShhLmNyZWF0ZWRBdCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Sm9iKGpvYklkOiBzdHJpbmcpOiBQcm9jZXNzaW5nSm9iIHwgdW5kZWZpbmVkIHtcbiAgcmV0dXJuIGdldFJ1bnRpbWUoKS5qb2JzLmdldChqb2JJZCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVDbGlwQ29weShcbiAgam9iSWQ6IHN0cmluZyxcbiAgY2xpcElkOiBzdHJpbmcsXG4gIHBheWxvYWQ6IHtcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICB0cmFuc2NyaXB0U25pcHBldD86IHN0cmluZztcbiAgfVxuKTogVmlyYWxDbGlwIHwgbnVsbCB7XG4gIGNvbnN0IGpvYiA9IGdldEpvYihqb2JJZCk7XG4gIGlmICgham9iKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBjbGlwSW5kZXggPSBqb2IuY2xpcHMuZmluZEluZGV4KChjbGlwKSA9PiBjbGlwLmlkID09PSBjbGlwSWQpO1xuICBpZiAoY2xpcEluZGV4IDwgMCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgY3VycmVudCA9IGpvYi5jbGlwc1tjbGlwSW5kZXhdO1xuICBjb25zdCB1cGRhdGVkOiBWaXJhbENsaXAgPSB7XG4gICAgLi4uY3VycmVudCxcbiAgICB0aXRsZTogcGF5bG9hZC50aXRsZSA/PyBjdXJyZW50LnRpdGxlLFxuICAgIHRyYW5zY3JpcHRTbmlwcGV0OiBwYXlsb2FkLnRyYW5zY3JpcHRTbmlwcGV0ID8/IGN1cnJlbnQudHJhbnNjcmlwdFNuaXBwZXQsXG4gIH07XG5cbiAgam9iLmNsaXBzW2NsaXBJbmRleF0gPSB1cGRhdGVkO1xuICBwdXNoTG9nKGpvYiwgam9iLnN0YWdlLCBgQ29ydGUgJHtjbGlwSWR9IGF0dWFsaXphZG8gbm8gZWRpdG9yLmApO1xuXG4gIHJldHVybiB1cGRhdGVkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVnZW5lcmF0ZU1vcmVDdXRzKGpvYklkOiBzdHJpbmcpOiBQcm9taXNlPFByb2Nlc3NpbmdKb2I+IHtcbiAgY29uc3Qgam9iID0gZ2V0Sm9iKGpvYklkKTtcbiAgaWYgKCFqb2IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJKb2IgbsOjbyBlbmNvbnRyYWRvLlwiKTtcbiAgfVxuXG4gIGlmICgham9iLnZpZGVvIHx8IGpvYi50cmFuc2NyaXB0Lmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkVzdGUgam9iIGFpbmRhIG7Do28gcG9zc3VpIHRyYW5zY3Jpw6fDo28gcGFyYSByZWdlbmVyYXIgY29ydGVzLlwiKTtcbiAgfVxuXG4gIGlmIChqb2IuY2xpcHMubGVuZ3RoID49IDEwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTGltaXRlIG3DoXhpbW8gZGUgMTAgY29ydGVzIGrDoSBhdGluZ2lkby5cIik7XG4gIH1cblxuICBjb25zdCBzb3VyY2VWaWRlb1BhdGggPSBhd2FpdCBmaW5kRG93bmxvYWRlZFNvdXJjZVZpZGVvKGpvYklkKTtcbiAgaWYgKCFzb3VyY2VWaWRlb1BhdGgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcnF1aXZvIGZvbnRlIGRvIHbDrWRlbyBuw6NvIGVuY29udHJhZG8gcGFyYSBnZXJhciBub3ZvcyBjb3J0ZXMuXCIpO1xuICB9XG5cbiAgdXBkYXRlU3RhZ2Uoam9iLCBcImFuYWx5emluZ1wiLCA2NCwgXCJHZXJhbmRvIG5vdmFzIHN1Z2VzdMO1ZXMgdmlyYWlzXCIpO1xuXG4gIGNvbnN0IGRlc2lyZWQgPSBNYXRoLm1pbigxMCwgTWF0aC5tYXgoam9iLmNsaXBzLmxlbmd0aCArIDMsIDYpKTtcbiAgY29uc3QgZ2VuZXJhdGVkID0gZ2VuZXJhdGVWaXJhbEN1dHMoe1xuICAgIHZpZGVvVGl0bGU6IGpvYi52aWRlby50aXRsZSxcbiAgICBzZWdtZW50czogam9iLnRyYW5zY3JpcHQsXG4gICAgZHVyYXRpb25TZWM6IGpvYi52aWRlby5kdXJhdGlvblNlYyxcbiAgICByZXF1ZXN0ZWRDdXRzOiBkZXNpcmVkLFxuICB9KTtcblxuICBjb25zdCBleGlzdGluZ1N0YXJ0cyA9IG5ldyBTZXQoam9iLmNsaXBzLm1hcCgoY2xpcCkgPT4gTWF0aC5yb3VuZChjbGlwLnN0YXJ0U2VjKSkpO1xuICBjb25zdCBhZGRpdGlvbnMgPSBnZW5lcmF0ZWRcbiAgICAuZmlsdGVyKChjbGlwKSA9PiAhZXhpc3RpbmdTdGFydHMuaGFzKE1hdGgucm91bmQoY2xpcC5zdGFydFNlYykpKVxuICAgIC5zbGljZSgwLCAxMCAtIGpvYi5jbGlwcy5sZW5ndGgpXG4gICAgLm1hcCgoY2xpcCwgaW5kZXgpID0+ICh7XG4gICAgICAuLi5jbGlwLFxuICAgICAgaWQ6IGAke2NsaXAuaWR9LWV4dHJhLSR7am9iLmNsaXBzLmxlbmd0aCArIGluZGV4ICsgMX1gLFxuICAgIH0pKTtcblxuICBpZiAoYWRkaXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk7Do28gaMOhIG5vdm9zIGNvcnRlcyByZWxldmFudGVzIHBhcmEgYWRpY2lvbmFyIG5lc3RlIHbDrWRlby5cIik7XG4gIH1cblxuICB1cGRhdGVTdGFnZShqb2IsIFwicmVuZGVyaW5nXCIsIDg2LCBcIlJlbmRlcml6YW5kbyBub3ZvcyBjb3J0ZXMgcmVhaXNcIik7XG5cbiAgY29uc3QgcmVuZGVyZWQgPSBhd2FpdCByZW5kZXJWaXJhbENsaXBzKHtcbiAgICBqb2JJZCxcbiAgICB2aWRlbzogam9iLnZpZGVvLFxuICAgIHNvdXJjZVZpZGVvUGF0aCxcbiAgICBjbGlwczogYWRkaXRpb25zLFxuICAgIGxvZzogKG1lc3NhZ2UpID0+IHB1c2hMb2coam9iLCBcInJlbmRlcmluZ1wiLCBtZXNzYWdlKSxcbiAgfSk7XG5cbiAgam9iLmNsaXBzID0gWy4uLmpvYi5jbGlwcywgLi4ucmVuZGVyZWRdLnNsaWNlKDAsIDEwKTtcblxuICB1cGRhdGVTdGFnZShqb2IsIFwiY29tcGxldGVkXCIsIDEwMCwgXCJOb3ZvcyBjb3J0ZXMgYWRpY2lvbmFkb3MgY29tIHN1Y2Vzc29cIik7XG4gIHJldHVybiBqb2I7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xpcEZpbGVBc3NldCB7XG4gIGZpbGVQYXRoOiBzdHJpbmc7XG4gIGZpbGVuYW1lOiBzdHJpbmc7XG4gIGNvbnRlbnRUeXBlOiBcInZpZGVvL21wNFwiO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpcEZpbGVBc3NldChqb2JJZDogc3RyaW5nLCBjbGlwSWQ6IHN0cmluZyk6IENsaXBGaWxlQXNzZXQgfCBudWxsIHtcbiAgY29uc3Qgam9iID0gZ2V0Sm9iKGpvYklkKTtcbiAgaWYgKCFqb2I/LnZpZGVvKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBjbGlwID0gam9iLmNsaXBzLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGNsaXBJZCk7XG4gIGlmICghY2xpcCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgZmlsZVBhdGggPSBnZXRDbGlwT3V0cHV0UGF0aChqb2JJZCwgY2xpcElkKTtcblxuICBpZiAoIWV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGZpbGVQYXRoLFxuICAgIGZpbGVuYW1lOiBgJHtqb2IudmlkZW8udmlkZW9JZH0tJHtjbGlwLmlkfS5tcDRgLFxuICAgIGNvbnRlbnRUeXBlOiBcInZpZGVvL21wNFwiLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbInJhbmRvbVVVSUQiLCJleGlzdHNTeW5jIiwicmVuZGVyVmlyYWxDbGlwcyIsImZpbmREb3dubG9hZGVkU291cmNlVmlkZW8iLCJnZXRDbGlwT3V0cHV0UGF0aCIsImVuc3VyZUpvYlN0b3JhZ2UiLCJ0cmFuc2NyaWJlWW91VHViZVZpZGVvIiwiZ2VuZXJhdGVWaXJhbEN1dHMiLCJwYXJzZVlvdVR1YmVVcmwiLCJkb3dubG9hZEF1dG9TdWJ0aXRsZXNWdHQiLCJkb3dubG9hZFZpZGVvRnJvbVlvdXR1YmUiLCJnZXRSdW50aW1lIiwiZ2xvYmFsVGhpcyIsIl9fdmlyYWxDdXRSdW50aW1lIiwiam9icyIsIk1hcCIsInF1ZXVlIiwiYWN0aXZlIiwiU2V0IiwiY29uY3VycmVuY3kiLCJwdW1wU2NoZWR1bGVkIiwibm93SXNvIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicHVzaExvZyIsImpvYiIsInN0YWdlIiwibWVzc2FnZSIsInRpbWVzdGFtcCIsImxvZ3MiLCJ1bnNoaWZ0IiwiYXQiLCJ1cGRhdGVkQXQiLCJjb25zb2xlIiwiaW5mbyIsImlkIiwidXBkYXRlU3RhZ2UiLCJwcm9ncmVzcyIsInNjaGVkdWxlUHVtcCIsInJ1bnRpbWUiLCJzZXRUaW1lb3V0IiwicHVtcFF1ZXVlIiwic2l6ZSIsImxlbmd0aCIsIm5leHQiLCJzaGlmdCIsImFkZCIsImpvYklkIiwicHJvY2Vzc0pvYiIsImNhdGNoIiwiZmluYWxseSIsImRlbGV0ZSIsImdldCIsImxvZyIsImlucHV0IiwieW91dHViZVVybCIsInBhcnNlZCIsIkVycm9yIiwidmlkZW9JZCIsImRvd25sb2FkZWQiLCJ1cmwiLCJjYW5vbmljYWxVcmwiLCJ2aWRlbyIsInN1YnRpdGxlVnR0UGF0aCIsInRyYW5zY3JpcHQiLCJzb3VyY2VWaWRlb1BhdGgiLCJrZXl3b3JkSGludHMiLCJrZXl3b3JkcyIsImRlc2NyaXB0aW9uSGludCIsImRlc2NyaXB0aW9uIiwic3VnZ2VzdGVkIiwidmlkZW9UaXRsZSIsInRpdGxlIiwic2VnbWVudHMiLCJkdXJhdGlvblNlYyIsInJlcXVlc3RlZEN1dHMiLCJjbGlwcyIsImVycm9yIiwiY3JlYXRlUHJvY2Vzc2luZ0pvYiIsImNyZWF0ZWRBdCIsInNldCIsInB1c2giLCJ0eXBlIiwibGlzdEpvYnMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwiZ2V0Sm9iIiwidXBkYXRlQ2xpcENvcHkiLCJjbGlwSWQiLCJwYXlsb2FkIiwiY2xpcEluZGV4IiwiZmluZEluZGV4IiwiY2xpcCIsImN1cnJlbnQiLCJ1cGRhdGVkIiwidHJhbnNjcmlwdFNuaXBwZXQiLCJyZWdlbmVyYXRlTW9yZUN1dHMiLCJkZXNpcmVkIiwiTWF0aCIsIm1pbiIsIm1heCIsImdlbmVyYXRlZCIsImV4aXN0aW5nU3RhcnRzIiwibWFwIiwicm91bmQiLCJzdGFydFNlYyIsImFkZGl0aW9ucyIsImZpbHRlciIsImhhcyIsInNsaWNlIiwiaW5kZXgiLCJyZW5kZXJlZCIsImdldENsaXBGaWxlQXNzZXQiLCJmaW5kIiwiaXRlbSIsImZpbGVQYXRoIiwiZmlsZW5hbWUiLCJjb250ZW50VHlwZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/queue.ts\n");

/***/ }),

/***/ "(rsc)/./lib/render.ts":
/*!***********************!*\
  !*** ./lib/render.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   renderViralClips: () => (/* binding */ renderViralClips)\n/* harmony export */ });\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_ffmpeg_bin__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/ffmpeg-bin */ \"(rsc)/./lib/ffmpeg-bin.ts\");\n/* harmony import */ var _lib_storage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/storage */ \"(rsc)/./lib/storage.ts\");\n\n\n\n\n\n\nconst execFileAsync = (0,node_util__WEBPACK_IMPORTED_MODULE_3__.promisify)(node_child_process__WEBPACK_IMPORTED_MODULE_0__.execFile);\nfunction formatTimestamp(seconds) {\n    const safe = Math.max(0, Math.floor(seconds));\n    const hh = String(Math.floor(safe / 3600)).padStart(2, \"0\");\n    const mm = String(Math.floor(safe % 3600 / 60)).padStart(2, \"0\");\n    const ss = String(safe % 60).padStart(2, \"0\");\n    return `${hh}:${mm}:${ss}`;\n}\nfunction formatAssTimestamp(seconds) {\n    const safe = Math.max(0, seconds);\n    const hours = Math.floor(safe / 3600);\n    const minutes = Math.floor(safe % 3600 / 60);\n    const wholeSeconds = Math.floor(safe % 60);\n    const centiseconds = Math.floor((safe - Math.floor(safe)) * 100);\n    return `${hours}:${String(minutes).padStart(2, \"0\")}:${String(wholeSeconds).padStart(2, \"0\")}.${String(centiseconds).padStart(2, \"0\")}`;\n}\nfunction escapeAssText(text) {\n    return text.replace(/\\\\/g, \"\\\\\\\\\").replace(/{/g, \"\\\\{\").replace(/}/g, \"\\\\}\").replace(/\\n/g, \"\\\\N\");\n}\nfunction buildFfmpegPlan(params) {\n    const { sourceVideoPath, subtitlePath, outputPath, clip } = params;\n    const videoFilter = `scale=1080:1920:force_original_aspect_ratio=increase,crop=1080:1920,ass=${subtitlePath}`;\n    return [\n        `ffmpeg -y -ss ${formatTimestamp(clip.startSec)} -to ${formatTimestamp(clip.endSec)} -i ${sourceVideoPath} -vf \"${videoFilter}\" -c:v libx264 -preset veryfast -crf 22 -c:a aac -movflags +faststart ${outputPath}`\n    ];\n}\nasync function writeAssSubtitle(params) {\n    const { clip, subtitlePath } = params;\n    const tokens = clip.subtitles.filter((token)=>token.time >= clip.startSec && token.time <= clip.endSec + 0.8).sort((a, b)=>a.time - b.time);\n    const lines = [];\n    if (tokens.length === 0) {\n        const fallbackText = clip.hookLine || clip.title;\n        lines.push(`Dialogue: 0,${formatAssTimestamp(0)},${formatAssTimestamp(Math.max(1.8, clip.durationSec - 0.2))},Caption,,0,0,80,,{\\\\b1}${escapeAssText(fallbackText)}`);\n    } else {\n        const groupSize = 4;\n        for(let index = 0; index < tokens.length; index += groupSize){\n            const group = tokens.slice(index, index + groupSize);\n            const next = tokens[index + groupSize];\n            const start = Math.max(0, group[0].time - clip.startSec);\n            const fallbackEnd = group[group.length - 1].time - clip.startSec + 0.9;\n            const end = Math.min(clip.durationSec, Math.max(start + 0.45, next ? next.time - clip.startSec : fallbackEnd));\n            const text = group.map((token)=>token.highlight ? `{\\\\c&H66FFFF&}${token.text}{\\\\c&HFFFFFF&}` : token.text).join(\" \");\n            lines.push(`Dialogue: 0,${formatAssTimestamp(start)},${formatAssTimestamp(end)},Caption,,0,0,80,,{\\\\b1}${escapeAssText(text)}`);\n        }\n    }\n    const ass = `[Script Info]\nTitle: ViralCut Caption\nScriptType: v4.00+\nWrapStyle: 2\nScaledBorderAndShadow: yes\nYCbCr Matrix: TV.709\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Caption,Arial,72,&H00FFFFFF,&H0000FFFF,&H00000000,&H40000000,-1,0,0,0,100,100,0,0,1,3,0,2,80,80,110,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n${lines.join(\"\\n\")}\n`;\n    await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.writeFile(subtitlePath, ass, \"utf8\");\n}\nasync function runFfmpeg(params) {\n    const { sourceVideoPath, clip, subtitleFileName, outputPath, workDir } = params;\n    const ffmpegBin = (0,_lib_ffmpeg_bin__WEBPACK_IMPORTED_MODULE_4__.getFfmpegBinaryPath)();\n    const filters = `scale=1080:1920:force_original_aspect_ratio=increase,crop=1080:1920,ass=${subtitleFileName}`;\n    await execFileAsync(ffmpegBin, [\n        \"-y\",\n        \"-ss\",\n        clip.startSec.toFixed(3),\n        \"-to\",\n        clip.endSec.toFixed(3),\n        \"-i\",\n        sourceVideoPath,\n        \"-vf\",\n        filters,\n        \"-c:v\",\n        \"libx264\",\n        \"-preset\",\n        \"veryfast\",\n        \"-crf\",\n        \"22\",\n        \"-c:a\",\n        \"aac\",\n        \"-b:a\",\n        \"128k\",\n        \"-movflags\",\n        \"+faststart\",\n        outputPath\n    ], {\n        cwd: workDir,\n        maxBuffer: 16 * 1024 * 1024\n    });\n}\nasync function renderViralClips(params) {\n    const { jobId, video, sourceVideoPath, clips, log } = params;\n    await (0,_lib_storage__WEBPACK_IMPORTED_MODULE_5__.ensureJobStorage)(jobId);\n    const { workDir } = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_5__.getJobStoragePaths)(jobId);\n    const rendered = [];\n    for (const clip of clips){\n        const outputPath = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_5__.getClipOutputPath)(jobId, clip.id);\n        const subtitlePath = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_5__.getClipSubtitlePath)(jobId, clip.id);\n        const subtitleFileName = node_path__WEBPACK_IMPORTED_MODULE_2___default().basename(subtitlePath);\n        log?.(`Renderizando corte ${clip.id} (${clip.durationSec}s)`);\n        await writeAssSubtitle({\n            clip,\n            subtitlePath\n        });\n        await runFfmpeg({\n            sourceVideoPath,\n            clip,\n            subtitleFileName,\n            outputPath,\n            workDir\n        });\n        const ffmpegPlan = buildFfmpegPlan({\n            sourceVideoPath,\n            subtitlePath,\n            outputPath,\n            clip\n        });\n        rendered.push({\n            ...clip,\n            ffmpegPlan,\n            previewUrl: `/api/jobs/${jobId}/clips/${clip.id}/stream`,\n            downloadUrl: `/api/jobs/${jobId}/clips/${clip.id}/download`\n        });\n    }\n    log?.(`Renderização finalizada: ${rendered.length} cortes reais`);\n    return rendered;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUI7WUFBRUo7WUFBTUY7UUFBYTtRQUU1QyxNQUFNb0MsVUFBVTtZQUNkckM7WUFDQUc7WUFDQW1DO1lBQ0FwQztZQUNBcUM7UUFDRjtRQUVBLE1BQU1jLGFBQWF2RCxnQkFBZ0I7WUFDakNFO1lBQ0FDO1lBQ0FDO1lBQ0FDO1FBQ0Y7UUFFQStDLFNBQVM3QixJQUFJLENBQUM7WUFDWixHQUFHbEIsSUFBSTtZQUNQa0Q7WUFDQUMsWUFBWSxDQUFDLFVBQVUsRUFBRVIsTUFBTSxPQUFPLEVBQUUzQyxLQUFLZ0QsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUN4REksYUFBYSxDQUFDLFVBQVUsRUFBRVQsTUFBTSxPQUFPLEVBQUUzQyxLQUFLZ0QsRUFBRSxDQUFDLFNBQVMsQ0FBQztRQUM3RDtJQUNGO0lBRUFGLE1BQU0sQ0FBQyx5QkFBeUIsRUFBRUMsU0FBU2pDLE1BQU0sQ0FBQyxhQUFhLENBQUM7SUFFaEUsT0FBT2lDO0FBQ1QiLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbG1laWRhZ2FicmllbC9Eb2N1bWVudHMvQ0FOQS9saWIvcmVuZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWNGaWxlIH0gZnJvbSBcIm5vZGU6Y2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tIFwibm9kZTpmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcIm5vZGU6dXRpbFwiO1xuXG5pbXBvcnQgeyBnZXRGZm1wZWdCaW5hcnlQYXRoIH0gZnJvbSBcIkAvbGliL2ZmbXBlZy1iaW5cIjtcbmltcG9ydCB7IGVuc3VyZUpvYlN0b3JhZ2UsIGdldENsaXBPdXRwdXRQYXRoLCBnZXRDbGlwU3VidGl0bGVQYXRoLCBnZXRKb2JTdG9yYWdlUGF0aHMgfSBmcm9tIFwiQC9saWIvc3RvcmFnZVwiO1xuaW1wb3J0IHsgVmlyYWxDbGlwLCBZb3VUdWJlVmlkZW9NZXRhIH0gZnJvbSBcIkAvbGliL3R5cGVzXCI7XG5cbmNvbnN0IGV4ZWNGaWxlQXN5bmMgPSBwcm9taXNpZnkoZXhlY0ZpbGUpO1xuXG5mdW5jdGlvbiBmb3JtYXRUaW1lc3RhbXAoc2Vjb25kczogbnVtYmVyKTogc3RyaW5nIHtcbiAgY29uc3Qgc2FmZSA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3Ioc2Vjb25kcykpO1xuICBjb25zdCBoaCA9IFN0cmluZyhNYXRoLmZsb29yKHNhZmUgLyAzNjAwKSkucGFkU3RhcnQoMiwgXCIwXCIpO1xuICBjb25zdCBtbSA9IFN0cmluZyhNYXRoLmZsb29yKChzYWZlICUgMzYwMCkgLyA2MCkpLnBhZFN0YXJ0KDIsIFwiMFwiKTtcbiAgY29uc3Qgc3MgPSBTdHJpbmcoc2FmZSAlIDYwKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gIHJldHVybiBgJHtoaH06JHttbX06JHtzc31gO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRBc3NUaW1lc3RhbXAoc2Vjb25kczogbnVtYmVyKTogc3RyaW5nIHtcbiAgY29uc3Qgc2FmZSA9IE1hdGgubWF4KDAsIHNlY29uZHMpO1xuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3Ioc2FmZSAvIDM2MDApO1xuICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2FmZSAlIDM2MDApIC8gNjApO1xuICBjb25zdCB3aG9sZVNlY29uZHMgPSBNYXRoLmZsb29yKHNhZmUgJSA2MCk7XG4gIGNvbnN0IGNlbnRpc2Vjb25kcyA9IE1hdGguZmxvb3IoKHNhZmUgLSBNYXRoLmZsb29yKHNhZmUpKSAqIDEwMCk7XG4gIHJldHVybiBgJHtob3Vyc306JHtTdHJpbmcobWludXRlcykucGFkU3RhcnQoMiwgXCIwXCIpfToke1N0cmluZyh3aG9sZVNlY29uZHMpLnBhZFN0YXJ0KDIsIFwiMFwiKX0uJHtTdHJpbmcoXG4gICAgY2VudGlzZWNvbmRzXG4gICkucGFkU3RhcnQoMiwgXCIwXCIpfWA7XG59XG5cbmZ1bmN0aW9uIGVzY2FwZUFzc1RleHQodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHRleHQucmVwbGFjZSgvXFxcXC9nLCBcIlxcXFxcXFxcXCIpLnJlcGxhY2UoL3svZywgXCJcXFxce1wiKS5yZXBsYWNlKC99L2csIFwiXFxcXH1cIikucmVwbGFjZSgvXFxuL2csIFwiXFxcXE5cIik7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRmZtcGVnUGxhbihwYXJhbXM6IHtcbiAgc291cmNlVmlkZW9QYXRoOiBzdHJpbmc7XG4gIHN1YnRpdGxlUGF0aDogc3RyaW5nO1xuICBvdXRwdXRQYXRoOiBzdHJpbmc7XG4gIGNsaXA6IFZpcmFsQ2xpcDtcbn0pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHsgc291cmNlVmlkZW9QYXRoLCBzdWJ0aXRsZVBhdGgsIG91dHB1dFBhdGgsIGNsaXAgfSA9IHBhcmFtcztcblxuICBjb25zdCB2aWRlb0ZpbHRlciA9IGBzY2FsZT0xMDgwOjE5MjA6Zm9yY2Vfb3JpZ2luYWxfYXNwZWN0X3JhdGlvPWluY3JlYXNlLGNyb3A9MTA4MDoxOTIwLGFzcz0ke3N1YnRpdGxlUGF0aH1gO1xuXG4gIHJldHVybiBbXG4gICAgYGZmbXBlZyAteSAtc3MgJHtmb3JtYXRUaW1lc3RhbXAoY2xpcC5zdGFydFNlYyl9IC10byAke2Zvcm1hdFRpbWVzdGFtcChjbGlwLmVuZFNlYyl9IC1pICR7c291cmNlVmlkZW9QYXRofSAtdmYgXCIke3ZpZGVvRmlsdGVyfVwiIC1jOnYgbGlieDI2NCAtcHJlc2V0IHZlcnlmYXN0IC1jcmYgMjIgLWM6YSBhYWMgLW1vdmZsYWdzICtmYXN0c3RhcnQgJHtvdXRwdXRQYXRofWAsXG4gIF07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXNzU3VidGl0bGUocGFyYW1zOiB7IGNsaXA6IFZpcmFsQ2xpcDsgc3VidGl0bGVQYXRoOiBzdHJpbmcgfSkge1xuICBjb25zdCB7IGNsaXAsIHN1YnRpdGxlUGF0aCB9ID0gcGFyYW1zO1xuXG4gIGNvbnN0IHRva2VucyA9IGNsaXAuc3VidGl0bGVzXG4gICAgLmZpbHRlcigodG9rZW4pID0+IHRva2VuLnRpbWUgPj0gY2xpcC5zdGFydFNlYyAmJiB0b2tlbi50aW1lIDw9IGNsaXAuZW5kU2VjICsgMC44KVxuICAgIC5zb3J0KChhLCBiKSA9PiBhLnRpbWUgLSBiLnRpbWUpO1xuXG4gIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGlmICh0b2tlbnMubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc3QgZmFsbGJhY2tUZXh0ID0gY2xpcC5ob29rTGluZSB8fCBjbGlwLnRpdGxlO1xuICAgIGxpbmVzLnB1c2goXG4gICAgICBgRGlhbG9ndWU6IDAsJHtmb3JtYXRBc3NUaW1lc3RhbXAoMCl9LCR7Zm9ybWF0QXNzVGltZXN0YW1wKE1hdGgubWF4KDEuOCwgY2xpcC5kdXJhdGlvblNlYyAtIDAuMikpfSxDYXB0aW9uLCwwLDAsODAsLHtcXFxcYjF9JHtlc2NhcGVBc3NUZXh0KFxuICAgICAgICBmYWxsYmFja1RleHRcbiAgICAgICl9YFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZ3JvdXBTaXplID0gNDtcblxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0b2tlbnMubGVuZ3RoOyBpbmRleCArPSBncm91cFNpemUpIHtcbiAgICAgIGNvbnN0IGdyb3VwID0gdG9rZW5zLnNsaWNlKGluZGV4LCBpbmRleCArIGdyb3VwU2l6ZSk7XG4gICAgICBjb25zdCBuZXh0ID0gdG9rZW5zW2luZGV4ICsgZ3JvdXBTaXplXTtcblxuICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBncm91cFswXS50aW1lIC0gY2xpcC5zdGFydFNlYyk7XG4gICAgICBjb25zdCBmYWxsYmFja0VuZCA9IGdyb3VwW2dyb3VwLmxlbmd0aCAtIDFdLnRpbWUgLSBjbGlwLnN0YXJ0U2VjICsgMC45O1xuICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oXG4gICAgICAgIGNsaXAuZHVyYXRpb25TZWMsXG4gICAgICAgIE1hdGgubWF4KHN0YXJ0ICsgMC40NSwgbmV4dCA/IG5leHQudGltZSAtIGNsaXAuc3RhcnRTZWMgOiBmYWxsYmFja0VuZClcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSBncm91cFxuICAgICAgICAubWFwKCh0b2tlbikgPT4gKHRva2VuLmhpZ2hsaWdodCA/IGB7XFxcXGMmSDY2RkZGRiZ9JHt0b2tlbi50ZXh0fXtcXFxcYyZIRkZGRkZGJn1gIDogdG9rZW4udGV4dCkpXG4gICAgICAgIC5qb2luKFwiIFwiKTtcblxuICAgICAgbGluZXMucHVzaChcbiAgICAgICAgYERpYWxvZ3VlOiAwLCR7Zm9ybWF0QXNzVGltZXN0YW1wKHN0YXJ0KX0sJHtmb3JtYXRBc3NUaW1lc3RhbXAoZW5kKX0sQ2FwdGlvbiwsMCwwLDgwLCx7XFxcXGIxfSR7ZXNjYXBlQXNzVGV4dChcbiAgICAgICAgICB0ZXh0XG4gICAgICAgICl9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBhc3MgPSBgW1NjcmlwdCBJbmZvXVxuVGl0bGU6IFZpcmFsQ3V0IENhcHRpb25cblNjcmlwdFR5cGU6IHY0LjAwK1xuV3JhcFN0eWxlOiAyXG5TY2FsZWRCb3JkZXJBbmRTaGFkb3c6IHllc1xuWUNiQ3IgTWF0cml4OiBUVi43MDlcblxuW1Y0KyBTdHlsZXNdXG5Gb3JtYXQ6IE5hbWUsIEZvbnRuYW1lLCBGb250c2l6ZSwgUHJpbWFyeUNvbG91ciwgU2Vjb25kYXJ5Q29sb3VyLCBPdXRsaW5lQ29sb3VyLCBCYWNrQ29sb3VyLCBCb2xkLCBJdGFsaWMsIFVuZGVybGluZSwgU3RyaWtlT3V0LCBTY2FsZVgsIFNjYWxlWSwgU3BhY2luZywgQW5nbGUsIEJvcmRlclN0eWxlLCBPdXRsaW5lLCBTaGFkb3csIEFsaWdubWVudCwgTWFyZ2luTCwgTWFyZ2luUiwgTWFyZ2luViwgRW5jb2RpbmdcblN0eWxlOiBDYXB0aW9uLEFyaWFsLDcyLCZIMDBGRkZGRkYsJkgwMDAwRkZGRiwmSDAwMDAwMDAwLCZINDAwMDAwMDAsLTEsMCwwLDAsMTAwLDEwMCwwLDAsMSwzLDAsMiw4MCw4MCwxMTAsMVxuXG5bRXZlbnRzXVxuRm9ybWF0OiBMYXllciwgU3RhcnQsIEVuZCwgU3R5bGUsIE5hbWUsIE1hcmdpbkwsIE1hcmdpblIsIE1hcmdpblYsIEVmZmVjdCwgVGV4dFxuJHtsaW5lcy5qb2luKFwiXFxuXCIpfVxuYDtcblxuICBhd2FpdCBmcy53cml0ZUZpbGUoc3VidGl0bGVQYXRoLCBhc3MsIFwidXRmOFwiKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcnVuRmZtcGVnKHBhcmFtczoge1xuICBzb3VyY2VWaWRlb1BhdGg6IHN0cmluZztcbiAgY2xpcDogVmlyYWxDbGlwO1xuICBzdWJ0aXRsZUZpbGVOYW1lOiBzdHJpbmc7XG4gIG91dHB1dFBhdGg6IHN0cmluZztcbiAgd29ya0Rpcjogc3RyaW5nO1xufSkge1xuICBjb25zdCB7IHNvdXJjZVZpZGVvUGF0aCwgY2xpcCwgc3VidGl0bGVGaWxlTmFtZSwgb3V0cHV0UGF0aCwgd29ya0RpciB9ID0gcGFyYW1zO1xuXG4gIGNvbnN0IGZmbXBlZ0JpbiA9IGdldEZmbXBlZ0JpbmFyeVBhdGgoKTtcblxuICBjb25zdCBmaWx0ZXJzID0gYHNjYWxlPTEwODA6MTkyMDpmb3JjZV9vcmlnaW5hbF9hc3BlY3RfcmF0aW89aW5jcmVhc2UsY3JvcD0xMDgwOjE5MjAsYXNzPSR7c3VidGl0bGVGaWxlTmFtZX1gO1xuXG4gIGF3YWl0IGV4ZWNGaWxlQXN5bmMoXG4gICAgZmZtcGVnQmluLFxuICAgIFtcbiAgICAgIFwiLXlcIixcbiAgICAgIFwiLXNzXCIsXG4gICAgICBjbGlwLnN0YXJ0U2VjLnRvRml4ZWQoMyksXG4gICAgICBcIi10b1wiLFxuICAgICAgY2xpcC5lbmRTZWMudG9GaXhlZCgzKSxcbiAgICAgIFwiLWlcIixcbiAgICAgIHNvdXJjZVZpZGVvUGF0aCxcbiAgICAgIFwiLXZmXCIsXG4gICAgICBmaWx0ZXJzLFxuICAgICAgXCItYzp2XCIsXG4gICAgICBcImxpYngyNjRcIixcbiAgICAgIFwiLXByZXNldFwiLFxuICAgICAgXCJ2ZXJ5ZmFzdFwiLFxuICAgICAgXCItY3JmXCIsXG4gICAgICBcIjIyXCIsXG4gICAgICBcIi1jOmFcIixcbiAgICAgIFwiYWFjXCIsXG4gICAgICBcIi1iOmFcIixcbiAgICAgIFwiMTI4a1wiLFxuICAgICAgXCItbW92ZmxhZ3NcIixcbiAgICAgIFwiK2Zhc3RzdGFydFwiLFxuICAgICAgb3V0cHV0UGF0aCxcbiAgICBdLFxuICAgIHsgY3dkOiB3b3JrRGlyLCBtYXhCdWZmZXI6IDE2ICogMTAyNCAqIDEwMjQgfVxuICApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyVmlyYWxDbGlwcyhwYXJhbXM6IHtcbiAgam9iSWQ6IHN0cmluZztcbiAgdmlkZW86IFlvdVR1YmVWaWRlb01ldGE7XG4gIHNvdXJjZVZpZGVvUGF0aDogc3RyaW5nO1xuICBjbGlwczogVmlyYWxDbGlwW107XG4gIGxvZz86IChtZXNzYWdlOiBzdHJpbmcpID0+IHZvaWQ7XG59KTogUHJvbWlzZTxWaXJhbENsaXBbXT4ge1xuICBjb25zdCB7IGpvYklkLCB2aWRlbywgc291cmNlVmlkZW9QYXRoLCBjbGlwcywgbG9nIH0gPSBwYXJhbXM7XG5cbiAgYXdhaXQgZW5zdXJlSm9iU3RvcmFnZShqb2JJZCk7XG4gIGNvbnN0IHsgd29ya0RpciB9ID0gZ2V0Sm9iU3RvcmFnZVBhdGhzKGpvYklkKTtcblxuICBjb25zdCByZW5kZXJlZDogVmlyYWxDbGlwW10gPSBbXTtcblxuICBmb3IgKGNvbnN0IGNsaXAgb2YgY2xpcHMpIHtcbiAgICBjb25zdCBvdXRwdXRQYXRoID0gZ2V0Q2xpcE91dHB1dFBhdGgoam9iSWQsIGNsaXAuaWQpO1xuICAgIGNvbnN0IHN1YnRpdGxlUGF0aCA9IGdldENsaXBTdWJ0aXRsZVBhdGgoam9iSWQsIGNsaXAuaWQpO1xuICAgIGNvbnN0IHN1YnRpdGxlRmlsZU5hbWUgPSBwYXRoLmJhc2VuYW1lKHN1YnRpdGxlUGF0aCk7XG5cbiAgICBsb2c/LihgUmVuZGVyaXphbmRvIGNvcnRlICR7Y2xpcC5pZH0gKCR7Y2xpcC5kdXJhdGlvblNlY31zKWApO1xuXG4gICAgYXdhaXQgd3JpdGVBc3NTdWJ0aXRsZSh7IGNsaXAsIHN1YnRpdGxlUGF0aCB9KTtcblxuICAgIGF3YWl0IHJ1bkZmbXBlZyh7XG4gICAgICBzb3VyY2VWaWRlb1BhdGgsXG4gICAgICBjbGlwLFxuICAgICAgc3VidGl0bGVGaWxlTmFtZSxcbiAgICAgIG91dHB1dFBhdGgsXG4gICAgICB3b3JrRGlyLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZmZtcGVnUGxhbiA9IGJ1aWxkRmZtcGVnUGxhbih7XG4gICAgICBzb3VyY2VWaWRlb1BhdGgsXG4gICAgICBzdWJ0aXRsZVBhdGgsXG4gICAgICBvdXRwdXRQYXRoLFxuICAgICAgY2xpcCxcbiAgICB9KTtcblxuICAgIHJlbmRlcmVkLnB1c2goe1xuICAgICAgLi4uY2xpcCxcbiAgICAgIGZmbXBlZ1BsYW4sXG4gICAgICBwcmV2aWV3VXJsOiBgL2FwaS9qb2JzLyR7am9iSWR9L2NsaXBzLyR7Y2xpcC5pZH0vc3RyZWFtYCxcbiAgICAgIGRvd25sb2FkVXJsOiBgL2FwaS9qb2JzLyR7am9iSWR9L2NsaXBzLyR7Y2xpcC5pZH0vZG93bmxvYWRgLFxuICAgIH0pO1xuICB9XG5cbiAgbG9nPy4oYFJlbmRlcml6YcOnw6NvIGZpbmFsaXphZGE6ICR7cmVuZGVyZWQubGVuZ3RofSBjb3J0ZXMgcmVhaXNgKTtcblxuICByZXR1cm4gcmVuZGVyZWQ7XG59XG4iXSwibmFtZXMiOlsiZXhlY0ZpbGUiLCJwcm9taXNlcyIsImZzIiwicGF0aCIsInByb21pc2lmeSIsImdldEZmbXBlZ0JpbmFyeVBhdGgiLCJlbnN1cmVKb2JTdG9yYWdlIiwiZ2V0Q2xpcE91dHB1dFBhdGgiLCJnZXRDbGlwU3VidGl0bGVQYXRoIiwiZ2V0Sm9iU3RvcmFnZVBhdGhzIiwiZXhlY0ZpbGVBc3luYyIsImZvcm1hdFRpbWVzdGFtcCIsInNlY29uZHMiLCJzYWZlIiwiTWF0aCIsIm1heCIsImZsb29yIiwiaGgiLCJTdHJpbmciLCJwYWRTdGFydCIsIm1tIiwic3MiLCJmb3JtYXRBc3NUaW1lc3RhbXAiLCJob3VycyIsIm1pbnV0ZXMiLCJ3aG9sZVNlY29uZHMiLCJjZW50aXNlY29uZHMiLCJlc2NhcGVBc3NUZXh0IiwidGV4dCIsInJlcGxhY2UiLCJidWlsZEZmbXBlZ1BsYW4iLCJwYXJhbXMiLCJzb3VyY2VWaWRlb1BhdGgiLCJzdWJ0aXRsZVBhdGgiLCJvdXRwdXRQYXRoIiwiY2xpcCIsInZpZGVvRmlsdGVyIiwic3RhcnRTZWMiLCJlbmRTZWMiLCJ3cml0ZUFzc1N1YnRpdGxlIiwidG9rZW5zIiwic3VidGl0bGVzIiwiZmlsdGVyIiwidG9rZW4iLCJ0aW1lIiwic29ydCIsImEiLCJiIiwibGluZXMiLCJsZW5ndGgiLCJmYWxsYmFja1RleHQiLCJob29rTGluZSIsInRpdGxlIiwicHVzaCIsImR1cmF0aW9uU2VjIiwiZ3JvdXBTaXplIiwiaW5kZXgiLCJncm91cCIsInNsaWNlIiwibmV4dCIsInN0YXJ0IiwiZmFsbGJhY2tFbmQiLCJlbmQiLCJtaW4iLCJtYXAiLCJoaWdobGlnaHQiLCJqb2luIiwiYXNzIiwid3JpdGVGaWxlIiwicnVuRmZtcGVnIiwic3VidGl0bGVGaWxlTmFtZSIsIndvcmtEaXIiLCJmZm1wZWdCaW4iLCJmaWx0ZXJzIiwidG9GaXhlZCIsImN3ZCIsIm1heEJ1ZmZlciIsInJlbmRlclZpcmFsQ2xpcHMiLCJqb2JJZCIsInZpZGVvIiwiY2xpcHMiLCJsb2ciLCJyZW5kZXJlZCIsImlkIiwiYmFzZW5hbWUiLCJmZm1wZWdQbGFuIiwicHJldmlld1VybCIsImRvd25sb2FkVXJsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/render.ts\n");

/***/ }),

/***/ "(rsc)/./lib/storage.ts":
/*!************************!*\
  !*** ./lib/storage.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JOB_STORAGE_ROOT: () => (/* binding */ JOB_STORAGE_ROOT),\n/* harmony export */   ensureJobStorage: () => (/* binding */ ensureJobStorage),\n/* harmony export */   fileExists: () => (/* binding */ fileExists),\n/* harmony export */   findDownloadedSourceVideo: () => (/* binding */ findDownloadedSourceVideo),\n/* harmony export */   getAudioPcmPath: () => (/* binding */ getAudioPcmPath),\n/* harmony export */   getClipOutputPath: () => (/* binding */ getClipOutputPath),\n/* harmony export */   getClipSubtitlePath: () => (/* binding */ getClipSubtitlePath),\n/* harmony export */   getJobStoragePaths: () => (/* binding */ getJobStoragePaths)\n/* harmony export */ });\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst VIDEO_EXTENSIONS = new Set([\n    \".mp4\",\n    \".mov\",\n    \".mkv\",\n    \".webm\",\n    \".m4v\"\n]);\nconst JOB_STORAGE_ROOT = node_path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"storage\", \"jobs\");\nfunction getJobStoragePaths(jobId) {\n    const jobDir = node_path__WEBPACK_IMPORTED_MODULE_1___default().join(JOB_STORAGE_ROOT, jobId);\n    return {\n        jobDir,\n        clipsDir: node_path__WEBPACK_IMPORTED_MODULE_1___default().join(jobDir, \"clips\"),\n        workDir: node_path__WEBPACK_IMPORTED_MODULE_1___default().join(jobDir, \"work\"),\n        sourceTemplate: node_path__WEBPACK_IMPORTED_MODULE_1___default().join(jobDir, \"source.%(ext)s\"),\n        sourcePrefix: node_path__WEBPACK_IMPORTED_MODULE_1___default().join(jobDir, \"source\")\n    };\n}\nasync function ensureJobStorage(jobId) {\n    const paths = getJobStoragePaths(jobId);\n    await node_fs__WEBPACK_IMPORTED_MODULE_0__.promises.mkdir(paths.clipsDir, {\n        recursive: true\n    });\n    await node_fs__WEBPACK_IMPORTED_MODULE_0__.promises.mkdir(paths.workDir, {\n        recursive: true\n    });\n    return paths;\n}\nasync function findDownloadedSourceVideo(jobId) {\n    const paths = getJobStoragePaths(jobId);\n    let entries = [];\n    try {\n        entries = await node_fs__WEBPACK_IMPORTED_MODULE_0__.promises.readdir(paths.jobDir);\n    } catch  {\n        return null;\n    }\n    const candidate = entries.filter((entry)=>entry.startsWith(\"source.\")).find((entry)=>VIDEO_EXTENSIONS.has(node_path__WEBPACK_IMPORTED_MODULE_1___default().extname(entry).toLowerCase()));\n    if (!candidate) {\n        return null;\n    }\n    return node_path__WEBPACK_IMPORTED_MODULE_1___default().join(paths.jobDir, candidate);\n}\nfunction getClipOutputPath(jobId, clipId) {\n    const { clipsDir } = getJobStoragePaths(jobId);\n    return node_path__WEBPACK_IMPORTED_MODULE_1___default().join(clipsDir, `${clipId}.mp4`);\n}\nfunction getClipSubtitlePath(jobId, clipId) {\n    const { workDir } = getJobStoragePaths(jobId);\n    return node_path__WEBPACK_IMPORTED_MODULE_1___default().join(workDir, `${clipId}.ass`);\n}\nfunction getAudioPcmPath(jobId) {\n    const { workDir } = getJobStoragePaths(jobId);\n    return node_path__WEBPACK_IMPORTED_MODULE_1___default().join(workDir, \"audio-16k-mono.pcm\");\n}\nasync function fileExists(filePath) {\n    try {\n        await node_fs__WEBPACK_IMPORTED_MODULE_0__.promises.access(filePath);\n        return true;\n    } catch  {\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3RvcmFnZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBeUM7QUFDWjtBQUU3QixNQUFNRyxtQkFBbUIsSUFBSUMsSUFBSTtJQUFDO0lBQVE7SUFBUTtJQUFRO0lBQVM7Q0FBTztBQUVuRSxNQUFNQyxtQkFBbUJILHFEQUFTLENBQUNLLFFBQVFDLEdBQUcsSUFBSSxXQUFXLFFBQVE7QUFVckUsU0FBU0MsbUJBQW1CQyxLQUFhO0lBQzlDLE1BQU1DLFNBQVNULHFEQUFTLENBQUNHLGtCQUFrQks7SUFDM0MsT0FBTztRQUNMQztRQUNBQyxVQUFVVixxREFBUyxDQUFDUyxRQUFRO1FBQzVCRSxTQUFTWCxxREFBUyxDQUFDUyxRQUFRO1FBQzNCRyxnQkFBZ0JaLHFEQUFTLENBQUNTLFFBQVE7UUFDbENJLGNBQWNiLHFEQUFTLENBQUNTLFFBQVE7SUFDbEM7QUFDRjtBQUVPLGVBQWVLLGlCQUFpQk4sS0FBYTtJQUNsRCxNQUFNTyxRQUFRUixtQkFBbUJDO0lBQ2pDLE1BQU1ULDZDQUFFQSxDQUFDaUIsS0FBSyxDQUFDRCxNQUFNTCxRQUFRLEVBQUU7UUFBRU8sV0FBVztJQUFLO0lBQ2pELE1BQU1sQiw2Q0FBRUEsQ0FBQ2lCLEtBQUssQ0FBQ0QsTUFBTUosT0FBTyxFQUFFO1FBQUVNLFdBQVc7SUFBSztJQUNoRCxPQUFPRjtBQUNUO0FBRU8sZUFBZUcsMEJBQTBCVixLQUFhO0lBQzNELE1BQU1PLFFBQVFSLG1CQUFtQkM7SUFFakMsSUFBSVcsVUFBb0IsRUFBRTtJQUMxQixJQUFJO1FBQ0ZBLFVBQVUsTUFBTXBCLDZDQUFFQSxDQUFDcUIsT0FBTyxDQUFDTCxNQUFNTixNQUFNO0lBQ3pDLEVBQUUsT0FBTTtRQUNOLE9BQU87SUFDVDtJQUVBLE1BQU1ZLFlBQVlGLFFBQ2ZHLE1BQU0sQ0FBQyxDQUFDQyxRQUFVQSxNQUFNQyxVQUFVLENBQUMsWUFDbkNDLElBQUksQ0FBQyxDQUFDRixRQUFVdEIsaUJBQWlCeUIsR0FBRyxDQUFDMUIsd0RBQVksQ0FBQ3VCLE9BQU9LLFdBQVc7SUFFdkUsSUFBSSxDQUFDUCxXQUFXO1FBQ2QsT0FBTztJQUNUO0lBRUEsT0FBT3JCLHFEQUFTLENBQUNlLE1BQU1OLE1BQU0sRUFBRVk7QUFDakM7QUFFTyxTQUFTUSxrQkFBa0JyQixLQUFhLEVBQUVzQixNQUFjO0lBQzdELE1BQU0sRUFBRXBCLFFBQVEsRUFBRSxHQUFHSCxtQkFBbUJDO0lBQ3hDLE9BQU9SLHFEQUFTLENBQUNVLFVBQVUsR0FBR29CLE9BQU8sSUFBSSxDQUFDO0FBQzVDO0FBRU8sU0FBU0Msb0JBQW9CdkIsS0FBYSxFQUFFc0IsTUFBYztJQUMvRCxNQUFNLEVBQUVuQixPQUFPLEVBQUUsR0FBR0osbUJBQW1CQztJQUN2QyxPQUFPUixxREFBUyxDQUFDVyxTQUFTLEdBQUdtQixPQUFPLElBQUksQ0FBQztBQUMzQztBQUVPLFNBQVNFLGdCQUFnQnhCLEtBQWE7SUFDM0MsTUFBTSxFQUFFRyxPQUFPLEVBQUUsR0FBR0osbUJBQW1CQztJQUN2QyxPQUFPUixxREFBUyxDQUFDVyxTQUFTO0FBQzVCO0FBRU8sZUFBZXNCLFdBQVdDLFFBQWdCO0lBQy9DLElBQUk7UUFDRixNQUFNbkMsNkNBQUVBLENBQUNvQyxNQUFNLENBQUNEO1FBQ2hCLE9BQU87SUFDVCxFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2FsbWVpZGFnYWJyaWVsL0RvY3VtZW50cy9DQU5BL2xpYi9zdG9yYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByb21pc2VzIGFzIGZzIH0gZnJvbSBcIm5vZGU6ZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJub2RlOnBhdGhcIjtcblxuY29uc3QgVklERU9fRVhURU5TSU9OUyA9IG5ldyBTZXQoW1wiLm1wNFwiLCBcIi5tb3ZcIiwgXCIubWt2XCIsIFwiLndlYm1cIiwgXCIubTR2XCJdKTtcblxuZXhwb3J0IGNvbnN0IEpPQl9TVE9SQUdFX1JPT1QgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJzdG9yYWdlXCIsIFwiam9ic1wiKTtcblxuZXhwb3J0IGludGVyZmFjZSBKb2JTdG9yYWdlUGF0aHMge1xuICBqb2JEaXI6IHN0cmluZztcbiAgY2xpcHNEaXI6IHN0cmluZztcbiAgd29ya0Rpcjogc3RyaW5nO1xuICBzb3VyY2VUZW1wbGF0ZTogc3RyaW5nO1xuICBzb3VyY2VQcmVmaXg6IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEpvYlN0b3JhZ2VQYXRocyhqb2JJZDogc3RyaW5nKTogSm9iU3RvcmFnZVBhdGhzIHtcbiAgY29uc3Qgam9iRGlyID0gcGF0aC5qb2luKEpPQl9TVE9SQUdFX1JPT1QsIGpvYklkKTtcbiAgcmV0dXJuIHtcbiAgICBqb2JEaXIsXG4gICAgY2xpcHNEaXI6IHBhdGguam9pbihqb2JEaXIsIFwiY2xpcHNcIiksXG4gICAgd29ya0RpcjogcGF0aC5qb2luKGpvYkRpciwgXCJ3b3JrXCIpLFxuICAgIHNvdXJjZVRlbXBsYXRlOiBwYXRoLmpvaW4oam9iRGlyLCBcInNvdXJjZS4lKGV4dClzXCIpLFxuICAgIHNvdXJjZVByZWZpeDogcGF0aC5qb2luKGpvYkRpciwgXCJzb3VyY2VcIiksXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVKb2JTdG9yYWdlKGpvYklkOiBzdHJpbmcpOiBQcm9taXNlPEpvYlN0b3JhZ2VQYXRocz4ge1xuICBjb25zdCBwYXRocyA9IGdldEpvYlN0b3JhZ2VQYXRocyhqb2JJZCk7XG4gIGF3YWl0IGZzLm1rZGlyKHBhdGhzLmNsaXBzRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgYXdhaXQgZnMubWtkaXIocGF0aHMud29ya0RpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIHJldHVybiBwYXRocztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmREb3dubG9hZGVkU291cmNlVmlkZW8oam9iSWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICBjb25zdCBwYXRocyA9IGdldEpvYlN0b3JhZ2VQYXRocyhqb2JJZCk7XG5cbiAgbGV0IGVudHJpZXM6IHN0cmluZ1tdID0gW107XG4gIHRyeSB7XG4gICAgZW50cmllcyA9IGF3YWl0IGZzLnJlYWRkaXIocGF0aHMuam9iRGlyKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBjYW5kaWRhdGUgPSBlbnRyaWVzXG4gICAgLmZpbHRlcigoZW50cnkpID0+IGVudHJ5LnN0YXJ0c1dpdGgoXCJzb3VyY2UuXCIpKVxuICAgIC5maW5kKChlbnRyeSkgPT4gVklERU9fRVhURU5TSU9OUy5oYXMocGF0aC5leHRuYW1lKGVudHJ5KS50b0xvd2VyQ2FzZSgpKSk7XG5cbiAgaWYgKCFjYW5kaWRhdGUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBwYXRoLmpvaW4ocGF0aHMuam9iRGlyLCBjYW5kaWRhdGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpcE91dHB1dFBhdGgoam9iSWQ6IHN0cmluZywgY2xpcElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCB7IGNsaXBzRGlyIH0gPSBnZXRKb2JTdG9yYWdlUGF0aHMoam9iSWQpO1xuICByZXR1cm4gcGF0aC5qb2luKGNsaXBzRGlyLCBgJHtjbGlwSWR9Lm1wNGApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpcFN1YnRpdGxlUGF0aChqb2JJZDogc3RyaW5nLCBjbGlwSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHsgd29ya0RpciB9ID0gZ2V0Sm9iU3RvcmFnZVBhdGhzKGpvYklkKTtcbiAgcmV0dXJuIHBhdGguam9pbih3b3JrRGlyLCBgJHtjbGlwSWR9LmFzc2ApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXVkaW9QY21QYXRoKGpvYklkOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCB7IHdvcmtEaXIgfSA9IGdldEpvYlN0b3JhZ2VQYXRocyhqb2JJZCk7XG4gIHJldHVybiBwYXRoLmpvaW4od29ya0RpciwgXCJhdWRpby0xNmstbW9uby5wY21cIik7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaWxlRXhpc3RzKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5hY2Nlc3MoZmlsZVBhdGgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcm9taXNlcyIsImZzIiwicGF0aCIsIlZJREVPX0VYVEVOU0lPTlMiLCJTZXQiLCJKT0JfU1RPUkFHRV9ST09UIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJnZXRKb2JTdG9yYWdlUGF0aHMiLCJqb2JJZCIsImpvYkRpciIsImNsaXBzRGlyIiwid29ya0RpciIsInNvdXJjZVRlbXBsYXRlIiwic291cmNlUHJlZml4IiwiZW5zdXJlSm9iU3RvcmFnZSIsInBhdGhzIiwibWtkaXIiLCJyZWN1cnNpdmUiLCJmaW5kRG93bmxvYWRlZFNvdXJjZVZpZGVvIiwiZW50cmllcyIsInJlYWRkaXIiLCJjYW5kaWRhdGUiLCJmaWx0ZXIiLCJlbnRyeSIsInN0YXJ0c1dpdGgiLCJmaW5kIiwiaGFzIiwiZXh0bmFtZSIsInRvTG93ZXJDYXNlIiwiZ2V0Q2xpcE91dHB1dFBhdGgiLCJjbGlwSWQiLCJnZXRDbGlwU3VidGl0bGVQYXRoIiwiZ2V0QXVkaW9QY21QYXRoIiwiZmlsZUV4aXN0cyIsImZpbGVQYXRoIiwiYWNjZXNzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/storage.ts\n");

/***/ }),

/***/ "(rsc)/./lib/transcription.ts":
/*!******************************!*\
  !*** ./lib/transcription.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   transcribeYouTubeVideo: () => (/* binding */ transcribeYouTubeVideo)\n/* harmony export */ });\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_ffmpeg_bin__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/ffmpeg-bin */ \"(rsc)/./lib/ffmpeg-bin.ts\");\n/* harmony import */ var _lib_storage__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/storage */ \"(rsc)/./lib/storage.ts\");\n\n\n\n\n\nconst execFileAsync = (0,node_util__WEBPACK_IMPORTED_MODULE_2__.promisify)(node_child_process__WEBPACK_IMPORTED_MODULE_0__.execFile);\nconst TAG_RULES = [\n    {\n        tag: \"hook\",\n        regex: /agora|urgente|olha|aten[çc][aã]o|n[ãa]o acredita|chocante/i\n    },\n    {\n        tag: \"curiosidade\",\n        regex: /como|por que|segredo|detalhe|curiosidade|descobri/i\n    },\n    {\n        tag: \"pol[eê]mica\",\n        regex: /pol[eê]mica|discordo|absurdo|treta|discuss[aã]o/i\n    },\n    {\n        tag: \"humor\",\n        regex: /risos|engra[çc]ado|meme|zoeira|kkk|haha/i\n    },\n    {\n        tag: \"storytelling\",\n        regex: /aconteceu|quando|depois|hist[oó]ria|ent[aã]o/i\n    },\n    {\n        tag: \"valor\",\n        regex: /dica|estrat[eé]gia|resultado|li[çc][aã]o|aprendi/i\n    }\n];\nconst STOPWORDS = new Set([\n    \"para\",\n    \"com\",\n    \"sem\",\n    \"sobre\",\n    \"porque\",\n    \"quando\",\n    \"onde\",\n    \"depois\",\n    \"antes\",\n    \"entre\",\n    \"muito\",\n    \"pouco\",\n    \"essa\",\n    \"esse\",\n    \"isso\",\n    \"como\",\n    \"mais\",\n    \"menos\",\n    \"ainda\",\n    \"tambem\",\n    \"voces\",\n    \"você\",\n    \"voce\",\n    \"aqui\",\n    \"ali\",\n    \"seu\",\n    \"sua\",\n    \"das\",\n    \"dos\",\n    \"uma\",\n    \"uns\",\n    \"umas\",\n    \"que\",\n    \"pra\"\n]);\nfunction cleanText(text) {\n    return text.replace(/<\\d{2}:\\d{2}:\\d{2}\\.\\d{3}>/g, \"\").replace(/<\\d{2}:\\d{2}\\.\\d{3}>/g, \"\").replace(/<[^>]+>/g, \"\").replace(/&amp;/g, \"&\").replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/\\s+/g, \" \").trim();\n}\nfunction parseTimestamp(raw) {\n    const clean = raw.trim().replace(\",\", \".\");\n    const parts = clean.split(\":\").map(Number);\n    if (parts.length === 3) {\n        const [hh, mm, ss] = parts;\n        return hh * 3600 + mm * 60 + ss;\n    }\n    if (parts.length === 2) {\n        const [mm, ss] = parts;\n        return mm * 60 + ss;\n    }\n    return Number(clean) || 0;\n}\nfunction parseVtt(content) {\n    const lines = content.replace(/^\\uFEFF/, \"\").split(/\\r?\\n/);\n    const cues = [];\n    let index = 0;\n    while(index < lines.length){\n        const line = lines[index].trim();\n        if (!line.includes(\"-->\")) {\n            index += 1;\n            continue;\n        }\n        const [startRaw, endRawWithSettings] = line.split(\"-->\");\n        const endRaw = endRawWithSettings.trim().split(/\\s+/)[0];\n        const startSec = parseTimestamp(startRaw);\n        const endSec = parseTimestamp(endRaw);\n        index += 1;\n        const textLines = [];\n        while(index < lines.length && lines[index].trim() !== \"\"){\n            textLines.push(lines[index]);\n            index += 1;\n        }\n        const text = cleanText(textLines.join(\" \"));\n        if (text && endSec > startSec) {\n            cues.push({\n                startSec,\n                endSec,\n                text\n            });\n        }\n        while(index < lines.length && lines[index].trim() === \"\"){\n            index += 1;\n        }\n    }\n    return cues;\n}\nfunction findTags(text, energy) {\n    const matched = TAG_RULES.filter((rule)=>rule.regex.test(text)).map((rule)=>rule.tag);\n    if (energy >= 0.75 && !matched.includes(\"hook\")) {\n        matched.push(\"hook\");\n    }\n    if (energy <= 0.2 && !matched.includes(\"storytelling\")) {\n        matched.push(\"storytelling\");\n    }\n    if (matched.length === 0) {\n        matched.push(\"valor\");\n    }\n    return matched;\n}\nfunction estimateEmotion(text, energy) {\n    const punctuationBoost = (text.match(/[!?]/g) ?? []).length * 0.06;\n    const uppercaseBoost = /[A-ZÁÉÍÓÚÇ]{4,}/.test(text) ? 0.1 : 0;\n    return Math.max(0.1, Math.min(1, energy * 0.7 + punctuationBoost + uppercaseBoost + 0.16));\n}\nasync function extractEnergyBuckets(params) {\n    const { sourceVideoPath, audioPcmPath, durationSec } = params;\n    const ffmpegBin = (0,_lib_ffmpeg_bin__WEBPACK_IMPORTED_MODULE_3__.getFfmpegBinaryPath)();\n    await execFileAsync(ffmpegBin, [\n        \"-y\",\n        \"-i\",\n        sourceVideoPath,\n        \"-vn\",\n        \"-ac\",\n        \"1\",\n        \"-ar\",\n        \"16000\",\n        \"-f\",\n        \"s16le\",\n        audioPcmPath\n    ]);\n    const pcm = await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.readFile(audioPcmPath);\n    if (pcm.length < 2) {\n        return [\n            {\n                startSec: 0,\n                endSec: Math.max(1, durationSec),\n                energy: 0.45\n            }\n        ];\n    }\n    const sampleRate = 16000;\n    const samplesPerWindow = sampleRate;\n    const totalSamples = Math.floor(pcm.length / 2);\n    const buckets = [];\n    let maxRms = 0;\n    for(let offset = 0; offset < totalSamples; offset += samplesPerWindow){\n        const end = Math.min(totalSamples, offset + samplesPerWindow);\n        const count = end - offset;\n        if (count <= 0) continue;\n        let sumSquares = 0;\n        for(let sample = offset; sample < end; sample += 1){\n            const int16 = pcm.readInt16LE(sample * 2);\n            const normalized = int16 / 32768;\n            sumSquares += normalized * normalized;\n        }\n        const rms = Math.sqrt(sumSquares / count);\n        if (rms > maxRms) maxRms = rms;\n        buckets.push({\n            startSec: offset / sampleRate,\n            endSec: end / sampleRate,\n            energy: rms\n        });\n    }\n    const normalizer = maxRms > 0 ? maxRms : 1;\n    return buckets.map((bucket)=>({\n            ...bucket,\n            energy: Math.max(0.01, Math.min(1, bucket.energy / normalizer))\n        }));\n}\nfunction energyForRange(buckets, startSec, endSec) {\n    const matching = buckets.filter((bucket)=>bucket.startSec < endSec && bucket.endSec > startSec);\n    if (matching.length === 0) {\n        const nearest = buckets.find((bucket)=>bucket.startSec <= startSec && bucket.endSec >= startSec);\n        return nearest?.energy ?? 0.45;\n    }\n    const sum = matching.reduce((acc, bucket)=>acc + bucket.energy, 0);\n    return sum / matching.length;\n}\nfunction extractKeywords(video, keywordHints, descriptionHint) {\n    const base = [\n        video.title,\n        ...keywordHints,\n        descriptionHint\n    ].join(\" \");\n    const freq = new Map();\n    for (const token of base.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase().split(/[^a-z0-9]+/).filter((part)=>part.length >= 4 && !STOPWORDS.has(part))){\n        freq.set(token, (freq.get(token) ?? 0) + 1);\n    }\n    return [\n        ...freq.entries()\n    ].sort((a, b)=>b[1] - a[1]).slice(0, 8).map(([word])=>word);\n}\nfunction fallbackSegmentsFromEnergy(params) {\n    const { video, buckets, keywords } = params;\n    const segments = [];\n    const windowSec = 8;\n    for(let start = 0; start < video.durationSec; start += windowSec){\n        const end = Math.min(video.durationSec, start + windowSec);\n        const energy = energyForRange(buckets, start, end);\n        const focus = keywords[segments.length % Math.max(1, keywords.length)] || \"momento\";\n        const text = energy >= 0.7 ? `Pico de energia com foco em ${focus}. Reação forte da audiência nesse trecho.` : energy <= 0.25 ? `Pausa dramática e construção de contexto sobre ${focus}.` : `Trecho com narrativa contínua sobre ${focus}, bom para retenção.`;\n        segments.push({\n            id: `${video.videoId}-energy-${segments.length + 1}`,\n            startSec: start,\n            endSec: end,\n            text,\n            energy,\n            emotion: estimateEmotion(text, energy),\n            tags: findTags(text, energy)\n        });\n    }\n    return segments;\n}\nasync function transcribeYouTubeVideo(params) {\n    const { jobId, video, sourceVideoPath, subtitleVttPath, keywordHints, descriptionHint, log } = params;\n    log?.(\"Extraindo energia de áudio para detectar picos e pausas dramáticas\");\n    const buckets = await extractEnergyBuckets({\n        sourceVideoPath,\n        audioPcmPath: (0,_lib_storage__WEBPACK_IMPORTED_MODULE_4__.getAudioPcmPath)(jobId),\n        durationSec: video.durationSec\n    });\n    const keywords = extractKeywords(video, keywordHints, descriptionHint);\n    if (!subtitleVttPath) {\n        log?.(\"Legendas automáticas não disponíveis; usando transcrição temporal por energia\");\n        return fallbackSegmentsFromEnergy({\n            video,\n            buckets,\n            keywords\n        });\n    }\n    let vtt = \"\";\n    try {\n        vtt = await node_fs__WEBPACK_IMPORTED_MODULE_1__.promises.readFile(subtitleVttPath, \"utf8\");\n    } catch  {\n        log?.(\"Falha ao ler arquivo de legenda VTT; aplicando fallback por energia\");\n        return fallbackSegmentsFromEnergy({\n            video,\n            buckets,\n            keywords\n        });\n    }\n    const cues = parseVtt(vtt);\n    if (cues.length < 5) {\n        log?.(\"Legenda automática insuficiente; aplicando fallback por energia\");\n        return fallbackSegmentsFromEnergy({\n            video,\n            buckets,\n            keywords\n        });\n    }\n    const segments = cues.map((cue, index)=>{\n        const energy = energyForRange(buckets, cue.startSec, cue.endSec);\n        const text = cue.text;\n        return {\n            id: `${video.videoId}-${index + 1}`,\n            startSec: cue.startSec,\n            endSec: cue.endSec,\n            text,\n            energy,\n            emotion: estimateEmotion(text, energy),\n            tags: findTags(text, energy)\n        };\n    });\n    log?.(`Transcrição pronta com ${segments.length} segmentos`);\n    return segments;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdHJhbnNjcmlwdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBOEM7QUFDTDtBQUNIO0FBRWlCO0FBQ1A7QUFHaEQsTUFBTU0sZ0JBQWdCSCxvREFBU0EsQ0FBQ0gsd0RBQVFBO0FBY3hDLE1BQU1PLFlBQW1EO0lBQ3ZEO1FBQUVDLEtBQUs7UUFBUUMsT0FBTztJQUE2RDtJQUNuRjtRQUFFRCxLQUFLO1FBQWVDLE9BQU87SUFBcUQ7SUFDbEY7UUFBRUQsS0FBSztRQUFlQyxPQUFPO0lBQW1EO0lBQ2hGO1FBQUVELEtBQUs7UUFBU0MsT0FBTztJQUEyQztJQUNsRTtRQUFFRCxLQUFLO1FBQWdCQyxPQUFPO0lBQWdEO0lBQzlFO1FBQUVELEtBQUs7UUFBU0MsT0FBTztJQUFvRDtDQUM1RTtBQUVELE1BQU1DLFlBQVksSUFBSUMsSUFBSTtJQUN4QjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNEO0FBRUQsU0FBU0MsVUFBVUMsSUFBWTtJQUM3QixPQUFPQSxLQUNKQyxPQUFPLENBQUMsK0JBQStCLElBQ3ZDQSxPQUFPLENBQUMseUJBQXlCLElBQ2pDQSxPQUFPLENBQUMsWUFBWSxJQUNwQkEsT0FBTyxDQUFDLFVBQVUsS0FDbEJBLE9BQU8sQ0FBQyxXQUFXLEtBQ25CQSxPQUFPLENBQUMsVUFBVSxLQUNsQkEsT0FBTyxDQUFDLFNBQVMsS0FDakJBLE9BQU8sQ0FBQyxTQUFTLEtBQ2pCQSxPQUFPLENBQUMsUUFBUSxLQUNoQkMsSUFBSTtBQUNUO0FBRUEsU0FBU0MsZUFBZUMsR0FBVztJQUNqQyxNQUFNQyxRQUFRRCxJQUFJRixJQUFJLEdBQUdELE9BQU8sQ0FBQyxLQUFLO0lBQ3RDLE1BQU1LLFFBQVFELE1BQU1FLEtBQUssQ0FBQyxLQUFLQyxHQUFHLENBQUNDO0lBRW5DLElBQUlILE1BQU1JLE1BQU0sS0FBSyxHQUFHO1FBQ3RCLE1BQU0sQ0FBQ0MsSUFBSUMsSUFBSUMsR0FBRyxHQUFHUDtRQUNyQixPQUFPSyxLQUFLLE9BQU9DLEtBQUssS0FBS0M7SUFDL0I7SUFFQSxJQUFJUCxNQUFNSSxNQUFNLEtBQUssR0FBRztRQUN0QixNQUFNLENBQUNFLElBQUlDLEdBQUcsR0FBR1A7UUFDakIsT0FBT00sS0FBSyxLQUFLQztJQUNuQjtJQUVBLE9BQU9KLE9BQU9KLFVBQVU7QUFDMUI7QUFFQSxTQUFTUyxTQUFTQyxPQUFlO0lBQy9CLE1BQU1DLFFBQVFELFFBQVFkLE9BQU8sQ0FBQyxXQUFXLElBQUlNLEtBQUssQ0FBQztJQUNuRCxNQUFNVSxPQUF1QixFQUFFO0lBRS9CLElBQUlDLFFBQVE7SUFDWixNQUFPQSxRQUFRRixNQUFNTixNQUFNLENBQUU7UUFDM0IsTUFBTVMsT0FBT0gsS0FBSyxDQUFDRSxNQUFNLENBQUNoQixJQUFJO1FBRTlCLElBQUksQ0FBQ2lCLEtBQUtDLFFBQVEsQ0FBQyxRQUFRO1lBQ3pCRixTQUFTO1lBQ1Q7UUFDRjtRQUVBLE1BQU0sQ0FBQ0csVUFBVUMsbUJBQW1CLEdBQUdILEtBQUtaLEtBQUssQ0FBQztRQUNsRCxNQUFNZ0IsU0FBU0QsbUJBQW1CcEIsSUFBSSxHQUFHSyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7UUFFeEQsTUFBTWlCLFdBQVdyQixlQUFla0I7UUFDaEMsTUFBTUksU0FBU3RCLGVBQWVvQjtRQUU5QkwsU0FBUztRQUVULE1BQU1RLFlBQXNCLEVBQUU7UUFDOUIsTUFBT1IsUUFBUUYsTUFBTU4sTUFBTSxJQUFJTSxLQUFLLENBQUNFLE1BQU0sQ0FBQ2hCLElBQUksT0FBTyxHQUFJO1lBQ3pEd0IsVUFBVUMsSUFBSSxDQUFDWCxLQUFLLENBQUNFLE1BQU07WUFDM0JBLFNBQVM7UUFDWDtRQUVBLE1BQU1sQixPQUFPRCxVQUFVMkIsVUFBVUUsSUFBSSxDQUFDO1FBRXRDLElBQUk1QixRQUFReUIsU0FBU0QsVUFBVTtZQUM3QlAsS0FBS1UsSUFBSSxDQUFDO2dCQUFFSDtnQkFBVUM7Z0JBQVF6QjtZQUFLO1FBQ3JDO1FBRUEsTUFBT2tCLFFBQVFGLE1BQU1OLE1BQU0sSUFBSU0sS0FBSyxDQUFDRSxNQUFNLENBQUNoQixJQUFJLE9BQU8sR0FBSTtZQUN6RGdCLFNBQVM7UUFDWDtJQUNGO0lBRUEsT0FBT0Q7QUFDVDtBQUVBLFNBQVNZLFNBQVM3QixJQUFZLEVBQUU4QixNQUFjO0lBQzVDLE1BQU1DLFVBQVVyQyxVQUFVc0MsTUFBTSxDQUFDLENBQUNDLE9BQVNBLEtBQUtyQyxLQUFLLENBQUNzQyxJQUFJLENBQUNsQyxPQUFPUSxHQUFHLENBQUMsQ0FBQ3lCLE9BQVNBLEtBQUt0QyxHQUFHO0lBRXhGLElBQUltQyxVQUFVLFFBQVEsQ0FBQ0MsUUFBUVgsUUFBUSxDQUFDLFNBQVM7UUFDL0NXLFFBQVFKLElBQUksQ0FBQztJQUNmO0lBRUEsSUFBSUcsVUFBVSxPQUFPLENBQUNDLFFBQVFYLFFBQVEsQ0FBQyxpQkFBaUI7UUFDdERXLFFBQVFKLElBQUksQ0FBQztJQUNmO0lBRUEsSUFBSUksUUFBUXJCLE1BQU0sS0FBSyxHQUFHO1FBQ3hCcUIsUUFBUUosSUFBSSxDQUFDO0lBQ2Y7SUFFQSxPQUFPSTtBQUNUO0FBRUEsU0FBU0ksZ0JBQWdCbkMsSUFBWSxFQUFFOEIsTUFBYztJQUNuRCxNQUFNTSxtQkFBbUIsQ0FBQ3BDLEtBQUtxQyxLQUFLLENBQUMsWUFBWSxFQUFFLEVBQUUzQixNQUFNLEdBQUc7SUFDOUQsTUFBTTRCLGlCQUFpQixrQkFBa0JKLElBQUksQ0FBQ2xDLFFBQVEsTUFBTTtJQUM1RCxPQUFPdUMsS0FBS0MsR0FBRyxDQUFDLEtBQUtELEtBQUtFLEdBQUcsQ0FBQyxHQUFHWCxTQUFTLE1BQU1NLG1CQUFtQkUsaUJBQWlCO0FBQ3RGO0FBRUEsZUFBZUkscUJBQXFCQyxNQUluQztJQUNDLE1BQU0sRUFBRUMsZUFBZSxFQUFFQyxZQUFZLEVBQUVDLFdBQVcsRUFBRSxHQUFHSDtJQUV2RCxNQUFNSSxZQUFZeEQsb0VBQW1CQTtJQUVyQyxNQUFNRSxjQUFjc0QsV0FBVztRQUM3QjtRQUNBO1FBQ0FIO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQUM7S0FDRDtJQUVELE1BQU1HLE1BQU0sTUFBTTNELDZDQUFFQSxDQUFDNEQsUUFBUSxDQUFDSjtJQUU5QixJQUFJRyxJQUFJdEMsTUFBTSxHQUFHLEdBQUc7UUFDbEIsT0FBTztZQUFDO2dCQUFFYyxVQUFVO2dCQUFHQyxRQUFRYyxLQUFLQyxHQUFHLENBQUMsR0FBR007Z0JBQWNoQixRQUFRO1lBQUs7U0FBRTtJQUMxRTtJQUVBLE1BQU1vQixhQUFhO0lBQ25CLE1BQU1DLG1CQUFtQkQ7SUFDekIsTUFBTUUsZUFBZWIsS0FBS2MsS0FBSyxDQUFDTCxJQUFJdEMsTUFBTSxHQUFHO0lBRTdDLE1BQU00QyxVQUEwQixFQUFFO0lBRWxDLElBQUlDLFNBQVM7SUFFYixJQUFLLElBQUlDLFNBQVMsR0FBR0EsU0FBU0osY0FBY0ksVUFBVUwsaUJBQWtCO1FBQ3RFLE1BQU1NLE1BQU1sQixLQUFLRSxHQUFHLENBQUNXLGNBQWNJLFNBQVNMO1FBQzVDLE1BQU1PLFFBQVFELE1BQU1EO1FBRXBCLElBQUlFLFNBQVMsR0FBRztRQUVoQixJQUFJQyxhQUFhO1FBQ2pCLElBQUssSUFBSUMsU0FBU0osUUFBUUksU0FBU0gsS0FBS0csVUFBVSxFQUFHO1lBQ25ELE1BQU1DLFFBQVFiLElBQUljLFdBQVcsQ0FBQ0YsU0FBUztZQUN2QyxNQUFNRyxhQUFhRixRQUFRO1lBQzNCRixjQUFjSSxhQUFhQTtRQUM3QjtRQUVBLE1BQU1DLE1BQU16QixLQUFLMEIsSUFBSSxDQUFDTixhQUFhRDtRQUNuQyxJQUFJTSxNQUFNVCxRQUFRQSxTQUFTUztRQUUzQlYsUUFBUTNCLElBQUksQ0FBQztZQUNYSCxVQUFVZ0MsU0FBU047WUFDbkJ6QixRQUFRZ0MsTUFBTVA7WUFDZHBCLFFBQVFrQztRQUNWO0lBQ0Y7SUFFQSxNQUFNRSxhQUFhWCxTQUFTLElBQUlBLFNBQVM7SUFFekMsT0FBT0QsUUFBUTlDLEdBQUcsQ0FBQyxDQUFDMkQsU0FBWTtZQUM5QixHQUFHQSxNQUFNO1lBQ1RyQyxRQUFRUyxLQUFLQyxHQUFHLENBQUMsTUFBTUQsS0FBS0UsR0FBRyxDQUFDLEdBQUcwQixPQUFPckMsTUFBTSxHQUFHb0M7UUFDckQ7QUFDRjtBQUVBLFNBQVNFLGVBQWVkLE9BQXVCLEVBQUU5QixRQUFnQixFQUFFQyxNQUFjO0lBQy9FLE1BQU00QyxXQUFXZixRQUFRdEIsTUFBTSxDQUFDLENBQUNtQyxTQUFXQSxPQUFPM0MsUUFBUSxHQUFHQyxVQUFVMEMsT0FBTzFDLE1BQU0sR0FBR0Q7SUFDeEYsSUFBSTZDLFNBQVMzRCxNQUFNLEtBQUssR0FBRztRQUN6QixNQUFNNEQsVUFBVWhCLFFBQVFpQixJQUFJLENBQUMsQ0FBQ0osU0FBV0EsT0FBTzNDLFFBQVEsSUFBSUEsWUFBWTJDLE9BQU8xQyxNQUFNLElBQUlEO1FBQ3pGLE9BQU84QyxTQUFTeEMsVUFBVTtJQUM1QjtJQUVBLE1BQU0wQyxNQUFNSCxTQUFTSSxNQUFNLENBQUMsQ0FBQ0MsS0FBS1AsU0FBV08sTUFBTVAsT0FBT3JDLE1BQU0sRUFBRTtJQUNsRSxPQUFPMEMsTUFBTUgsU0FBUzNELE1BQU07QUFDOUI7QUFFQSxTQUFTaUUsZ0JBQWdCQyxLQUF1QixFQUFFQyxZQUFzQixFQUFFQyxlQUF1QjtJQUMvRixNQUFNQyxPQUFPO1FBQUNILE1BQU1JLEtBQUs7V0FBS0g7UUFBY0M7S0FBZ0IsQ0FBQ2xELElBQUksQ0FBQztJQUVsRSxNQUFNcUQsT0FBTyxJQUFJQztJQUVqQixLQUFLLE1BQU1DLFNBQVNKLEtBQ2pCSyxTQUFTLENBQUMsT0FDVm5GLE9BQU8sQ0FBQyxvQkFBb0IsSUFDNUJvRixXQUFXLEdBQ1g5RSxLQUFLLENBQUMsY0FDTnlCLE1BQU0sQ0FBQyxDQUFDc0QsT0FBU0EsS0FBSzVFLE1BQU0sSUFBSSxLQUFLLENBQUNiLFVBQVUwRixHQUFHLENBQUNELE9BQVE7UUFDN0RMLEtBQUtPLEdBQUcsQ0FBQ0wsT0FBTyxDQUFDRixLQUFLUSxHQUFHLENBQUNOLFVBQVUsS0FBSztJQUMzQztJQUVBLE9BQU87V0FBSUYsS0FBS1MsT0FBTztLQUFHLENBQ3ZCQyxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTUEsQ0FBQyxDQUFDLEVBQUUsR0FBR0QsQ0FBQyxDQUFDLEVBQUUsRUFDMUJFLEtBQUssQ0FBQyxHQUFHLEdBQ1R0RixHQUFHLENBQUMsQ0FBQyxDQUFDdUYsS0FBSyxHQUFLQTtBQUNyQjtBQUVBLFNBQVNDLDJCQUEyQnJELE1BSW5DO0lBQ0MsTUFBTSxFQUFFaUMsS0FBSyxFQUFFdEIsT0FBTyxFQUFFMkMsUUFBUSxFQUFFLEdBQUd0RDtJQUVyQyxNQUFNdUQsV0FBZ0MsRUFBRTtJQUV4QyxNQUFNQyxZQUFZO0lBQ2xCLElBQUssSUFBSUMsUUFBUSxHQUFHQSxRQUFReEIsTUFBTTlCLFdBQVcsRUFBRXNELFNBQVNELFVBQVc7UUFDakUsTUFBTTFDLE1BQU1sQixLQUFLRSxHQUFHLENBQUNtQyxNQUFNOUIsV0FBVyxFQUFFc0QsUUFBUUQ7UUFDaEQsTUFBTXJFLFNBQVNzQyxlQUFlZCxTQUFTOEMsT0FBTzNDO1FBRTlDLE1BQU00QyxRQUFRSixRQUFRLENBQUNDLFNBQVN4RixNQUFNLEdBQUc2QixLQUFLQyxHQUFHLENBQUMsR0FBR3lELFNBQVN2RixNQUFNLEVBQUUsSUFBSTtRQUMxRSxNQUFNVixPQUNKOEIsVUFBVSxNQUNOLENBQUMsNEJBQTRCLEVBQUV1RSxNQUFNLHlDQUF5QyxDQUFDLEdBQy9FdkUsVUFBVSxPQUNWLENBQUMsK0NBQStDLEVBQUV1RSxNQUFNLENBQUMsQ0FBQyxHQUMxRCxDQUFDLG9DQUFvQyxFQUFFQSxNQUFNLG9CQUFvQixDQUFDO1FBRXhFSCxTQUFTdkUsSUFBSSxDQUFDO1lBQ1oyRSxJQUFJLEdBQUcxQixNQUFNMkIsT0FBTyxDQUFDLFFBQVEsRUFBRUwsU0FBU3hGLE1BQU0sR0FBRyxHQUFHO1lBQ3BEYyxVQUFVNEU7WUFDVjNFLFFBQVFnQztZQUNSekQ7WUFDQThCO1lBQ0EwRSxTQUFTckUsZ0JBQWdCbkMsTUFBTThCO1lBQy9CMkUsTUFBTTVFLFNBQVM3QixNQUFNOEI7UUFDdkI7SUFDRjtJQUVBLE9BQU9vRTtBQUNUO0FBRU8sZUFBZVEsdUJBQXVCL0QsTUFRNUM7SUFDQyxNQUFNLEVBQUVnRSxLQUFLLEVBQUUvQixLQUFLLEVBQUVoQyxlQUFlLEVBQUVnRSxlQUFlLEVBQUUvQixZQUFZLEVBQUVDLGVBQWUsRUFBRStCLEdBQUcsRUFBRSxHQUFHbEU7SUFFL0ZrRSxNQUFNO0lBQ04sTUFBTXZELFVBQVUsTUFBTVoscUJBQXFCO1FBQ3pDRTtRQUNBQyxjQUFjckQsNkRBQWVBLENBQUNtSDtRQUM5QjdELGFBQWE4QixNQUFNOUIsV0FBVztJQUNoQztJQUVBLE1BQU1tRCxXQUFXdEIsZ0JBQWdCQyxPQUFPQyxjQUFjQztJQUV0RCxJQUFJLENBQUM4QixpQkFBaUI7UUFDcEJDLE1BQU07UUFDTixPQUFPYiwyQkFBMkI7WUFBRXBCO1lBQU90QjtZQUFTMkM7UUFBUztJQUMvRDtJQUVBLElBQUlhLE1BQU07SUFDVixJQUFJO1FBQ0ZBLE1BQU0sTUFBTXpILDZDQUFFQSxDQUFDNEQsUUFBUSxDQUFDMkQsaUJBQWlCO0lBQzNDLEVBQUUsT0FBTTtRQUNOQyxNQUFNO1FBQ04sT0FBT2IsMkJBQTJCO1lBQUVwQjtZQUFPdEI7WUFBUzJDO1FBQVM7SUFDL0Q7SUFFQSxNQUFNaEYsT0FBT0gsU0FBU2dHO0lBRXRCLElBQUk3RixLQUFLUCxNQUFNLEdBQUcsR0FBRztRQUNuQm1HLE1BQU07UUFDTixPQUFPYiwyQkFBMkI7WUFBRXBCO1lBQU90QjtZQUFTMkM7UUFBUztJQUMvRDtJQUVBLE1BQU1DLFdBQWdDakYsS0FBS1QsR0FBRyxDQUFDLENBQUN1RyxLQUFLN0Y7UUFDbkQsTUFBTVksU0FBU3NDLGVBQWVkLFNBQVN5RCxJQUFJdkYsUUFBUSxFQUFFdUYsSUFBSXRGLE1BQU07UUFDL0QsTUFBTXpCLE9BQU8rRyxJQUFJL0csSUFBSTtRQUVyQixPQUFPO1lBQ0xzRyxJQUFJLEdBQUcxQixNQUFNMkIsT0FBTyxDQUFDLENBQUMsRUFBRXJGLFFBQVEsR0FBRztZQUNuQ00sVUFBVXVGLElBQUl2RixRQUFRO1lBQ3RCQyxRQUFRc0YsSUFBSXRGLE1BQU07WUFDbEJ6QjtZQUNBOEI7WUFDQTBFLFNBQVNyRSxnQkFBZ0JuQyxNQUFNOEI7WUFDL0IyRSxNQUFNNUUsU0FBUzdCLE1BQU04QjtRQUN2QjtJQUNGO0lBRUErRSxNQUFNLENBQUMsdUJBQXVCLEVBQUVYLFNBQVN4RixNQUFNLENBQUMsVUFBVSxDQUFDO0lBQzNELE9BQU93RjtBQUNUIiwic291cmNlcyI6WyIvVXNlcnMvYWxtZWlkYWdhYnJpZWwvRG9jdW1lbnRzL0NBTkEvbGliL3RyYW5zY3JpcHRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlY0ZpbGUgfSBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tIFwibm9kZTp1dGlsXCI7XG5cbmltcG9ydCB7IGdldEZmbXBlZ0JpbmFyeVBhdGggfSBmcm9tIFwiQC9saWIvZmZtcGVnLWJpblwiO1xuaW1wb3J0IHsgZ2V0QXVkaW9QY21QYXRoIH0gZnJvbSBcIkAvbGliL3N0b3JhZ2VcIjtcbmltcG9ydCB7IFRyYW5zY3JpcHRTZWdtZW50LCBZb3VUdWJlVmlkZW9NZXRhIH0gZnJvbSBcIkAvbGliL3R5cGVzXCI7XG5cbmNvbnN0IGV4ZWNGaWxlQXN5bmMgPSBwcm9taXNpZnkoZXhlY0ZpbGUpO1xuXG5pbnRlcmZhY2UgRW5lcmd5QnVja2V0IHtcbiAgc3RhcnRTZWM6IG51bWJlcjtcbiAgZW5kU2VjOiBudW1iZXI7XG4gIGVuZXJneTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgUGFyc2VkVnR0Q3VlIHtcbiAgc3RhcnRTZWM6IG51bWJlcjtcbiAgZW5kU2VjOiBudW1iZXI7XG4gIHRleHQ6IHN0cmluZztcbn1cblxuY29uc3QgVEFHX1JVTEVTOiBBcnJheTx7IHRhZzogc3RyaW5nOyByZWdleDogUmVnRXhwIH0+ID0gW1xuICB7IHRhZzogXCJob29rXCIsIHJlZ2V4OiAvYWdvcmF8dXJnZW50ZXxvbGhhfGF0ZW5bw6djXVthw6Ndb3xuW8OjYV1vIGFjcmVkaXRhfGNob2NhbnRlL2kgfSxcbiAgeyB0YWc6IFwiY3VyaW9zaWRhZGVcIiwgcmVnZXg6IC9jb21vfHBvciBxdWV8c2VncmVkb3xkZXRhbGhlfGN1cmlvc2lkYWRlfGRlc2NvYnJpL2kgfSxcbiAgeyB0YWc6IFwicG9sW2XDql1taWNhXCIsIHJlZ2V4OiAvcG9sW2XDql1taWNhfGRpc2NvcmRvfGFic3VyZG98dHJldGF8ZGlzY3Vzc1thw6Ndby9pIH0sXG4gIHsgdGFnOiBcImh1bW9yXCIsIHJlZ2V4OiAvcmlzb3N8ZW5ncmFbw6djXWFkb3xtZW1lfHpvZWlyYXxra2t8aGFoYS9pIH0sXG4gIHsgdGFnOiBcInN0b3J5dGVsbGluZ1wiLCByZWdleDogL2Fjb250ZWNldXxxdWFuZG98ZGVwb2lzfGhpc3Rbb8OzXXJpYXxlbnRbYcOjXW8vaSB9LFxuICB7IHRhZzogXCJ2YWxvclwiLCByZWdleDogL2RpY2F8ZXN0cmF0W2XDqV1naWF8cmVzdWx0YWRvfGxpW8OnY11bYcOjXW98YXByZW5kaS9pIH0sXG5dO1xuXG5jb25zdCBTVE9QV09SRFMgPSBuZXcgU2V0KFtcbiAgXCJwYXJhXCIsXG4gIFwiY29tXCIsXG4gIFwic2VtXCIsXG4gIFwic29icmVcIixcbiAgXCJwb3JxdWVcIixcbiAgXCJxdWFuZG9cIixcbiAgXCJvbmRlXCIsXG4gIFwiZGVwb2lzXCIsXG4gIFwiYW50ZXNcIixcbiAgXCJlbnRyZVwiLFxuICBcIm11aXRvXCIsXG4gIFwicG91Y29cIixcbiAgXCJlc3NhXCIsXG4gIFwiZXNzZVwiLFxuICBcImlzc29cIixcbiAgXCJjb21vXCIsXG4gIFwibWFpc1wiLFxuICBcIm1lbm9zXCIsXG4gIFwiYWluZGFcIixcbiAgXCJ0YW1iZW1cIixcbiAgXCJ2b2Nlc1wiLFxuICBcInZvY8OqXCIsXG4gIFwidm9jZVwiLFxuICBcImFxdWlcIixcbiAgXCJhbGlcIixcbiAgXCJzZXVcIixcbiAgXCJzdWFcIixcbiAgXCJkYXNcIixcbiAgXCJkb3NcIixcbiAgXCJ1bWFcIixcbiAgXCJ1bnNcIixcbiAgXCJ1bWFzXCIsXG4gIFwicXVlXCIsXG4gIFwicHJhXCIsXG5dKTtcblxuZnVuY3Rpb24gY2xlYW5UZXh0KHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB0ZXh0XG4gICAgLnJlcGxhY2UoLzxcXGR7Mn06XFxkezJ9OlxcZHsyfVxcLlxcZHszfT4vZywgXCJcIilcbiAgICAucmVwbGFjZSgvPFxcZHsyfTpcXGR7Mn1cXC5cXGR7M30+L2csIFwiXCIpXG4gICAgLnJlcGxhY2UoLzxbXj5dKz4vZywgXCJcIilcbiAgICAucmVwbGFjZSgvJmFtcDsvZywgXCImXCIpXG4gICAgLnJlcGxhY2UoLyZxdW90Oy9nLCAnXCInKVxuICAgIC5yZXBsYWNlKC8mIzM5Oy9nLCBcIidcIilcbiAgICAucmVwbGFjZSgvJmx0Oy9nLCBcIjxcIilcbiAgICAucmVwbGFjZSgvJmd0Oy9nLCBcIj5cIilcbiAgICAucmVwbGFjZSgvXFxzKy9nLCBcIiBcIilcbiAgICAudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBwYXJzZVRpbWVzdGFtcChyYXc6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IGNsZWFuID0gcmF3LnRyaW0oKS5yZXBsYWNlKFwiLFwiLCBcIi5cIik7XG4gIGNvbnN0IHBhcnRzID0gY2xlYW4uc3BsaXQoXCI6XCIpLm1hcChOdW1iZXIpO1xuXG4gIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHtcbiAgICBjb25zdCBbaGgsIG1tLCBzc10gPSBwYXJ0cztcbiAgICByZXR1cm4gaGggKiAzNjAwICsgbW0gKiA2MCArIHNzO1xuICB9XG5cbiAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGNvbnN0IFttbSwgc3NdID0gcGFydHM7XG4gICAgcmV0dXJuIG1tICogNjAgKyBzcztcbiAgfVxuXG4gIHJldHVybiBOdW1iZXIoY2xlYW4pIHx8IDA7XG59XG5cbmZ1bmN0aW9uIHBhcnNlVnR0KGNvbnRlbnQ6IHN0cmluZyk6IFBhcnNlZFZ0dEN1ZVtdIHtcbiAgY29uc3QgbGluZXMgPSBjb250ZW50LnJlcGxhY2UoL15cXHVGRUZGLywgXCJcIikuc3BsaXQoL1xccj9cXG4vKTtcbiAgY29uc3QgY3VlczogUGFyc2VkVnR0Q3VlW10gPSBbXTtcblxuICBsZXQgaW5kZXggPSAwO1xuICB3aGlsZSAoaW5kZXggPCBsaW5lcy5sZW5ndGgpIHtcbiAgICBjb25zdCBsaW5lID0gbGluZXNbaW5kZXhdLnRyaW0oKTtcblxuICAgIGlmICghbGluZS5pbmNsdWRlcyhcIi0tPlwiKSkge1xuICAgICAgaW5kZXggKz0gMTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IFtzdGFydFJhdywgZW5kUmF3V2l0aFNldHRpbmdzXSA9IGxpbmUuc3BsaXQoXCItLT5cIik7XG4gICAgY29uc3QgZW5kUmF3ID0gZW5kUmF3V2l0aFNldHRpbmdzLnRyaW0oKS5zcGxpdCgvXFxzKy8pWzBdO1xuXG4gICAgY29uc3Qgc3RhcnRTZWMgPSBwYXJzZVRpbWVzdGFtcChzdGFydFJhdyk7XG4gICAgY29uc3QgZW5kU2VjID0gcGFyc2VUaW1lc3RhbXAoZW5kUmF3KTtcblxuICAgIGluZGV4ICs9IDE7XG5cbiAgICBjb25zdCB0ZXh0TGluZXM6IHN0cmluZ1tdID0gW107XG4gICAgd2hpbGUgKGluZGV4IDwgbGluZXMubGVuZ3RoICYmIGxpbmVzW2luZGV4XS50cmltKCkgIT09IFwiXCIpIHtcbiAgICAgIHRleHRMaW5lcy5wdXNoKGxpbmVzW2luZGV4XSk7XG4gICAgICBpbmRleCArPSAxO1xuICAgIH1cblxuICAgIGNvbnN0IHRleHQgPSBjbGVhblRleHQodGV4dExpbmVzLmpvaW4oXCIgXCIpKTtcblxuICAgIGlmICh0ZXh0ICYmIGVuZFNlYyA+IHN0YXJ0U2VjKSB7XG4gICAgICBjdWVzLnB1c2goeyBzdGFydFNlYywgZW5kU2VjLCB0ZXh0IH0pO1xuICAgIH1cblxuICAgIHdoaWxlIChpbmRleCA8IGxpbmVzLmxlbmd0aCAmJiBsaW5lc1tpbmRleF0udHJpbSgpID09PSBcIlwiKSB7XG4gICAgICBpbmRleCArPSAxO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdWVzO1xufVxuXG5mdW5jdGlvbiBmaW5kVGFncyh0ZXh0OiBzdHJpbmcsIGVuZXJneTogbnVtYmVyKTogc3RyaW5nW10ge1xuICBjb25zdCBtYXRjaGVkID0gVEFHX1JVTEVTLmZpbHRlcigocnVsZSkgPT4gcnVsZS5yZWdleC50ZXN0KHRleHQpKS5tYXAoKHJ1bGUpID0+IHJ1bGUudGFnKTtcblxuICBpZiAoZW5lcmd5ID49IDAuNzUgJiYgIW1hdGNoZWQuaW5jbHVkZXMoXCJob29rXCIpKSB7XG4gICAgbWF0Y2hlZC5wdXNoKFwiaG9va1wiKTtcbiAgfVxuXG4gIGlmIChlbmVyZ3kgPD0gMC4yICYmICFtYXRjaGVkLmluY2x1ZGVzKFwic3Rvcnl0ZWxsaW5nXCIpKSB7XG4gICAgbWF0Y2hlZC5wdXNoKFwic3Rvcnl0ZWxsaW5nXCIpO1xuICB9XG5cbiAgaWYgKG1hdGNoZWQubGVuZ3RoID09PSAwKSB7XG4gICAgbWF0Y2hlZC5wdXNoKFwidmFsb3JcIik7XG4gIH1cblxuICByZXR1cm4gbWF0Y2hlZDtcbn1cblxuZnVuY3Rpb24gZXN0aW1hdGVFbW90aW9uKHRleHQ6IHN0cmluZywgZW5lcmd5OiBudW1iZXIpOiBudW1iZXIge1xuICBjb25zdCBwdW5jdHVhdGlvbkJvb3N0ID0gKHRleHQubWF0Y2goL1shP10vZykgPz8gW10pLmxlbmd0aCAqIDAuMDY7XG4gIGNvbnN0IHVwcGVyY2FzZUJvb3N0ID0gL1tBLVrDgcOJw43Dk8Oaw4ddezQsfS8udGVzdCh0ZXh0KSA/IDAuMSA6IDA7XG4gIHJldHVybiBNYXRoLm1heCgwLjEsIE1hdGgubWluKDEsIGVuZXJneSAqIDAuNyArIHB1bmN0dWF0aW9uQm9vc3QgKyB1cHBlcmNhc2VCb29zdCArIDAuMTYpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdEVuZXJneUJ1Y2tldHMocGFyYW1zOiB7XG4gIHNvdXJjZVZpZGVvUGF0aDogc3RyaW5nO1xuICBhdWRpb1BjbVBhdGg6IHN0cmluZztcbiAgZHVyYXRpb25TZWM6IG51bWJlcjtcbn0pOiBQcm9taXNlPEVuZXJneUJ1Y2tldFtdPiB7XG4gIGNvbnN0IHsgc291cmNlVmlkZW9QYXRoLCBhdWRpb1BjbVBhdGgsIGR1cmF0aW9uU2VjIH0gPSBwYXJhbXM7XG5cbiAgY29uc3QgZmZtcGVnQmluID0gZ2V0RmZtcGVnQmluYXJ5UGF0aCgpO1xuXG4gIGF3YWl0IGV4ZWNGaWxlQXN5bmMoZmZtcGVnQmluLCBbXG4gICAgXCIteVwiLFxuICAgIFwiLWlcIixcbiAgICBzb3VyY2VWaWRlb1BhdGgsXG4gICAgXCItdm5cIixcbiAgICBcIi1hY1wiLFxuICAgIFwiMVwiLFxuICAgIFwiLWFyXCIsXG4gICAgXCIxNjAwMFwiLFxuICAgIFwiLWZcIixcbiAgICBcInMxNmxlXCIsXG4gICAgYXVkaW9QY21QYXRoLFxuICBdKTtcblxuICBjb25zdCBwY20gPSBhd2FpdCBmcy5yZWFkRmlsZShhdWRpb1BjbVBhdGgpO1xuXG4gIGlmIChwY20ubGVuZ3RoIDwgMikge1xuICAgIHJldHVybiBbeyBzdGFydFNlYzogMCwgZW5kU2VjOiBNYXRoLm1heCgxLCBkdXJhdGlvblNlYyksIGVuZXJneTogMC40NSB9XTtcbiAgfVxuXG4gIGNvbnN0IHNhbXBsZVJhdGUgPSAxNjAwMDtcbiAgY29uc3Qgc2FtcGxlc1BlcldpbmRvdyA9IHNhbXBsZVJhdGU7XG4gIGNvbnN0IHRvdGFsU2FtcGxlcyA9IE1hdGguZmxvb3IocGNtLmxlbmd0aCAvIDIpO1xuXG4gIGNvbnN0IGJ1Y2tldHM6IEVuZXJneUJ1Y2tldFtdID0gW107XG5cbiAgbGV0IG1heFJtcyA9IDA7XG5cbiAgZm9yIChsZXQgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgdG90YWxTYW1wbGVzOyBvZmZzZXQgKz0gc2FtcGxlc1BlcldpbmRvdykge1xuICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKHRvdGFsU2FtcGxlcywgb2Zmc2V0ICsgc2FtcGxlc1BlcldpbmRvdyk7XG4gICAgY29uc3QgY291bnQgPSBlbmQgLSBvZmZzZXQ7XG5cbiAgICBpZiAoY291bnQgPD0gMCkgY29udGludWU7XG5cbiAgICBsZXQgc3VtU3F1YXJlcyA9IDA7XG4gICAgZm9yIChsZXQgc2FtcGxlID0gb2Zmc2V0OyBzYW1wbGUgPCBlbmQ7IHNhbXBsZSArPSAxKSB7XG4gICAgICBjb25zdCBpbnQxNiA9IHBjbS5yZWFkSW50MTZMRShzYW1wbGUgKiAyKTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBpbnQxNiAvIDMyNzY4O1xuICAgICAgc3VtU3F1YXJlcyArPSBub3JtYWxpemVkICogbm9ybWFsaXplZDtcbiAgICB9XG5cbiAgICBjb25zdCBybXMgPSBNYXRoLnNxcnQoc3VtU3F1YXJlcyAvIGNvdW50KTtcbiAgICBpZiAocm1zID4gbWF4Um1zKSBtYXhSbXMgPSBybXM7XG5cbiAgICBidWNrZXRzLnB1c2goe1xuICAgICAgc3RhcnRTZWM6IG9mZnNldCAvIHNhbXBsZVJhdGUsXG4gICAgICBlbmRTZWM6IGVuZCAvIHNhbXBsZVJhdGUsXG4gICAgICBlbmVyZ3k6IHJtcyxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IG5vcm1hbGl6ZXIgPSBtYXhSbXMgPiAwID8gbWF4Um1zIDogMTtcblxuICByZXR1cm4gYnVja2V0cy5tYXAoKGJ1Y2tldCkgPT4gKHtcbiAgICAuLi5idWNrZXQsXG4gICAgZW5lcmd5OiBNYXRoLm1heCgwLjAxLCBNYXRoLm1pbigxLCBidWNrZXQuZW5lcmd5IC8gbm9ybWFsaXplcikpLFxuICB9KSk7XG59XG5cbmZ1bmN0aW9uIGVuZXJneUZvclJhbmdlKGJ1Y2tldHM6IEVuZXJneUJ1Y2tldFtdLCBzdGFydFNlYzogbnVtYmVyLCBlbmRTZWM6IG51bWJlcik6IG51bWJlciB7XG4gIGNvbnN0IG1hdGNoaW5nID0gYnVja2V0cy5maWx0ZXIoKGJ1Y2tldCkgPT4gYnVja2V0LnN0YXJ0U2VjIDwgZW5kU2VjICYmIGJ1Y2tldC5lbmRTZWMgPiBzdGFydFNlYyk7XG4gIGlmIChtYXRjaGluZy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zdCBuZWFyZXN0ID0gYnVja2V0cy5maW5kKChidWNrZXQpID0+IGJ1Y2tldC5zdGFydFNlYyA8PSBzdGFydFNlYyAmJiBidWNrZXQuZW5kU2VjID49IHN0YXJ0U2VjKTtcbiAgICByZXR1cm4gbmVhcmVzdD8uZW5lcmd5ID8/IDAuNDU7XG4gIH1cblxuICBjb25zdCBzdW0gPSBtYXRjaGluZy5yZWR1Y2UoKGFjYywgYnVja2V0KSA9PiBhY2MgKyBidWNrZXQuZW5lcmd5LCAwKTtcbiAgcmV0dXJuIHN1bSAvIG1hdGNoaW5nLmxlbmd0aDtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdEtleXdvcmRzKHZpZGVvOiBZb3VUdWJlVmlkZW9NZXRhLCBrZXl3b3JkSGludHM6IHN0cmluZ1tdLCBkZXNjcmlwdGlvbkhpbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmFzZSA9IFt2aWRlby50aXRsZSwgLi4ua2V5d29yZEhpbnRzLCBkZXNjcmlwdGlvbkhpbnRdLmpvaW4oXCIgXCIpO1xuXG4gIGNvbnN0IGZyZXEgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXG4gIGZvciAoY29uc3QgdG9rZW4gb2YgYmFzZVxuICAgIC5ub3JtYWxpemUoXCJORkRcIilcbiAgICAucmVwbGFjZSgvW1xcdTAzMDAtXFx1MDM2Zl0vZywgXCJcIilcbiAgICAudG9Mb3dlckNhc2UoKVxuICAgIC5zcGxpdCgvW15hLXowLTldKy8pXG4gICAgLmZpbHRlcigocGFydCkgPT4gcGFydC5sZW5ndGggPj0gNCAmJiAhU1RPUFdPUkRTLmhhcyhwYXJ0KSkpIHtcbiAgICBmcmVxLnNldCh0b2tlbiwgKGZyZXEuZ2V0KHRva2VuKSA/PyAwKSArIDEpO1xuICB9XG5cbiAgcmV0dXJuIFsuLi5mcmVxLmVudHJpZXMoKV1cbiAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXG4gICAgLnNsaWNlKDAsIDgpXG4gICAgLm1hcCgoW3dvcmRdKSA9PiB3b3JkKTtcbn1cblxuZnVuY3Rpb24gZmFsbGJhY2tTZWdtZW50c0Zyb21FbmVyZ3kocGFyYW1zOiB7XG4gIHZpZGVvOiBZb3VUdWJlVmlkZW9NZXRhO1xuICBidWNrZXRzOiBFbmVyZ3lCdWNrZXRbXTtcbiAga2V5d29yZHM6IHN0cmluZ1tdO1xufSk6IFRyYW5zY3JpcHRTZWdtZW50W10ge1xuICBjb25zdCB7IHZpZGVvLCBidWNrZXRzLCBrZXl3b3JkcyB9ID0gcGFyYW1zO1xuXG4gIGNvbnN0IHNlZ21lbnRzOiBUcmFuc2NyaXB0U2VnbWVudFtdID0gW107XG5cbiAgY29uc3Qgd2luZG93U2VjID0gODtcbiAgZm9yIChsZXQgc3RhcnQgPSAwOyBzdGFydCA8IHZpZGVvLmR1cmF0aW9uU2VjOyBzdGFydCArPSB3aW5kb3dTZWMpIHtcbiAgICBjb25zdCBlbmQgPSBNYXRoLm1pbih2aWRlby5kdXJhdGlvblNlYywgc3RhcnQgKyB3aW5kb3dTZWMpO1xuICAgIGNvbnN0IGVuZXJneSA9IGVuZXJneUZvclJhbmdlKGJ1Y2tldHMsIHN0YXJ0LCBlbmQpO1xuXG4gICAgY29uc3QgZm9jdXMgPSBrZXl3b3Jkc1tzZWdtZW50cy5sZW5ndGggJSBNYXRoLm1heCgxLCBrZXl3b3Jkcy5sZW5ndGgpXSB8fCBcIm1vbWVudG9cIjtcbiAgICBjb25zdCB0ZXh0ID1cbiAgICAgIGVuZXJneSA+PSAwLjdcbiAgICAgICAgPyBgUGljbyBkZSBlbmVyZ2lhIGNvbSBmb2NvIGVtICR7Zm9jdXN9LiBSZWHDp8OjbyBmb3J0ZSBkYSBhdWRpw6puY2lhIG5lc3NlIHRyZWNoby5gXG4gICAgICAgIDogZW5lcmd5IDw9IDAuMjVcbiAgICAgICAgPyBgUGF1c2EgZHJhbcOhdGljYSBlIGNvbnN0cnXDp8OjbyBkZSBjb250ZXh0byBzb2JyZSAke2ZvY3VzfS5gXG4gICAgICAgIDogYFRyZWNobyBjb20gbmFycmF0aXZhIGNvbnTDrW51YSBzb2JyZSAke2ZvY3VzfSwgYm9tIHBhcmEgcmV0ZW7Dp8Ojby5gO1xuXG4gICAgc2VnbWVudHMucHVzaCh7XG4gICAgICBpZDogYCR7dmlkZW8udmlkZW9JZH0tZW5lcmd5LSR7c2VnbWVudHMubGVuZ3RoICsgMX1gLFxuICAgICAgc3RhcnRTZWM6IHN0YXJ0LFxuICAgICAgZW5kU2VjOiBlbmQsXG4gICAgICB0ZXh0LFxuICAgICAgZW5lcmd5LFxuICAgICAgZW1vdGlvbjogZXN0aW1hdGVFbW90aW9uKHRleHQsIGVuZXJneSksXG4gICAgICB0YWdzOiBmaW5kVGFncyh0ZXh0LCBlbmVyZ3kpLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHNlZ21lbnRzO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdHJhbnNjcmliZVlvdVR1YmVWaWRlbyhwYXJhbXM6IHtcbiAgam9iSWQ6IHN0cmluZztcbiAgdmlkZW86IFlvdVR1YmVWaWRlb01ldGE7XG4gIHNvdXJjZVZpZGVvUGF0aDogc3RyaW5nO1xuICBzdWJ0aXRsZVZ0dFBhdGg6IHN0cmluZyB8IG51bGw7XG4gIGtleXdvcmRIaW50czogc3RyaW5nW107XG4gIGRlc2NyaXB0aW9uSGludDogc3RyaW5nO1xuICBsb2c/OiAobWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkO1xufSk6IFByb21pc2U8VHJhbnNjcmlwdFNlZ21lbnRbXT4ge1xuICBjb25zdCB7IGpvYklkLCB2aWRlbywgc291cmNlVmlkZW9QYXRoLCBzdWJ0aXRsZVZ0dFBhdGgsIGtleXdvcmRIaW50cywgZGVzY3JpcHRpb25IaW50LCBsb2cgfSA9IHBhcmFtcztcblxuICBsb2c/LihcIkV4dHJhaW5kbyBlbmVyZ2lhIGRlIMOhdWRpbyBwYXJhIGRldGVjdGFyIHBpY29zIGUgcGF1c2FzIGRyYW3DoXRpY2FzXCIpO1xuICBjb25zdCBidWNrZXRzID0gYXdhaXQgZXh0cmFjdEVuZXJneUJ1Y2tldHMoe1xuICAgIHNvdXJjZVZpZGVvUGF0aCxcbiAgICBhdWRpb1BjbVBhdGg6IGdldEF1ZGlvUGNtUGF0aChqb2JJZCksXG4gICAgZHVyYXRpb25TZWM6IHZpZGVvLmR1cmF0aW9uU2VjLFxuICB9KTtcblxuICBjb25zdCBrZXl3b3JkcyA9IGV4dHJhY3RLZXl3b3Jkcyh2aWRlbywga2V5d29yZEhpbnRzLCBkZXNjcmlwdGlvbkhpbnQpO1xuXG4gIGlmICghc3VidGl0bGVWdHRQYXRoKSB7XG4gICAgbG9nPy4oXCJMZWdlbmRhcyBhdXRvbcOhdGljYXMgbsOjbyBkaXNwb27DrXZlaXM7IHVzYW5kbyB0cmFuc2NyacOnw6NvIHRlbXBvcmFsIHBvciBlbmVyZ2lhXCIpO1xuICAgIHJldHVybiBmYWxsYmFja1NlZ21lbnRzRnJvbUVuZXJneSh7IHZpZGVvLCBidWNrZXRzLCBrZXl3b3JkcyB9KTtcbiAgfVxuXG4gIGxldCB2dHQgPSBcIlwiO1xuICB0cnkge1xuICAgIHZ0dCA9IGF3YWl0IGZzLnJlYWRGaWxlKHN1YnRpdGxlVnR0UGF0aCwgXCJ1dGY4XCIpO1xuICB9IGNhdGNoIHtcbiAgICBsb2c/LihcIkZhbGhhIGFvIGxlciBhcnF1aXZvIGRlIGxlZ2VuZGEgVlRUOyBhcGxpY2FuZG8gZmFsbGJhY2sgcG9yIGVuZXJnaWFcIik7XG4gICAgcmV0dXJuIGZhbGxiYWNrU2VnbWVudHNGcm9tRW5lcmd5KHsgdmlkZW8sIGJ1Y2tldHMsIGtleXdvcmRzIH0pO1xuICB9XG5cbiAgY29uc3QgY3VlcyA9IHBhcnNlVnR0KHZ0dCk7XG5cbiAgaWYgKGN1ZXMubGVuZ3RoIDwgNSkge1xuICAgIGxvZz8uKFwiTGVnZW5kYSBhdXRvbcOhdGljYSBpbnN1ZmljaWVudGU7IGFwbGljYW5kbyBmYWxsYmFjayBwb3IgZW5lcmdpYVwiKTtcbiAgICByZXR1cm4gZmFsbGJhY2tTZWdtZW50c0Zyb21FbmVyZ3koeyB2aWRlbywgYnVja2V0cywga2V5d29yZHMgfSk7XG4gIH1cblxuICBjb25zdCBzZWdtZW50czogVHJhbnNjcmlwdFNlZ21lbnRbXSA9IGN1ZXMubWFwKChjdWUsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgZW5lcmd5ID0gZW5lcmd5Rm9yUmFuZ2UoYnVja2V0cywgY3VlLnN0YXJ0U2VjLCBjdWUuZW5kU2VjKTtcbiAgICBjb25zdCB0ZXh0ID0gY3VlLnRleHQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGAke3ZpZGVvLnZpZGVvSWR9LSR7aW5kZXggKyAxfWAsXG4gICAgICBzdGFydFNlYzogY3VlLnN0YXJ0U2VjLFxuICAgICAgZW5kU2VjOiBjdWUuZW5kU2VjLFxuICAgICAgdGV4dCxcbiAgICAgIGVuZXJneSxcbiAgICAgIGVtb3Rpb246IGVzdGltYXRlRW1vdGlvbih0ZXh0LCBlbmVyZ3kpLFxuICAgICAgdGFnczogZmluZFRhZ3ModGV4dCwgZW5lcmd5KSxcbiAgICB9O1xuICB9KTtcblxuICBsb2c/LihgVHJhbnNjcmnDp8OjbyBwcm9udGEgY29tICR7c2VnbWVudHMubGVuZ3RofSBzZWdtZW50b3NgKTtcbiAgcmV0dXJuIHNlZ21lbnRzO1xufVxuIl0sIm5hbWVzIjpbImV4ZWNGaWxlIiwicHJvbWlzZXMiLCJmcyIsInByb21pc2lmeSIsImdldEZmbXBlZ0JpbmFyeVBhdGgiLCJnZXRBdWRpb1BjbVBhdGgiLCJleGVjRmlsZUFzeW5jIiwiVEFHX1JVTEVTIiwidGFnIiwicmVnZXgiLCJTVE9QV09SRFMiLCJTZXQiLCJjbGVhblRleHQiLCJ0ZXh0IiwicmVwbGFjZSIsInRyaW0iLCJwYXJzZVRpbWVzdGFtcCIsInJhdyIsImNsZWFuIiwicGFydHMiLCJzcGxpdCIsIm1hcCIsIk51bWJlciIsImxlbmd0aCIsImhoIiwibW0iLCJzcyIsInBhcnNlVnR0IiwiY29udGVudCIsImxpbmVzIiwiY3VlcyIsImluZGV4IiwibGluZSIsImluY2x1ZGVzIiwic3RhcnRSYXciLCJlbmRSYXdXaXRoU2V0dGluZ3MiLCJlbmRSYXciLCJzdGFydFNlYyIsImVuZFNlYyIsInRleHRMaW5lcyIsInB1c2giLCJqb2luIiwiZmluZFRhZ3MiLCJlbmVyZ3kiLCJtYXRjaGVkIiwiZmlsdGVyIiwicnVsZSIsInRlc3QiLCJlc3RpbWF0ZUVtb3Rpb24iLCJwdW5jdHVhdGlvbkJvb3N0IiwibWF0Y2giLCJ1cHBlcmNhc2VCb29zdCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJleHRyYWN0RW5lcmd5QnVja2V0cyIsInBhcmFtcyIsInNvdXJjZVZpZGVvUGF0aCIsImF1ZGlvUGNtUGF0aCIsImR1cmF0aW9uU2VjIiwiZmZtcGVnQmluIiwicGNtIiwicmVhZEZpbGUiLCJzYW1wbGVSYXRlIiwic2FtcGxlc1BlcldpbmRvdyIsInRvdGFsU2FtcGxlcyIsImZsb29yIiwiYnVja2V0cyIsIm1heFJtcyIsIm9mZnNldCIsImVuZCIsImNvdW50Iiwic3VtU3F1YXJlcyIsInNhbXBsZSIsImludDE2IiwicmVhZEludDE2TEUiLCJub3JtYWxpemVkIiwicm1zIiwic3FydCIsIm5vcm1hbGl6ZXIiLCJidWNrZXQiLCJlbmVyZ3lGb3JSYW5nZSIsIm1hdGNoaW5nIiwibmVhcmVzdCIsImZpbmQiLCJzdW0iLCJyZWR1Y2UiLCJhY2MiLCJleHRyYWN0S2V5d29yZHMiLCJ2aWRlbyIsImtleXdvcmRIaW50cyIsImRlc2NyaXB0aW9uSGludCIsImJhc2UiLCJ0aXRsZSIsImZyZXEiLCJNYXAiLCJ0b2tlbiIsIm5vcm1hbGl6ZSIsInRvTG93ZXJDYXNlIiwicGFydCIsImhhcyIsInNldCIsImdldCIsImVudHJpZXMiLCJzb3J0IiwiYSIsImIiLCJzbGljZSIsIndvcmQiLCJmYWxsYmFja1NlZ21lbnRzRnJvbUVuZXJneSIsImtleXdvcmRzIiwic2VnbWVudHMiLCJ3aW5kb3dTZWMiLCJzdGFydCIsImZvY3VzIiwiaWQiLCJ2aWRlb0lkIiwiZW1vdGlvbiIsInRhZ3MiLCJ0cmFuc2NyaWJlWW91VHViZVZpZGVvIiwiam9iSWQiLCJzdWJ0aXRsZVZ0dFBhdGgiLCJsb2ciLCJ2dHQiLCJjdWUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/transcription.ts\n");

/***/ }),

/***/ "(rsc)/./lib/viral.ts":
/*!**********************!*\
  !*** ./lib/viral.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateSeoPack: () => (/* binding */ generateSeoPack),\n/* harmony export */   generateViralCuts: () => (/* binding */ generateViralCuts)\n/* harmony export */ });\nconst HOOK_TERMS = [\n    \"agora\",\n    \"ninguem\",\n    \"virada\",\n    \"erro\",\n    \"absurdo\",\n    \"detalhe\",\n    \"chocante\"\n];\nconst CURIOSITY_TERMS = [\n    \"como\",\n    \"por que\",\n    \"segredo\",\n    \"quase\",\n    \"detalhe\",\n    \"numero\",\n    \"curiosidade\"\n];\nconst CONTROVERSY_TERMS = [\n    \"pol\",\n    \"controvers\",\n    \"discorda\",\n    \"treta\",\n    \"debate\",\n    \"absurdo\"\n];\nconst HUMOR_TERMS = [\n    \"meme\",\n    \"engracado\",\n    \"rir\",\n    \"zoeira\",\n    \"risos\",\n    \"haha\"\n];\nconst STORY_TERMS = [\n    \"historia\",\n    \"aconteceu\",\n    \"virada\",\n    \"quando\",\n    \"entao\",\n    \"depois\"\n];\nconst VALUE_TERMS = [\n    \"estrategia\",\n    \"reten\",\n    \"resultado\",\n    \"explicacao\",\n    \"aplicar\",\n    \"dica\",\n    \"aprendi\"\n];\nconst HIGHLIGHT_TERMS = [\n    \"viral\",\n    \"reten\",\n    \"gancho\",\n    \"meme\",\n    \"controversa\",\n    \"detalhe\",\n    \"resultado\",\n    \"agora\",\n    \"chocante\",\n    \"absurdo\"\n];\nconst EMOJIS = [\n    \"🔥\",\n    \"😮\",\n    \"👀\",\n    \"⚡\",\n    \"💥\",\n    \"🎯\",\n    \"🤯\"\n];\nconst HASHTAG_BANK = {\n    hook: [\n        \"#HookPerfeito\",\n        \"#RetencaoAlta\",\n        \"#AberturaForte\"\n    ],\n    curiosity: [\n        \"#Curiosidade\",\n        \"#VejaIsso\",\n        \"#NaoPule\"\n    ],\n    controversy: [\n        \"#OpiniaoForte\",\n        \"#Debate\",\n        \"#Polêmica\"\n    ],\n    humor: [\n        \"#Humor\",\n        \"#Meme\",\n        \"#CorteEngracado\"\n    ],\n    storytelling: [\n        \"#Storytelling\",\n        \"#PlotTwist\",\n        \"#HistoriaReal\"\n    ],\n    value: [\n        \"#DicaRapida\",\n        \"#CriadorDeConteudo\",\n        \"#MarketingDigital\"\n    ]\n};\nfunction normalize(text) {\n    return text.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase();\n}\nfunction countTerms(text, terms) {\n    return terms.reduce((acc, term)=>{\n        return acc + (text.includes(term) ? 1 : 0);\n    }, 0);\n}\nfunction scoreSegment(segment, totalDuration) {\n    const normalized = normalize(segment.text);\n    const isEarlyHookWindow = segment.startSec < 30;\n    const timeFactor = 1 - segment.startSec / Math.max(totalDuration, 1);\n    const signals = {\n        hook: Math.min(100, countTerms(normalized, HOOK_TERMS) * 20 + (isEarlyHookWindow ? 20 : 0) + segment.energy * 20),\n        curiosity: Math.min(100, countTerms(normalized, CURIOSITY_TERMS) * 20 + 12),\n        controversy: Math.min(100, countTerms(normalized, CONTROVERSY_TERMS) * 34),\n        humor: Math.min(100, countTerms(normalized, HUMOR_TERMS) * 36),\n        storytelling: Math.min(100, countTerms(normalized, STORY_TERMS) * 16 + 8),\n        value: Math.min(100, countTerms(normalized, VALUE_TERMS) * 20 + 10),\n        emotion: Math.round(segment.emotion * 100)\n    };\n    const weighted = signals.hook * 0.21 + signals.curiosity * 0.17 + signals.controversy * 0.14 + signals.humor * 0.14 + signals.storytelling * 0.12 + signals.value * 0.1 + signals.emotion * 0.07 + segment.energy * 100 * 0.05;\n    const score = Math.round(Math.min(100, weighted + timeFactor * 7));\n    return {\n        segment,\n        score,\n        signals\n    };\n}\nfunction angleFromSignals(signals) {\n    const pairs = [\n        [\n            \"hook\",\n            signals.hook\n        ],\n        [\n            \"curiosity\",\n            signals.curiosity\n        ],\n        [\n            \"controversy\",\n            signals.controversy\n        ],\n        [\n            \"humor\",\n            signals.humor\n        ],\n        [\n            \"storytelling\",\n            signals.storytelling\n        ],\n        [\n            \"value\",\n            signals.value\n        ]\n    ];\n    pairs.sort((a, b)=>b[1] - a[1]);\n    return pairs[0][0];\n}\nfunction clipTitle(angle, baseText, index) {\n    const sentence = baseText.replace(/\\.$/, \"\");\n    const templates = {\n        hook: [\n            `Gancho forte para segurar audiência (${index + 1})`,\n            `Abertura com alto potencial de retenção`\n        ],\n        curiosity: [\n            `Trecho que gera curiosidade instantânea`,\n            `Esse detalhe prende até o final`\n        ],\n        controversy: [\n            `Momento polêmico para aumentar comentários`,\n            `Trecho que divide opiniões e gera debate`\n        ],\n        humor: [\n            `Corte com humor e replay alto`,\n            `Timing engraçado para Shorts e Reels`\n        ],\n        storytelling: [\n            `Virada de narrativa em menos de 1 minuto`,\n            `Storytelling com ritmo de retenção`\n        ],\n        value: [\n            `Dica rápida com valor imediato`,\n            `Explicação prática com potencial viral`\n        ]\n    };\n    const fallback = sentence.length > 45 ? `${sentence.slice(0, 45)}...` : sentence;\n    return templates[angle][index % templates[angle].length] || fallback;\n}\nfunction buildSubtitlesFromSegments(windowSegments) {\n    const tokens = [];\n    for (const segment of windowSegments){\n        const words = segment.text.split(/\\s+/).filter(Boolean).slice(0, 20);\n        if (words.length === 0) continue;\n        const segmentDuration = Math.max(0.7, segment.endSec - segment.startSec);\n        const step = segmentDuration / words.length;\n        for(let index = 0; index < words.length; index += 1){\n            const word = words[index].replace(/[.,!?]/g, \"\");\n            if (!word) continue;\n            const normalized = normalize(word);\n            const highlight = HIGHLIGHT_TERMS.some((term)=>normalized.includes(term));\n            const emoji = highlight && (tokens.length + index) % 5 === 0 ? EMOJIS[(tokens.length + index) % EMOJIS.length] : undefined;\n            tokens.push({\n                time: Number((segment.startSec + step * index).toFixed(2)),\n                text: word,\n                highlight,\n                emoji\n            });\n        }\n    }\n    return tokens.slice(0, 90);\n}\nfunction buildFallbackSubtitles(text, startSec) {\n    const words = text.split(/\\s+/).filter(Boolean).slice(0, 18);\n    return words.map((word, index)=>({\n            time: Number((startSec + index * 0.45).toFixed(2)),\n            text: word,\n            highlight: index % 4 === 0,\n            emoji: index % 6 === 0 ? EMOJIS[index % EMOJIS.length] : undefined\n        }));\n}\nfunction rangeOverlap(aStart, aEnd, bStart, bEnd) {\n    return Math.max(0, Math.min(aEnd, bEnd) - Math.max(aStart, bStart));\n}\nfunction chooseHashtags(angle, extraTags) {\n    const fromAngle = HASHTAG_BANK[angle];\n    const always = [\n        \"#TikTokBrasil\",\n        \"#YouTubeShorts\",\n        \"#CortesVirais\"\n    ];\n    const dynamic = extraTags.map((tag)=>`#${tag.replace(/[^a-z0-9]/gi, \"\")}`).slice(0, 2);\n    return Array.from(new Set([\n        ...fromAngle,\n        ...always,\n        ...dynamic\n    ]));\n}\nfunction generateViralCuts(params) {\n    const { videoTitle, segments, durationSec } = params;\n    const requestedCuts = Math.min(10, Math.max(3, params.requestedCuts ?? 5));\n    const scored = segments.map((segment)=>scoreSegment(segment, durationSec));\n    scored.sort((a, b)=>b.score - a.score);\n    const selected = [];\n    for (const candidate of scored){\n        if (selected.length >= requestedCuts) break;\n        const targetDuration = Math.max(30, Math.min(75, 30 + Math.round(candidate.score * 0.32)));\n        const startSec = Math.max(0, candidate.segment.startSec - 5);\n        const endSec = Math.min(durationSec, startSec + targetDuration);\n        const duration = Math.round(endSec - startSec);\n        if (duration < 30) continue;\n        const overlap = selected.some((clip)=>{\n            const amount = rangeOverlap(startSec, endSec, clip.startSec, clip.endSec);\n            return amount > 14;\n        });\n        if (overlap) continue;\n        const windowSegments = segments.filter((segment)=>segment.startSec < endSec && segment.endSec > startSec);\n        const snippet = windowSegments.slice(0, 4).map((segment)=>segment.text).join(\" \").slice(0, 420).trim();\n        const angle = angleFromSignals(candidate.signals);\n        const hashtags = chooseHashtags(angle, candidate.segment.tags);\n        const title = clipTitle(angle, candidate.segment.text, selected.length);\n        const subtitles = windowSegments.length > 0 ? buildSubtitlesFromSegments(windowSegments) : buildFallbackSubtitles(candidate.segment.text, startSec);\n        selected.push({\n            id: `clip-${selected.length + 1}-${candidate.segment.id.slice(-8)}`,\n            title,\n            score: candidate.score,\n            angle,\n            startSec,\n            endSec,\n            durationSec: duration,\n            hookLine: candidate.segment.text,\n            transcriptSnippet: snippet || candidate.segment.text,\n            hashtags,\n            suggestedDescription: `Recorte de ${videoTitle} com foco em ${angle}. Corte otimizado para retenção e compartilhamento rápido.`,\n            subtitles,\n            ffmpegPlan: [],\n            previewUrl: \"\",\n            downloadUrl: \"\",\n            render: {\n                aspectRatio: \"9:16\",\n                zoomMode: \"face-smart\",\n                cameraStyle: \"dynamic-cut\",\n                captionsStyle: \"reels-bold\",\n                headline: title,\n                showProgressBar: true\n            },\n            signals: candidate.signals\n        });\n    }\n    if (selected.length === 0) {\n        const fallbackStart = 0;\n        const fallbackEnd = Math.min(durationSec, 35);\n        selected.push({\n            id: \"clip-1-fallback\",\n            title: \"Trecho inicial com potencial de retenção\",\n            score: 45,\n            angle: \"hook\",\n            startSec: fallbackStart,\n            endSec: fallbackEnd,\n            durationSec: Math.round(fallbackEnd - fallbackStart),\n            hookLine: segments[0]?.text ?? \"Início do vídeo\",\n            transcriptSnippet: segments.slice(0, 4).map((segment)=>segment.text).join(\" \"),\n            hashtags: [\n                \"#CortesVirais\",\n                \"#Shorts\",\n                \"#TikTokBrasil\"\n            ],\n            suggestedDescription: \"Trecho inicial otimizado para retenção.\",\n            subtitles: buildFallbackSubtitles(segments[0]?.text ?? \"Trecho inicial\", fallbackStart),\n            ffmpegPlan: [],\n            previewUrl: \"\",\n            downloadUrl: \"\",\n            render: {\n                aspectRatio: \"9:16\",\n                zoomMode: \"face-smart\",\n                cameraStyle: \"dynamic-cut\",\n                captionsStyle: \"reels-bold\",\n                headline: \"Corte sugerido\",\n                showProgressBar: true\n            },\n            signals: {\n                hook: 55,\n                curiosity: 35,\n                controversy: 10,\n                humor: 10,\n                storytelling: 30,\n                value: 35,\n                emotion: 40\n            }\n        });\n    }\n    return selected.slice(0, requestedCuts);\n}\nfunction generateSeoPack(sourceText, contextTitle) {\n    const normalized = sourceText.trim().slice(0, 240);\n    const base = contextTitle?.trim() || \"corte viral\";\n    const titles = [\n        `${base}: o trecho que prendeu geral`,\n        `Esse momento de ${base.toLowerCase()} está absurdo`,\n        `Poucos segundos de ${base.toLowerCase()} que geram replay`,\n        `O melhor corte de ${base.toLowerCase()} para Shorts`,\n        `Se liga nesse recorte de ${base.toLowerCase()}!`\n    ];\n    const description = `🎬 ${normalized}\\n\\nEsse corte foi otimizado para retenção, impacto e compartilhamento.\\n\\n#CortesVirais #YouTubeShorts #TikTokBrasil #ReelsBrasil #CreatorEconomy`;\n    return {\n        titles,\n        description,\n        hashtags: [\n            \"#CortesVirais\",\n            \"#YouTubeShorts\",\n            \"#TikTokBrasil\",\n            \"#ReelsBrasil\",\n            \"#ConteudoDigital\"\n        ]\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBQ1g7UUFDRjtJQUNGO0lBRUEsT0FBTzRELFNBQVMzQyxLQUFLLENBQUMsR0FBR3lDO0FBQzNCO0FBRU8sU0FBU2dDLGdCQUFnQkMsVUFBa0IsRUFBRUMsWUFBcUI7SUFDdkUsTUFBTXJHLGFBQWFvRyxXQUFXdEIsSUFBSSxHQUFHcEQsS0FBSyxDQUFDLEdBQUc7SUFDOUMsTUFBTTRFLE9BQU9ELGNBQWN2QixVQUFVO0lBRXJDLE1BQU15QixTQUFTO1FBQ2IsR0FBR0QsS0FBSyw0QkFBNEIsQ0FBQztRQUNyQyxDQUFDLGdCQUFnQixFQUFFQSxLQUFLaEgsV0FBVyxHQUFHLGFBQWEsQ0FBQztRQUNwRCxDQUFDLG1CQUFtQixFQUFFZ0gsS0FBS2hILFdBQVcsR0FBRyxpQkFBaUIsQ0FBQztRQUMzRCxDQUFDLGtCQUFrQixFQUFFZ0gsS0FBS2hILFdBQVcsR0FBRyxZQUFZLENBQUM7UUFDckQsQ0FBQyx5QkFBeUIsRUFBRWdILEtBQUtoSCxXQUFXLEdBQUcsQ0FBQyxDQUFDO0tBQ2xEO0lBRUQsTUFBTWtILGNBQWMsQ0FBQyxHQUFHLEVBQUV4RyxXQUFXLGtKQUFrSixDQUFDO0lBRXhMLE9BQU87UUFDTHVHO1FBQ0FDO1FBQ0F6QixVQUFVO1lBQ1I7WUFDQTtZQUNBO1lBQ0E7WUFDQTtTQUNEO0lBQ0g7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2FsbWVpZGFnYWJyaWVsL0RvY3VtZW50cy9DQU5BL2xpYi92aXJhbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJ0aXRsZVRva2VuLCBUcmFuc2NyaXB0U2VnbWVudCwgVmlyYWxDbGlwLCBWaXJhbFNpZ25hbCB9IGZyb20gXCJAL2xpYi90eXBlc1wiO1xuXG5pbnRlcmZhY2UgVmlyYWxDYW5kaWRhdGUge1xuICBzZWdtZW50OiBUcmFuc2NyaXB0U2VnbWVudDtcbiAgc2NvcmU6IG51bWJlcjtcbiAgc2lnbmFsczogVmlyYWxTaWduYWw7XG59XG5cbmNvbnN0IEhPT0tfVEVSTVMgPSBbXCJhZ29yYVwiLCBcIm5pbmd1ZW1cIiwgXCJ2aXJhZGFcIiwgXCJlcnJvXCIsIFwiYWJzdXJkb1wiLCBcImRldGFsaGVcIiwgXCJjaG9jYW50ZVwiXTtcbmNvbnN0IENVUklPU0lUWV9URVJNUyA9IFtcImNvbW9cIiwgXCJwb3IgcXVlXCIsIFwic2VncmVkb1wiLCBcInF1YXNlXCIsIFwiZGV0YWxoZVwiLCBcIm51bWVyb1wiLCBcImN1cmlvc2lkYWRlXCJdO1xuY29uc3QgQ09OVFJPVkVSU1lfVEVSTVMgPSBbXCJwb2xcIiwgXCJjb250cm92ZXJzXCIsIFwiZGlzY29yZGFcIiwgXCJ0cmV0YVwiLCBcImRlYmF0ZVwiLCBcImFic3VyZG9cIl07XG5jb25zdCBIVU1PUl9URVJNUyA9IFtcIm1lbWVcIiwgXCJlbmdyYWNhZG9cIiwgXCJyaXJcIiwgXCJ6b2VpcmFcIiwgXCJyaXNvc1wiLCBcImhhaGFcIl07XG5jb25zdCBTVE9SWV9URVJNUyA9IFtcImhpc3RvcmlhXCIsIFwiYWNvbnRlY2V1XCIsIFwidmlyYWRhXCIsIFwicXVhbmRvXCIsIFwiZW50YW9cIiwgXCJkZXBvaXNcIl07XG5jb25zdCBWQUxVRV9URVJNUyA9IFtcImVzdHJhdGVnaWFcIiwgXCJyZXRlblwiLCBcInJlc3VsdGFkb1wiLCBcImV4cGxpY2FjYW9cIiwgXCJhcGxpY2FyXCIsIFwiZGljYVwiLCBcImFwcmVuZGlcIl07XG5cbmNvbnN0IEhJR0hMSUdIVF9URVJNUyA9IFtcbiAgXCJ2aXJhbFwiLFxuICBcInJldGVuXCIsXG4gIFwiZ2FuY2hvXCIsXG4gIFwibWVtZVwiLFxuICBcImNvbnRyb3ZlcnNhXCIsXG4gIFwiZGV0YWxoZVwiLFxuICBcInJlc3VsdGFkb1wiLFxuICBcImFnb3JhXCIsXG4gIFwiY2hvY2FudGVcIixcbiAgXCJhYnN1cmRvXCIsXG5dO1xuXG5jb25zdCBFTU9KSVMgPSBbXCLwn5SlXCIsIFwi8J+YrlwiLCBcIvCfkYBcIiwgXCLimqFcIiwgXCLwn5KlXCIsIFwi8J+Or1wiLCBcIvCfpK9cIl07XG5cbmNvbnN0IEhBU0hUQUdfQkFOSyA9IHtcbiAgaG9vazogW1wiI0hvb2tQZXJmZWl0b1wiLCBcIiNSZXRlbmNhb0FsdGFcIiwgXCIjQWJlcnR1cmFGb3J0ZVwiXSxcbiAgY3VyaW9zaXR5OiBbXCIjQ3VyaW9zaWRhZGVcIiwgXCIjVmVqYUlzc29cIiwgXCIjTmFvUHVsZVwiXSxcbiAgY29udHJvdmVyc3k6IFtcIiNPcGluaWFvRm9ydGVcIiwgXCIjRGViYXRlXCIsIFwiI1BvbMOqbWljYVwiXSxcbiAgaHVtb3I6IFtcIiNIdW1vclwiLCBcIiNNZW1lXCIsIFwiI0NvcnRlRW5ncmFjYWRvXCJdLFxuICBzdG9yeXRlbGxpbmc6IFtcIiNTdG9yeXRlbGxpbmdcIiwgXCIjUGxvdFR3aXN0XCIsIFwiI0hpc3RvcmlhUmVhbFwiXSxcbiAgdmFsdWU6IFtcIiNEaWNhUmFwaWRhXCIsIFwiI0NyaWFkb3JEZUNvbnRldWRvXCIsIFwiI01hcmtldGluZ0RpZ2l0YWxcIl0sXG59O1xuXG5mdW5jdGlvbiBub3JtYWxpemUodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHRleHRcbiAgICAubm9ybWFsaXplKFwiTkZEXCIpXG4gICAgLnJlcGxhY2UoL1tcXHUwMzAwLVxcdTAzNmZdL2csIFwiXCIpXG4gICAgLnRvTG93ZXJDYXNlKCk7XG59XG5cbmZ1bmN0aW9uIGNvdW50VGVybXModGV4dDogc3RyaW5nLCB0ZXJtczogc3RyaW5nW10pOiBudW1iZXIge1xuICByZXR1cm4gdGVybXMucmVkdWNlKChhY2MsIHRlcm0pID0+IHtcbiAgICByZXR1cm4gYWNjICsgKHRleHQuaW5jbHVkZXModGVybSkgPyAxIDogMCk7XG4gIH0sIDApO1xufVxuXG5mdW5jdGlvbiBzY29yZVNlZ21lbnQoc2VnbWVudDogVHJhbnNjcmlwdFNlZ21lbnQsIHRvdGFsRHVyYXRpb246IG51bWJlcik6IFZpcmFsQ2FuZGlkYXRlIHtcbiAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZShzZWdtZW50LnRleHQpO1xuICBjb25zdCBpc0Vhcmx5SG9va1dpbmRvdyA9IHNlZ21lbnQuc3RhcnRTZWMgPCAzMDtcbiAgY29uc3QgdGltZUZhY3RvciA9IDEgLSBzZWdtZW50LnN0YXJ0U2VjIC8gTWF0aC5tYXgodG90YWxEdXJhdGlvbiwgMSk7XG5cbiAgY29uc3Qgc2lnbmFsczogVmlyYWxTaWduYWwgPSB7XG4gICAgaG9vazogTWF0aC5taW4oMTAwLCBjb3VudFRlcm1zKG5vcm1hbGl6ZWQsIEhPT0tfVEVSTVMpICogMjAgKyAoaXNFYXJseUhvb2tXaW5kb3cgPyAyMCA6IDApICsgc2VnbWVudC5lbmVyZ3kgKiAyMCksXG4gICAgY3VyaW9zaXR5OiBNYXRoLm1pbigxMDAsIGNvdW50VGVybXMobm9ybWFsaXplZCwgQ1VSSU9TSVRZX1RFUk1TKSAqIDIwICsgMTIpLFxuICAgIGNvbnRyb3ZlcnN5OiBNYXRoLm1pbigxMDAsIGNvdW50VGVybXMobm9ybWFsaXplZCwgQ09OVFJPVkVSU1lfVEVSTVMpICogMzQpLFxuICAgIGh1bW9yOiBNYXRoLm1pbigxMDAsIGNvdW50VGVybXMobm9ybWFsaXplZCwgSFVNT1JfVEVSTVMpICogMzYpLFxuICAgIHN0b3J5dGVsbGluZzogTWF0aC5taW4oMTAwLCBjb3VudFRlcm1zKG5vcm1hbGl6ZWQsIFNUT1JZX1RFUk1TKSAqIDE2ICsgOCksXG4gICAgdmFsdWU6IE1hdGgubWluKDEwMCwgY291bnRUZXJtcyhub3JtYWxpemVkLCBWQUxVRV9URVJNUykgKiAyMCArIDEwKSxcbiAgICBlbW90aW9uOiBNYXRoLnJvdW5kKHNlZ21lbnQuZW1vdGlvbiAqIDEwMCksXG4gIH07XG5cbiAgY29uc3Qgd2VpZ2h0ZWQgPVxuICAgIHNpZ25hbHMuaG9vayAqIDAuMjEgK1xuICAgIHNpZ25hbHMuY3VyaW9zaXR5ICogMC4xNyArXG4gICAgc2lnbmFscy5jb250cm92ZXJzeSAqIDAuMTQgK1xuICAgIHNpZ25hbHMuaHVtb3IgKiAwLjE0ICtcbiAgICBzaWduYWxzLnN0b3J5dGVsbGluZyAqIDAuMTIgK1xuICAgIHNpZ25hbHMudmFsdWUgKiAwLjEgK1xuICAgIHNpZ25hbHMuZW1vdGlvbiAqIDAuMDcgK1xuICAgIHNlZ21lbnQuZW5lcmd5ICogMTAwICogMC4wNTtcblxuICBjb25zdCBzY29yZSA9IE1hdGgucm91bmQoTWF0aC5taW4oMTAwLCB3ZWlnaHRlZCArIHRpbWVGYWN0b3IgKiA3KSk7XG5cbiAgcmV0dXJuIHsgc2VnbWVudCwgc2NvcmUsIHNpZ25hbHMgfTtcbn1cblxuZnVuY3Rpb24gYW5nbGVGcm9tU2lnbmFscyhzaWduYWxzOiBWaXJhbFNpZ25hbCk6IFZpcmFsQ2xpcFtcImFuZ2xlXCJdIHtcbiAgY29uc3QgcGFpcnM6IEFycmF5PFtWaXJhbENsaXBbXCJhbmdsZVwiXSwgbnVtYmVyXT4gPSBbXG4gICAgW1wiaG9va1wiLCBzaWduYWxzLmhvb2tdLFxuICAgIFtcImN1cmlvc2l0eVwiLCBzaWduYWxzLmN1cmlvc2l0eV0sXG4gICAgW1wiY29udHJvdmVyc3lcIiwgc2lnbmFscy5jb250cm92ZXJzeV0sXG4gICAgW1wiaHVtb3JcIiwgc2lnbmFscy5odW1vcl0sXG4gICAgW1wic3Rvcnl0ZWxsaW5nXCIsIHNpZ25hbHMuc3Rvcnl0ZWxsaW5nXSxcbiAgICBbXCJ2YWx1ZVwiLCBzaWduYWxzLnZhbHVlXSxcbiAgXTtcblxuICBwYWlycy5zb3J0KChhLCBiKSA9PiBiWzFdIC0gYVsxXSk7XG4gIHJldHVybiBwYWlyc1swXVswXTtcbn1cblxuZnVuY3Rpb24gY2xpcFRpdGxlKGFuZ2xlOiBWaXJhbENsaXBbXCJhbmdsZVwiXSwgYmFzZVRleHQ6IHN0cmluZywgaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IHNlbnRlbmNlID0gYmFzZVRleHQucmVwbGFjZSgvXFwuJC8sIFwiXCIpO1xuICBjb25zdCB0ZW1wbGF0ZXM6IFJlY29yZDxWaXJhbENsaXBbXCJhbmdsZVwiXSwgc3RyaW5nW10+ID0ge1xuICAgIGhvb2s6IFtcbiAgICAgIGBHYW5jaG8gZm9ydGUgcGFyYSBzZWd1cmFyIGF1ZGnDqm5jaWEgKCR7aW5kZXggKyAxfSlgLFxuICAgICAgYEFiZXJ0dXJhIGNvbSBhbHRvIHBvdGVuY2lhbCBkZSByZXRlbsOnw6NvYCxcbiAgICBdLFxuICAgIGN1cmlvc2l0eTogW1xuICAgICAgYFRyZWNobyBxdWUgZ2VyYSBjdXJpb3NpZGFkZSBpbnN0YW50w6JuZWFgLFxuICAgICAgYEVzc2UgZGV0YWxoZSBwcmVuZGUgYXTDqSBvIGZpbmFsYCxcbiAgICBdLFxuICAgIGNvbnRyb3ZlcnN5OiBbXG4gICAgICBgTW9tZW50byBwb2zDqm1pY28gcGFyYSBhdW1lbnRhciBjb21lbnTDoXJpb3NgLFxuICAgICAgYFRyZWNobyBxdWUgZGl2aWRlIG9waW5pw7VlcyBlIGdlcmEgZGViYXRlYCxcbiAgICBdLFxuICAgIGh1bW9yOiBbXG4gICAgICBgQ29ydGUgY29tIGh1bW9yIGUgcmVwbGF5IGFsdG9gLFxuICAgICAgYFRpbWluZyBlbmdyYcOnYWRvIHBhcmEgU2hvcnRzIGUgUmVlbHNgLFxuICAgIF0sXG4gICAgc3Rvcnl0ZWxsaW5nOiBbXG4gICAgICBgVmlyYWRhIGRlIG5hcnJhdGl2YSBlbSBtZW5vcyBkZSAxIG1pbnV0b2AsXG4gICAgICBgU3Rvcnl0ZWxsaW5nIGNvbSByaXRtbyBkZSByZXRlbsOnw6NvYCxcbiAgICBdLFxuICAgIHZhbHVlOiBbXG4gICAgICBgRGljYSByw6FwaWRhIGNvbSB2YWxvciBpbWVkaWF0b2AsXG4gICAgICBgRXhwbGljYcOnw6NvIHByw6F0aWNhIGNvbSBwb3RlbmNpYWwgdmlyYWxgLFxuICAgIF0sXG4gIH07XG5cbiAgY29uc3QgZmFsbGJhY2sgPSBzZW50ZW5jZS5sZW5ndGggPiA0NSA/IGAke3NlbnRlbmNlLnNsaWNlKDAsIDQ1KX0uLi5gIDogc2VudGVuY2U7XG4gIHJldHVybiB0ZW1wbGF0ZXNbYW5nbGVdW2luZGV4ICUgdGVtcGxhdGVzW2FuZ2xlXS5sZW5ndGhdIHx8IGZhbGxiYWNrO1xufVxuXG5mdW5jdGlvbiBidWlsZFN1YnRpdGxlc0Zyb21TZWdtZW50cyh3aW5kb3dTZWdtZW50czogVHJhbnNjcmlwdFNlZ21lbnRbXSk6IFN1YnRpdGxlVG9rZW5bXSB7XG4gIGNvbnN0IHRva2VuczogU3VidGl0bGVUb2tlbltdID0gW107XG5cbiAgZm9yIChjb25zdCBzZWdtZW50IG9mIHdpbmRvd1NlZ21lbnRzKSB7XG4gICAgY29uc3Qgd29yZHMgPSBzZWdtZW50LnRleHQuc3BsaXQoL1xccysvKS5maWx0ZXIoQm9vbGVhbikuc2xpY2UoMCwgMjApO1xuICAgIGlmICh3b3Jkcy5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuXG4gICAgY29uc3Qgc2VnbWVudER1cmF0aW9uID0gTWF0aC5tYXgoMC43LCBzZWdtZW50LmVuZFNlYyAtIHNlZ21lbnQuc3RhcnRTZWMpO1xuICAgIGNvbnN0IHN0ZXAgPSBzZWdtZW50RHVyYXRpb24gLyB3b3Jkcy5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgd29yZHMubGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgICBjb25zdCB3b3JkID0gd29yZHNbaW5kZXhdLnJlcGxhY2UoL1suLCE/XS9nLCBcIlwiKTtcbiAgICAgIGlmICghd29yZCkgY29udGludWU7XG5cbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemUod29yZCk7XG4gICAgICBjb25zdCBoaWdobGlnaHQgPSBISUdITElHSFRfVEVSTVMuc29tZSgodGVybSkgPT4gbm9ybWFsaXplZC5pbmNsdWRlcyh0ZXJtKSk7XG4gICAgICBjb25zdCBlbW9qaSA9IGhpZ2hsaWdodCAmJiAodG9rZW5zLmxlbmd0aCArIGluZGV4KSAlIDUgPT09IDAgPyBFTU9KSVNbKHRva2Vucy5sZW5ndGggKyBpbmRleCkgJSBFTU9KSVMubGVuZ3RoXSA6IHVuZGVmaW5lZDtcblxuICAgICAgdG9rZW5zLnB1c2goe1xuICAgICAgICB0aW1lOiBOdW1iZXIoKHNlZ21lbnQuc3RhcnRTZWMgKyBzdGVwICogaW5kZXgpLnRvRml4ZWQoMikpLFxuICAgICAgICB0ZXh0OiB3b3JkLFxuICAgICAgICBoaWdobGlnaHQsXG4gICAgICAgIGVtb2ppLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRva2Vucy5zbGljZSgwLCA5MCk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRmFsbGJhY2tTdWJ0aXRsZXModGV4dDogc3RyaW5nLCBzdGFydFNlYzogbnVtYmVyKTogU3VidGl0bGVUb2tlbltdIHtcbiAgY29uc3Qgd29yZHMgPSB0ZXh0LnNwbGl0KC9cXHMrLykuZmlsdGVyKEJvb2xlYW4pLnNsaWNlKDAsIDE4KTtcbiAgcmV0dXJuIHdvcmRzLm1hcCgod29yZCwgaW5kZXgpID0+ICh7XG4gICAgdGltZTogTnVtYmVyKChzdGFydFNlYyArIGluZGV4ICogMC40NSkudG9GaXhlZCgyKSksXG4gICAgdGV4dDogd29yZCxcbiAgICBoaWdobGlnaHQ6IGluZGV4ICUgNCA9PT0gMCxcbiAgICBlbW9qaTogaW5kZXggJSA2ID09PSAwID8gRU1PSklTW2luZGV4ICUgRU1PSklTLmxlbmd0aF0gOiB1bmRlZmluZWQsXG4gIH0pKTtcbn1cblxuZnVuY3Rpb24gcmFuZ2VPdmVybGFwKGFTdGFydDogbnVtYmVyLCBhRW5kOiBudW1iZXIsIGJTdGFydDogbnVtYmVyLCBiRW5kOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oYUVuZCwgYkVuZCkgLSBNYXRoLm1heChhU3RhcnQsIGJTdGFydCkpO1xufVxuXG5mdW5jdGlvbiBjaG9vc2VIYXNodGFncyhhbmdsZTogVmlyYWxDbGlwW1wiYW5nbGVcIl0sIGV4dHJhVGFnczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IGZyb21BbmdsZSA9IEhBU0hUQUdfQkFOS1thbmdsZV07XG4gIGNvbnN0IGFsd2F5cyA9IFtcIiNUaWtUb2tCcmFzaWxcIiwgXCIjWW91VHViZVNob3J0c1wiLCBcIiNDb3J0ZXNWaXJhaXNcIl07XG4gIGNvbnN0IGR5bmFtaWMgPSBleHRyYVRhZ3MubWFwKCh0YWcpID0+IGAjJHt0YWcucmVwbGFjZSgvW15hLXowLTldL2dpLCBcIlwiKX1gKS5zbGljZSgwLCAyKTtcblxuICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KFsuLi5mcm9tQW5nbGUsIC4uLmFsd2F5cywgLi4uZHluYW1pY10pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVmlyYWxDdXRzKHBhcmFtczoge1xuICB2aWRlb1RpdGxlOiBzdHJpbmc7XG4gIHNlZ21lbnRzOiBUcmFuc2NyaXB0U2VnbWVudFtdO1xuICBkdXJhdGlvblNlYzogbnVtYmVyO1xuICByZXF1ZXN0ZWRDdXRzPzogbnVtYmVyO1xufSk6IFZpcmFsQ2xpcFtdIHtcbiAgY29uc3QgeyB2aWRlb1RpdGxlLCBzZWdtZW50cywgZHVyYXRpb25TZWMgfSA9IHBhcmFtcztcbiAgY29uc3QgcmVxdWVzdGVkQ3V0cyA9IE1hdGgubWluKDEwLCBNYXRoLm1heCgzLCBwYXJhbXMucmVxdWVzdGVkQ3V0cyA/PyA1KSk7XG5cbiAgY29uc3Qgc2NvcmVkID0gc2VnbWVudHMubWFwKChzZWdtZW50KSA9PiBzY29yZVNlZ21lbnQoc2VnbWVudCwgZHVyYXRpb25TZWMpKTtcbiAgc2NvcmVkLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcblxuICBjb25zdCBzZWxlY3RlZDogVmlyYWxDbGlwW10gPSBbXTtcblxuICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiBzY29yZWQpIHtcbiAgICBpZiAoc2VsZWN0ZWQubGVuZ3RoID49IHJlcXVlc3RlZEN1dHMpIGJyZWFrO1xuXG4gICAgY29uc3QgdGFyZ2V0RHVyYXRpb24gPSBNYXRoLm1heCgzMCwgTWF0aC5taW4oNzUsIDMwICsgTWF0aC5yb3VuZChjYW5kaWRhdGUuc2NvcmUgKiAwLjMyKSkpO1xuICAgIGNvbnN0IHN0YXJ0U2VjID0gTWF0aC5tYXgoMCwgY2FuZGlkYXRlLnNlZ21lbnQuc3RhcnRTZWMgLSA1KTtcbiAgICBjb25zdCBlbmRTZWMgPSBNYXRoLm1pbihkdXJhdGlvblNlYywgc3RhcnRTZWMgKyB0YXJnZXREdXJhdGlvbik7XG4gICAgY29uc3QgZHVyYXRpb24gPSBNYXRoLnJvdW5kKGVuZFNlYyAtIHN0YXJ0U2VjKTtcblxuICAgIGlmIChkdXJhdGlvbiA8IDMwKSBjb250aW51ZTtcblxuICAgIGNvbnN0IG92ZXJsYXAgPSBzZWxlY3RlZC5zb21lKChjbGlwKSA9PiB7XG4gICAgICBjb25zdCBhbW91bnQgPSByYW5nZU92ZXJsYXAoc3RhcnRTZWMsIGVuZFNlYywgY2xpcC5zdGFydFNlYywgY2xpcC5lbmRTZWMpO1xuICAgICAgcmV0dXJuIGFtb3VudCA+IDE0O1xuICAgIH0pO1xuXG4gICAgaWYgKG92ZXJsYXApIGNvbnRpbnVlO1xuXG4gICAgY29uc3Qgd2luZG93U2VnbWVudHMgPSBzZWdtZW50cy5maWx0ZXIoXG4gICAgICAoc2VnbWVudCkgPT4gc2VnbWVudC5zdGFydFNlYyA8IGVuZFNlYyAmJiBzZWdtZW50LmVuZFNlYyA+IHN0YXJ0U2VjXG4gICAgKTtcblxuICAgIGNvbnN0IHNuaXBwZXQgPSB3aW5kb3dTZWdtZW50c1xuICAgICAgLnNsaWNlKDAsIDQpXG4gICAgICAubWFwKChzZWdtZW50KSA9PiBzZWdtZW50LnRleHQpXG4gICAgICAuam9pbihcIiBcIilcbiAgICAgIC5zbGljZSgwLCA0MjApXG4gICAgICAudHJpbSgpO1xuXG4gICAgY29uc3QgYW5nbGUgPSBhbmdsZUZyb21TaWduYWxzKGNhbmRpZGF0ZS5zaWduYWxzKTtcbiAgICBjb25zdCBoYXNodGFncyA9IGNob29zZUhhc2h0YWdzKGFuZ2xlLCBjYW5kaWRhdGUuc2VnbWVudC50YWdzKTtcbiAgICBjb25zdCB0aXRsZSA9IGNsaXBUaXRsZShhbmdsZSwgY2FuZGlkYXRlLnNlZ21lbnQudGV4dCwgc2VsZWN0ZWQubGVuZ3RoKTtcblxuICAgIGNvbnN0IHN1YnRpdGxlcyA9XG4gICAgICB3aW5kb3dTZWdtZW50cy5sZW5ndGggPiAwXG4gICAgICAgID8gYnVpbGRTdWJ0aXRsZXNGcm9tU2VnbWVudHMod2luZG93U2VnbWVudHMpXG4gICAgICAgIDogYnVpbGRGYWxsYmFja1N1YnRpdGxlcyhjYW5kaWRhdGUuc2VnbWVudC50ZXh0LCBzdGFydFNlYyk7XG5cbiAgICBzZWxlY3RlZC5wdXNoKHtcbiAgICAgIGlkOiBgY2xpcC0ke3NlbGVjdGVkLmxlbmd0aCArIDF9LSR7Y2FuZGlkYXRlLnNlZ21lbnQuaWQuc2xpY2UoLTgpfWAsXG4gICAgICB0aXRsZSxcbiAgICAgIHNjb3JlOiBjYW5kaWRhdGUuc2NvcmUsXG4gICAgICBhbmdsZSxcbiAgICAgIHN0YXJ0U2VjLFxuICAgICAgZW5kU2VjLFxuICAgICAgZHVyYXRpb25TZWM6IGR1cmF0aW9uLFxuICAgICAgaG9va0xpbmU6IGNhbmRpZGF0ZS5zZWdtZW50LnRleHQsXG4gICAgICB0cmFuc2NyaXB0U25pcHBldDogc25pcHBldCB8fCBjYW5kaWRhdGUuc2VnbWVudC50ZXh0LFxuICAgICAgaGFzaHRhZ3MsXG4gICAgICBzdWdnZXN0ZWREZXNjcmlwdGlvbjogYFJlY29ydGUgZGUgJHt2aWRlb1RpdGxlfSBjb20gZm9jbyBlbSAke2FuZ2xlfS4gQ29ydGUgb3RpbWl6YWRvIHBhcmEgcmV0ZW7Dp8OjbyBlIGNvbXBhcnRpbGhhbWVudG8gcsOhcGlkby5gLFxuICAgICAgc3VidGl0bGVzLFxuICAgICAgZmZtcGVnUGxhbjogW10sXG4gICAgICBwcmV2aWV3VXJsOiBcIlwiLFxuICAgICAgZG93bmxvYWRVcmw6IFwiXCIsXG4gICAgICByZW5kZXI6IHtcbiAgICAgICAgYXNwZWN0UmF0aW86IFwiOToxNlwiLFxuICAgICAgICB6b29tTW9kZTogXCJmYWNlLXNtYXJ0XCIsXG4gICAgICAgIGNhbWVyYVN0eWxlOiBcImR5bmFtaWMtY3V0XCIsXG4gICAgICAgIGNhcHRpb25zU3R5bGU6IFwicmVlbHMtYm9sZFwiLFxuICAgICAgICBoZWFkbGluZTogdGl0bGUsXG4gICAgICAgIHNob3dQcm9ncmVzc0JhcjogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBzaWduYWxzOiBjYW5kaWRhdGUuc2lnbmFscyxcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChzZWxlY3RlZC5sZW5ndGggPT09IDApIHtcbiAgICBjb25zdCBmYWxsYmFja1N0YXJ0ID0gMDtcbiAgICBjb25zdCBmYWxsYmFja0VuZCA9IE1hdGgubWluKGR1cmF0aW9uU2VjLCAzNSk7XG5cbiAgICBzZWxlY3RlZC5wdXNoKHtcbiAgICAgIGlkOiBcImNsaXAtMS1mYWxsYmFja1wiLFxuICAgICAgdGl0bGU6IFwiVHJlY2hvIGluaWNpYWwgY29tIHBvdGVuY2lhbCBkZSByZXRlbsOnw6NvXCIsXG4gICAgICBzY29yZTogNDUsXG4gICAgICBhbmdsZTogXCJob29rXCIsXG4gICAgICBzdGFydFNlYzogZmFsbGJhY2tTdGFydCxcbiAgICAgIGVuZFNlYzogZmFsbGJhY2tFbmQsXG4gICAgICBkdXJhdGlvblNlYzogTWF0aC5yb3VuZChmYWxsYmFja0VuZCAtIGZhbGxiYWNrU3RhcnQpLFxuICAgICAgaG9va0xpbmU6IHNlZ21lbnRzWzBdPy50ZXh0ID8/IFwiSW7DrWNpbyBkbyB2w61kZW9cIixcbiAgICAgIHRyYW5zY3JpcHRTbmlwcGV0OiBzZWdtZW50cy5zbGljZSgwLCA0KS5tYXAoKHNlZ21lbnQpID0+IHNlZ21lbnQudGV4dCkuam9pbihcIiBcIiksXG4gICAgICBoYXNodGFnczogW1wiI0NvcnRlc1ZpcmFpc1wiLCBcIiNTaG9ydHNcIiwgXCIjVGlrVG9rQnJhc2lsXCJdLFxuICAgICAgc3VnZ2VzdGVkRGVzY3JpcHRpb246IFwiVHJlY2hvIGluaWNpYWwgb3RpbWl6YWRvIHBhcmEgcmV0ZW7Dp8Ojby5cIixcbiAgICAgIHN1YnRpdGxlczogYnVpbGRGYWxsYmFja1N1YnRpdGxlcyhzZWdtZW50c1swXT8udGV4dCA/PyBcIlRyZWNobyBpbmljaWFsXCIsIGZhbGxiYWNrU3RhcnQpLFxuICAgICAgZmZtcGVnUGxhbjogW10sXG4gICAgICBwcmV2aWV3VXJsOiBcIlwiLFxuICAgICAgZG93bmxvYWRVcmw6IFwiXCIsXG4gICAgICByZW5kZXI6IHtcbiAgICAgICAgYXNwZWN0UmF0aW86IFwiOToxNlwiLFxuICAgICAgICB6b29tTW9kZTogXCJmYWNlLXNtYXJ0XCIsXG4gICAgICAgIGNhbWVyYVN0eWxlOiBcImR5bmFtaWMtY3V0XCIsXG4gICAgICAgIGNhcHRpb25zU3R5bGU6IFwicmVlbHMtYm9sZFwiLFxuICAgICAgICBoZWFkbGluZTogXCJDb3J0ZSBzdWdlcmlkb1wiLFxuICAgICAgICBzaG93UHJvZ3Jlc3NCYXI6IHRydWUsXG4gICAgICB9LFxuICAgICAgc2lnbmFsczoge1xuICAgICAgICBob29rOiA1NSxcbiAgICAgICAgY3VyaW9zaXR5OiAzNSxcbiAgICAgICAgY29udHJvdmVyc3k6IDEwLFxuICAgICAgICBodW1vcjogMTAsXG4gICAgICAgIHN0b3J5dGVsbGluZzogMzAsXG4gICAgICAgIHZhbHVlOiAzNSxcbiAgICAgICAgZW1vdGlvbjogNDAsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHNlbGVjdGVkLnNsaWNlKDAsIHJlcXVlc3RlZEN1dHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTZW9QYWNrKHNvdXJjZVRleHQ6IHN0cmluZywgY29udGV4dFRpdGxlPzogc3RyaW5nKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBzb3VyY2VUZXh0LnRyaW0oKS5zbGljZSgwLCAyNDApO1xuICBjb25zdCBiYXNlID0gY29udGV4dFRpdGxlPy50cmltKCkgfHwgXCJjb3J0ZSB2aXJhbFwiO1xuXG4gIGNvbnN0IHRpdGxlcyA9IFtcbiAgICBgJHtiYXNlfTogbyB0cmVjaG8gcXVlIHByZW5kZXUgZ2VyYWxgLFxuICAgIGBFc3NlIG1vbWVudG8gZGUgJHtiYXNlLnRvTG93ZXJDYXNlKCl9IGVzdMOhIGFic3VyZG9gLFxuICAgIGBQb3Vjb3Mgc2VndW5kb3MgZGUgJHtiYXNlLnRvTG93ZXJDYXNlKCl9IHF1ZSBnZXJhbSByZXBsYXlgLFxuICAgIGBPIG1lbGhvciBjb3J0ZSBkZSAke2Jhc2UudG9Mb3dlckNhc2UoKX0gcGFyYSBTaG9ydHNgLFxuICAgIGBTZSBsaWdhIG5lc3NlIHJlY29ydGUgZGUgJHtiYXNlLnRvTG93ZXJDYXNlKCl9IWAsXG4gIF07XG5cbiAgY29uc3QgZGVzY3JpcHRpb24gPSBg8J+OrCAke25vcm1hbGl6ZWR9XFxuXFxuRXNzZSBjb3J0ZSBmb2kgb3RpbWl6YWRvIHBhcmEgcmV0ZW7Dp8OjbywgaW1wYWN0byBlIGNvbXBhcnRpbGhhbWVudG8uXFxuXFxuI0NvcnRlc1ZpcmFpcyAjWW91VHViZVNob3J0cyAjVGlrVG9rQnJhc2lsICNSZWVsc0JyYXNpbCAjQ3JlYXRvckVjb25vbXlgO1xuXG4gIHJldHVybiB7XG4gICAgdGl0bGVzLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIGhhc2h0YWdzOiBbXG4gICAgICBcIiNDb3J0ZXNWaXJhaXNcIixcbiAgICAgIFwiI1lvdVR1YmVTaG9ydHNcIixcbiAgICAgIFwiI1Rpa1Rva0JyYXNpbFwiLFxuICAgICAgXCIjUmVlbHNCcmFzaWxcIixcbiAgICAgIFwiI0NvbnRldWRvRGlnaXRhbFwiLFxuICAgIF0sXG4gIH07XG59XG4iXSwibmFtZXMiOlsiSE9PS19URVJNUyIsIkNVUklPU0lUWV9URVJNUyIsIkNPTlRST1ZFUlNZX1RFUk1TIiwiSFVNT1JfVEVSTVMiLCJTVE9SWV9URVJNUyIsIlZBTFVFX1RFUk1TIiwiSElHSExJR0hUX1RFUk1TIiwiRU1PSklTIiwiSEFTSFRBR19CQU5LIiwiaG9vayIsImN1cmlvc2l0eSIsImNvbnRyb3ZlcnN5IiwiaHVtb3IiLCJzdG9yeXRlbGxpbmciLCJ2YWx1ZSIsIm5vcm1hbGl6ZSIsInRleHQiLCJyZXBsYWNlIiwidG9Mb3dlckNhc2UiLCJjb3VudFRlcm1zIiwidGVybXMiLCJyZWR1Y2UiLCJhY2MiLCJ0ZXJtIiwiaW5jbHVkZXMiLCJzY29yZVNlZ21lbnQiLCJzZWdtZW50IiwidG90YWxEdXJhdGlvbiIsIm5vcm1hbGl6ZWQiLCJpc0Vhcmx5SG9va1dpbmRvdyIsInN0YXJ0U2VjIiwidGltZUZhY3RvciIsIk1hdGgiLCJtYXgiLCJzaWduYWxzIiwibWluIiwiZW5lcmd5IiwiZW1vdGlvbiIsInJvdW5kIiwid2VpZ2h0ZWQiLCJzY29yZSIsImFuZ2xlRnJvbVNpZ25hbHMiLCJwYWlycyIsInNvcnQiLCJhIiwiYiIsImNsaXBUaXRsZSIsImFuZ2xlIiwiYmFzZVRleHQiLCJpbmRleCIsInNlbnRlbmNlIiwidGVtcGxhdGVzIiwiZmFsbGJhY2siLCJsZW5ndGgiLCJzbGljZSIsImJ1aWxkU3VidGl0bGVzRnJvbVNlZ21lbnRzIiwid2luZG93U2VnbWVudHMiLCJ0b2tlbnMiLCJ3b3JkcyIsInNwbGl0IiwiZmlsdGVyIiwiQm9vbGVhbiIsInNlZ21lbnREdXJhdGlvbiIsImVuZFNlYyIsInN0ZXAiLCJ3b3JkIiwiaGlnaGxpZ2h0Iiwic29tZSIsImVtb2ppIiwidW5kZWZpbmVkIiwicHVzaCIsInRpbWUiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwiYnVpbGRGYWxsYmFja1N1YnRpdGxlcyIsIm1hcCIsInJhbmdlT3ZlcmxhcCIsImFTdGFydCIsImFFbmQiLCJiU3RhcnQiLCJiRW5kIiwiY2hvb3NlSGFzaHRhZ3MiLCJleHRyYVRhZ3MiLCJmcm9tQW5nbGUiLCJhbHdheXMiLCJkeW5hbWljIiwidGFnIiwiQXJyYXkiLCJmcm9tIiwiU2V0IiwiZ2VuZXJhdGVWaXJhbEN1dHMiLCJwYXJhbXMiLCJ2aWRlb1RpdGxlIiwic2VnbWVudHMiLCJkdXJhdGlvblNlYyIsInJlcXVlc3RlZEN1dHMiLCJzY29yZWQiLCJzZWxlY3RlZCIsImNhbmRpZGF0ZSIsInRhcmdldER1cmF0aW9uIiwiZHVyYXRpb24iLCJvdmVybGFwIiwiY2xpcCIsImFtb3VudCIsInNuaXBwZXQiLCJqb2luIiwidHJpbSIsImhhc2h0YWdzIiwidGFncyIsInRpdGxlIiwic3VidGl0bGVzIiwiaWQiLCJob29rTGluZSIsInRyYW5zY3JpcHRTbmlwcGV0Iiwic3VnZ2VzdGVkRGVzY3JpcHRpb24iLCJmZm1wZWdQbGFuIiwicHJldmlld1VybCIsImRvd25sb2FkVXJsIiwicmVuZGVyIiwiYXNwZWN0UmF0aW8iLCJ6b29tTW9kZSIsImNhbWVyYVN0eWxlIiwiY2FwdGlvbnNTdHlsZSIsImhlYWRsaW5lIiwic2hvd1Byb2dyZXNzQmFyIiwiZmFsbGJhY2tTdGFydCIsImZhbGxiYWNrRW5kIiwiZ2VuZXJhdGVTZW9QYWNrIiwic291cmNlVGV4dCIsImNvbnRleHRUaXRsZSIsImJhc2UiLCJ0aXRsZXMiLCJkZXNjcmlwdGlvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/viral.ts\n");

/***/ }),

/***/ "(rsc)/./lib/youtube.ts":
/*!************************!*\
  !*** ./lib/youtube.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseYouTubeUrl: () => (/* binding */ parseYouTubeUrl)\n/* harmony export */ });\nconst VIDEO_ID_REGEX = /^[A-Za-z0-9_-]{11}$/;\nfunction isValidVideoId(value) {\n    return Boolean(value && VIDEO_ID_REGEX.test(value));\n}\nfunction parseYouTubeUrl(rawUrl) {\n    try {\n        const url = new URL(rawUrl.trim());\n        const host = url.hostname.replace(/^www\\./, \"\").toLowerCase();\n        const isYouTubeHost = [\n            \"youtube.com\",\n            \"m.youtube.com\",\n            \"music.youtube.com\",\n            \"youtu.be\",\n            \"youtube-nocookie.com\"\n        ].includes(host);\n        if (!isYouTubeHost) {\n            return null;\n        }\n        let videoId;\n        if (host === \"youtu.be\") {\n            videoId = url.pathname.split(\"/\").filter(Boolean)[0];\n        } else {\n            videoId = url.searchParams.get(\"v\") ?? url.pathname.match(/\\/(shorts|embed|live)\\/([A-Za-z0-9_-]{11})/)?.[2] ?? undefined;\n        }\n        if (!isValidVideoId(videoId)) {\n            return null;\n        }\n        return {\n            videoId,\n            canonicalUrl: `https://www.youtube.com/watch?v=${videoId}`\n        };\n    } catch  {\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIveW91dHViZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBS0EsTUFBTUEsaUJBQWlCO0FBRXZCLFNBQVNDLGVBQWVDLEtBQWdDO0lBQ3RELE9BQU9DLFFBQVFELFNBQVNGLGVBQWVJLElBQUksQ0FBQ0Y7QUFDOUM7QUFFTyxTQUFTRyxnQkFBZ0JDLE1BQWM7SUFDNUMsSUFBSTtRQUNGLE1BQU1DLE1BQU0sSUFBSUMsSUFBSUYsT0FBT0csSUFBSTtRQUMvQixNQUFNQyxPQUFPSCxJQUFJSSxRQUFRLENBQUNDLE9BQU8sQ0FBQyxVQUFVLElBQUlDLFdBQVc7UUFFM0QsTUFBTUMsZ0JBQWdCO1lBQ3BCO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7U0FDRCxDQUFDQyxRQUFRLENBQUNMO1FBRVgsSUFBSSxDQUFDSSxlQUFlO1lBQ2xCLE9BQU87UUFDVDtRQUVBLElBQUlFO1FBRUosSUFBSU4sU0FBUyxZQUFZO1lBQ3ZCTSxVQUFVVCxJQUFJVSxRQUFRLENBQUNDLEtBQUssQ0FBQyxLQUFLQyxNQUFNLENBQUNoQixRQUFRLENBQUMsRUFBRTtRQUN0RCxPQUFPO1lBQ0xhLFVBQ0VULElBQUlhLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLFFBQ3JCZCxJQUFJVSxRQUFRLENBQUNLLEtBQUssQ0FBQywrQ0FBK0MsQ0FBQyxFQUFFLElBQ3JFQztRQUNKO1FBRUEsSUFBSSxDQUFDdEIsZUFBZWUsVUFBVTtZQUM1QixPQUFPO1FBQ1Q7UUFFQSxPQUFPO1lBQ0xBO1lBQ0FRLGNBQWMsQ0FBQyxnQ0FBZ0MsRUFBRVIsU0FBUztRQUM1RDtJQUNGLEVBQUUsT0FBTTtRQUNOLE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvYWxtZWlkYWdhYnJpZWwvRG9jdW1lbnRzL0NBTkEvbGliL3lvdXR1YmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIFBhcnNlZFlvdVR1YmVVcmwge1xuICB2aWRlb0lkOiBzdHJpbmc7XG4gIGNhbm9uaWNhbFVybDogc3RyaW5nO1xufVxuXG5jb25zdCBWSURFT19JRF9SRUdFWCA9IC9eW0EtWmEtejAtOV8tXXsxMX0kLztcblxuZnVuY3Rpb24gaXNWYWxpZFZpZGVvSWQodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCB8IG51bGwpOiB2YWx1ZSBpcyBzdHJpbmcge1xuICByZXR1cm4gQm9vbGVhbih2YWx1ZSAmJiBWSURFT19JRF9SRUdFWC50ZXN0KHZhbHVlKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVlvdVR1YmVVcmwocmF3VXJsOiBzdHJpbmcpOiBQYXJzZWRZb3VUdWJlVXJsIHwgbnVsbCB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChyYXdVcmwudHJpbSgpKTtcbiAgICBjb25zdCBob3N0ID0gdXJsLmhvc3RuYW1lLnJlcGxhY2UoL153d3dcXC4vLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgY29uc3QgaXNZb3VUdWJlSG9zdCA9IFtcbiAgICAgIFwieW91dHViZS5jb21cIixcbiAgICAgIFwibS55b3V0dWJlLmNvbVwiLFxuICAgICAgXCJtdXNpYy55b3V0dWJlLmNvbVwiLFxuICAgICAgXCJ5b3V0dS5iZVwiLFxuICAgICAgXCJ5b3V0dWJlLW5vY29va2llLmNvbVwiLFxuICAgIF0uaW5jbHVkZXMoaG9zdCk7XG5cbiAgICBpZiAoIWlzWW91VHViZUhvc3QpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCB2aWRlb0lkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAoaG9zdCA9PT0gXCJ5b3V0dS5iZVwiKSB7XG4gICAgICB2aWRlb0lkID0gdXJsLnBhdGhuYW1lLnNwbGl0KFwiL1wiKS5maWx0ZXIoQm9vbGVhbilbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpZGVvSWQgPVxuICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLmdldChcInZcIikgPz9cbiAgICAgICAgdXJsLnBhdGhuYW1lLm1hdGNoKC9cXC8oc2hvcnRzfGVtYmVkfGxpdmUpXFwvKFtBLVphLXowLTlfLV17MTF9KS8pPy5bMl0gPz9cbiAgICAgICAgdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmICghaXNWYWxpZFZpZGVvSWQodmlkZW9JZCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2aWRlb0lkLFxuICAgICAgY2Fub25pY2FsVXJsOiBgaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0ke3ZpZGVvSWR9YCxcbiAgICB9O1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlZJREVPX0lEX1JFR0VYIiwiaXNWYWxpZFZpZGVvSWQiLCJ2YWx1ZSIsIkJvb2xlYW4iLCJ0ZXN0IiwicGFyc2VZb3VUdWJlVXJsIiwicmF3VXJsIiwidXJsIiwiVVJMIiwidHJpbSIsImhvc3QiLCJob3N0bmFtZSIsInJlcGxhY2UiLCJ0b0xvd2VyQ2FzZSIsImlzWW91VHViZUhvc3QiLCJpbmNsdWRlcyIsInZpZGVvSWQiLCJwYXRobmFtZSIsInNwbGl0IiwiZmlsdGVyIiwic2VhcmNoUGFyYW1zIiwiZ2V0IiwibWF0Y2giLCJ1bmRlZmluZWQiLCJjYW5vbmljYWxVcmwiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/youtube.ts\n");

/***/ }),

/***/ "(rsc)/./lib/ytdlp.ts":
/*!**********************!*\
  !*** ./lib/ytdlp.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   downloadAutoSubtitlesVtt: () => (/* binding */ downloadAutoSubtitlesVtt),\n/* harmony export */   downloadVideoFromYoutube: () => (/* binding */ downloadVideoFromYoutube),\n/* harmony export */   fetchVideoInfo: () => (/* binding */ fetchVideoInfo)\n/* harmony export */ });\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:child_process */ \"node:child_process\");\n/* harmony import */ var node_child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:util */ \"node:util\");\n/* harmony import */ var node_util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_util__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_storage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/storage */ \"(rsc)/./lib/storage.ts\");\n\n\n\n\nconst execFileAsync = (0,node_util__WEBPACK_IMPORTED_MODULE_2__.promisify)(node_child_process__WEBPACK_IMPORTED_MODULE_0__.execFile);\nconst PYTHON_ARGS_PREFIX = [\n    \"-W\",\n    \"ignore\",\n    \"-m\",\n    \"yt_dlp\"\n];\nconst YOUTUBE_EXTRACTOR_ARGS = [\n    \"--extractor-args\",\n    \"youtube:player_client=android\"\n];\nfunction parseJsonFromOutput(raw) {\n    const firstBrace = raw.indexOf(\"{\");\n    if (firstBrace < 0) {\n        throw new Error(\"Não foi possível ler os metadados retornados pelo yt-dlp.\");\n    }\n    try {\n        return JSON.parse(raw.slice(firstBrace));\n    } catch  {\n        throw new Error(\"Falha ao interpretar metadados JSON do yt-dlp.\");\n    }\n}\nasync function runYtDlp(args, workingDirectory) {\n    try {\n        const result = await execFileAsync(\"python3\", [\n            ...PYTHON_ARGS_PREFIX,\n            ...YOUTUBE_EXTRACTOR_ARGS,\n            ...args\n        ], {\n            cwd: workingDirectory,\n            maxBuffer: 32 * 1024 * 1024\n        });\n        return {\n            stdout: result.stdout,\n            stderr: result.stderr\n        };\n    } catch (error) {\n        const message = error instanceof Error ? error.message : \"Erro desconhecido no yt-dlp.\";\n        throw new Error(`yt-dlp falhou: ${message}`);\n    }\n}\nasync function fetchVideoInfo(url, jobId) {\n    const { jobDir } = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.getJobStoragePaths)(jobId);\n    const { stdout } = await runYtDlp([\n        \"--dump-single-json\",\n        \"--skip-download\",\n        \"--no-playlist\",\n        \"--no-warnings\",\n        url\n    ], jobDir);\n    return parseJsonFromOutput(stdout);\n}\nasync function downloadVideoFromYoutube(params) {\n    const { jobId, url, videoId, log } = params;\n    const paths = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.getJobStoragePaths)(jobId);\n    log?.(`Iniciando download do vídeo ${videoId} com yt-dlp`);\n    const info = await fetchVideoInfo(url, jobId);\n    const downloadArgs = [\n        \"--no-playlist\",\n        \"--no-warnings\",\n        \"--newline\",\n        \"-f\",\n        \"18/best[ext=mp4]/best\",\n        \"--output\",\n        paths.sourceTemplate,\n        \"--print\",\n        \"after_move:filepath\",\n        url\n    ];\n    const { stdout } = await runYtDlp(downloadArgs, paths.jobDir);\n    let sourceVideoPath = stdout.split(/\\r?\\n/).map((line)=>line.trim()).filter(Boolean).find((line)=>line.includes(`${(node_path__WEBPACK_IMPORTED_MODULE_1___default().sep)}source.`)) ?? null;\n    if (!sourceVideoPath) {\n        sourceVideoPath = await (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.findDownloadedSourceVideo)(jobId);\n    }\n    if (!sourceVideoPath) {\n        throw new Error(\"O vídeo foi solicitado ao yt-dlp, mas nenhum arquivo local foi encontrado.\");\n    }\n    log?.(`Download concluído em ${sourceVideoPath}`);\n    const durationSec = Number(info.duration ?? 0);\n    const title = info.title?.trim() || `Vídeo ${videoId}`;\n    const channelName = info.uploader?.trim() || \"Canal YouTube\";\n    const thumbnailUrl = info.thumbnail || `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;\n    const canonicalUrl = info.webpage_url || `https://www.youtube.com/watch?v=${videoId}`;\n    if (!Number.isFinite(durationSec) || durationSec < 5) {\n        throw new Error(\"Não foi possível identificar a duração do vídeo para gerar cortes.\");\n    }\n    return {\n        sourceVideoPath,\n        video: {\n            videoId,\n            canonicalUrl,\n            title,\n            channelName,\n            durationSec,\n            thumbnailUrl\n        },\n        keywords: Array.isArray(info.tags) ? info.tags.slice(0, 20) : [],\n        description: info.description?.slice(0, 2000) || \"\"\n    };\n}\nasync function downloadAutoSubtitlesVtt(params) {\n    const { jobId, url, log } = params;\n    const paths = (0,_lib_storage__WEBPACK_IMPORTED_MODULE_3__.getJobStoragePaths)(jobId);\n    const args = [\n        \"--skip-download\",\n        \"--no-warnings\",\n        \"--ignore-errors\",\n        \"--no-playlist\",\n        \"--write-auto-subs\",\n        \"--sub-langs\",\n        \"pt.*,en.*,es.*\",\n        \"--sub-format\",\n        \"vtt\",\n        \"--output\",\n        paths.sourceTemplate,\n        url\n    ];\n    try {\n        await runYtDlp(args, paths.jobDir);\n    } catch (error) {\n        const message = error instanceof Error ? error.message : \"Falha desconhecida ao baixar legenda.\";\n        log?.(`Legendas automáticas indisponíveis no momento (${message}). Seguindo com fallback por energia.`);\n        return null;\n    }\n    const { readdir } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! node:fs/promises */ \"node:fs/promises\", 23));\n    const entries = await readdir(paths.jobDir);\n    const subtitleCandidates = entries.filter((entry)=>entry.startsWith(\"source.\") && entry.endsWith(\".vtt\")).sort((a, b)=>{\n        const rank = (name)=>{\n            if (name.includes(\".pt\")) return 0;\n            if (name.includes(\".en\")) return 1;\n            return 2;\n        };\n        return rank(a) - rank(b);\n    });\n    if (subtitleCandidates.length === 0) {\n        log?.(\"Nenhuma legenda automática disponível no YouTube para este vídeo\");\n        return null;\n    }\n    const subtitlePath = node_path__WEBPACK_IMPORTED_MODULE_1___default().join(paths.jobDir, subtitleCandidates[0]);\n    log?.(`Legenda automática encontrada: ${subtitleCandidates[0]}`);\n    return subtitlePath;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TXVDLHFCQUFxQkQsUUFDeEJ4QixNQUFNLENBQUMsQ0FBQzBCLFFBQVVBLE1BQU1DLFVBQVUsQ0FBQyxjQUFjRCxNQUFNRSxRQUFRLENBQUMsU0FDaEVDLElBQUksQ0FBQyxDQUFDQyxHQUFHQztRQUNSLE1BQU1DLE9BQU8sQ0FBQ0M7WUFDWixJQUFJQSxLQUFLOUIsUUFBUSxDQUFDLFFBQVEsT0FBTztZQUNqQyxJQUFJOEIsS0FBSzlCLFFBQVEsQ0FBQyxRQUFRLE9BQU87WUFDakMsT0FBTztRQUNUO1FBQ0EsT0FBTzZCLEtBQUtGLEtBQUtFLEtBQUtEO0lBQ3hCO0lBRUYsSUFBSU4sbUJBQW1CUyxNQUFNLEtBQUssR0FBRztRQUNuQzVDLE1BQU07UUFDTixPQUFPO0lBQ1Q7SUFFQSxNQUFNNkMsZUFBZTdFLHFEQUFTLENBQUNpQyxNQUFNTCxNQUFNLEVBQUV1QyxrQkFBa0IsQ0FBQyxFQUFFO0lBQ2xFbkMsTUFBTSxDQUFDLCtCQUErQixFQUFFbUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFO0lBRS9ELE9BQU9VO0FBQ1QiLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbG1laWRhZ2FicmllbC9Eb2N1bWVudHMvQ0FOQS9saWIveXRkbHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlY0ZpbGUgfSBmcm9tIFwibm9kZTpjaGlsZF9wcm9jZXNzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tIFwibm9kZTp1dGlsXCI7XG5cbmltcG9ydCB7IGZpbmREb3dubG9hZGVkU291cmNlVmlkZW8sIGdldEpvYlN0b3JhZ2VQYXRocyB9IGZyb20gXCJAL2xpYi9zdG9yYWdlXCI7XG5pbXBvcnQgeyBZb3VUdWJlVmlkZW9NZXRhIH0gZnJvbSBcIkAvbGliL3R5cGVzXCI7XG5cbmNvbnN0IGV4ZWNGaWxlQXN5bmMgPSBwcm9taXNpZnkoZXhlY0ZpbGUpO1xuXG5jb25zdCBQWVRIT05fQVJHU19QUkVGSVggPSBbXCItV1wiLCBcImlnbm9yZVwiLCBcIi1tXCIsIFwieXRfZGxwXCJdO1xuY29uc3QgWU9VVFVCRV9FWFRSQUNUT1JfQVJHUyA9IFtcIi0tZXh0cmFjdG9yLWFyZ3NcIiwgXCJ5b3V0dWJlOnBsYXllcl9jbGllbnQ9YW5kcm9pZFwiXTtcblxuaW50ZXJmYWNlIFl0RGxwSW5mbyB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBkdXJhdGlvbj86IG51bWJlcjtcbiAgdXBsb2FkZXI/OiBzdHJpbmc7XG4gIHRodW1ibmFpbD86IHN0cmluZztcbiAgd2VicGFnZV91cmw/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICB0YWdzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG93bmxvYWRlZFZpZGVvU291cmNlIHtcbiAgdmlkZW86IFlvdVR1YmVWaWRlb01ldGE7XG4gIHNvdXJjZVZpZGVvUGF0aDogc3RyaW5nO1xuICBrZXl3b3Jkczogc3RyaW5nW107XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHBhcnNlSnNvbkZyb21PdXRwdXQ8VD4ocmF3OiBzdHJpbmcpOiBUIHtcbiAgY29uc3QgZmlyc3RCcmFjZSA9IHJhdy5pbmRleE9mKFwie1wiKTtcbiAgaWYgKGZpcnN0QnJhY2UgPCAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTsOjbyBmb2kgcG9zc8OtdmVsIGxlciBvcyBtZXRhZGFkb3MgcmV0b3JuYWRvcyBwZWxvIHl0LWRscC5cIik7XG4gIH1cblxuICB0cnkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJhdy5zbGljZShmaXJzdEJyYWNlKSkgYXMgVDtcbiAgfSBjYXRjaCB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRmFsaGEgYW8gaW50ZXJwcmV0YXIgbWV0YWRhZG9zIEpTT04gZG8geXQtZGxwLlwiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBydW5ZdERscChhcmdzOiBzdHJpbmdbXSwgd29ya2luZ0RpcmVjdG9yeTogc3RyaW5nKTogUHJvbWlzZTx7IHN0ZG91dDogc3RyaW5nOyBzdGRlcnI6IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY0ZpbGVBc3luYyhcbiAgICAgIFwicHl0aG9uM1wiLFxuICAgICAgWy4uLlBZVEhPTl9BUkdTX1BSRUZJWCwgLi4uWU9VVFVCRV9FWFRSQUNUT1JfQVJHUywgLi4uYXJnc10sXG4gICAgICB7XG4gICAgICBjd2Q6IHdvcmtpbmdEaXJlY3RvcnksXG4gICAgICBtYXhCdWZmZXI6IDMyICogMTAyNCAqIDEwMjQsXG4gICAgICB9XG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGRvdXQ6IHJlc3VsdC5zdGRvdXQsXG4gICAgICBzdGRlcnI6IHJlc3VsdC5zdGRlcnIsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIkVycm8gZGVzY29uaGVjaWRvIG5vIHl0LWRscC5cIjtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYHl0LWRscCBmYWxob3U6ICR7bWVzc2FnZX1gKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hWaWRlb0luZm8odXJsOiBzdHJpbmcsIGpvYklkOiBzdHJpbmcpOiBQcm9taXNlPFl0RGxwSW5mbz4ge1xuICBjb25zdCB7IGpvYkRpciB9ID0gZ2V0Sm9iU3RvcmFnZVBhdGhzKGpvYklkKTtcbiAgY29uc3QgeyBzdGRvdXQgfSA9IGF3YWl0IHJ1bll0RGxwKFxuICAgIFtcIi0tZHVtcC1zaW5nbGUtanNvblwiLCBcIi0tc2tpcC1kb3dubG9hZFwiLCBcIi0tbm8tcGxheWxpc3RcIiwgXCItLW5vLXdhcm5pbmdzXCIsIHVybF0sXG4gICAgam9iRGlyXG4gICk7XG5cbiAgcmV0dXJuIHBhcnNlSnNvbkZyb21PdXRwdXQ8WXREbHBJbmZvPihzdGRvdXQpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZG93bmxvYWRWaWRlb0Zyb21Zb3V0dWJlKHBhcmFtczoge1xuICBqb2JJZDogc3RyaW5nO1xuICB1cmw6IHN0cmluZztcbiAgdmlkZW9JZDogc3RyaW5nO1xuICBsb2c/OiAobWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkO1xufSk6IFByb21pc2U8RG93bmxvYWRlZFZpZGVvU291cmNlPiB7XG4gIGNvbnN0IHsgam9iSWQsIHVybCwgdmlkZW9JZCwgbG9nIH0gPSBwYXJhbXM7XG4gIGNvbnN0IHBhdGhzID0gZ2V0Sm9iU3RvcmFnZVBhdGhzKGpvYklkKTtcblxuICBsb2c/LihgSW5pY2lhbmRvIGRvd25sb2FkIGRvIHbDrWRlbyAke3ZpZGVvSWR9IGNvbSB5dC1kbHBgKTtcblxuICBjb25zdCBpbmZvID0gYXdhaXQgZmV0Y2hWaWRlb0luZm8odXJsLCBqb2JJZCk7XG5cbiAgY29uc3QgZG93bmxvYWRBcmdzID0gW1xuICAgIFwiLS1uby1wbGF5bGlzdFwiLFxuICAgIFwiLS1uby13YXJuaW5nc1wiLFxuICAgIFwiLS1uZXdsaW5lXCIsXG4gICAgXCItZlwiLFxuICAgIFwiMTgvYmVzdFtleHQ9bXA0XS9iZXN0XCIsXG4gICAgXCItLW91dHB1dFwiLFxuICAgIHBhdGhzLnNvdXJjZVRlbXBsYXRlLFxuICAgIFwiLS1wcmludFwiLFxuICAgIFwiYWZ0ZXJfbW92ZTpmaWxlcGF0aFwiLFxuICAgIHVybCxcbiAgXTtcblxuICBjb25zdCB7IHN0ZG91dCB9ID0gYXdhaXQgcnVuWXREbHAoZG93bmxvYWRBcmdzLCBwYXRocy5qb2JEaXIpO1xuXG4gIGxldCBzb3VyY2VWaWRlb1BhdGg6IHN0cmluZyB8IG51bGwgPSBzdGRvdXRcbiAgICAuc3BsaXQoL1xccj9cXG4vKVxuICAgIC5tYXAoKGxpbmUpID0+IGxpbmUudHJpbSgpKVxuICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAuZmluZCgobGluZSkgPT4gbGluZS5pbmNsdWRlcyhgJHtwYXRoLnNlcH1zb3VyY2UuYCkpID8/IG51bGw7XG5cbiAgaWYgKCFzb3VyY2VWaWRlb1BhdGgpIHtcbiAgICBzb3VyY2VWaWRlb1BhdGggPSBhd2FpdCBmaW5kRG93bmxvYWRlZFNvdXJjZVZpZGVvKGpvYklkKTtcbiAgfVxuXG4gIGlmICghc291cmNlVmlkZW9QYXRoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTyB2w61kZW8gZm9pIHNvbGljaXRhZG8gYW8geXQtZGxwLCBtYXMgbmVuaHVtIGFycXVpdm8gbG9jYWwgZm9pIGVuY29udHJhZG8uXCIpO1xuICB9XG5cbiAgbG9nPy4oYERvd25sb2FkIGNvbmNsdcOtZG8gZW0gJHtzb3VyY2VWaWRlb1BhdGh9YCk7XG5cbiAgY29uc3QgZHVyYXRpb25TZWMgPSBOdW1iZXIoaW5mby5kdXJhdGlvbiA/PyAwKTtcbiAgY29uc3QgdGl0bGUgPSBpbmZvLnRpdGxlPy50cmltKCkgfHwgYFbDrWRlbyAke3ZpZGVvSWR9YDtcbiAgY29uc3QgY2hhbm5lbE5hbWUgPSBpbmZvLnVwbG9hZGVyPy50cmltKCkgfHwgXCJDYW5hbCBZb3VUdWJlXCI7XG4gIGNvbnN0IHRodW1ibmFpbFVybCA9IGluZm8udGh1bWJuYWlsIHx8IGBodHRwczovL2kueXRpbWcuY29tL3ZpLyR7dmlkZW9JZH0vaHFkZWZhdWx0LmpwZ2A7XG4gIGNvbnN0IGNhbm9uaWNhbFVybCA9IGluZm8ud2VicGFnZV91cmwgfHwgYGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JHt2aWRlb0lkfWA7XG5cbiAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoZHVyYXRpb25TZWMpIHx8IGR1cmF0aW9uU2VjIDwgNSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk7Do28gZm9pIHBvc3PDrXZlbCBpZGVudGlmaWNhciBhIGR1cmHDp8OjbyBkbyB2w61kZW8gcGFyYSBnZXJhciBjb3J0ZXMuXCIpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzb3VyY2VWaWRlb1BhdGgsXG4gICAgdmlkZW86IHtcbiAgICAgIHZpZGVvSWQsXG4gICAgICBjYW5vbmljYWxVcmwsXG4gICAgICB0aXRsZSxcbiAgICAgIGNoYW5uZWxOYW1lLFxuICAgICAgZHVyYXRpb25TZWMsXG4gICAgICB0aHVtYm5haWxVcmwsXG4gICAgfSxcbiAgICBrZXl3b3JkczogQXJyYXkuaXNBcnJheShpbmZvLnRhZ3MpID8gaW5mby50YWdzLnNsaWNlKDAsIDIwKSA6IFtdLFxuICAgIGRlc2NyaXB0aW9uOiBpbmZvLmRlc2NyaXB0aW9uPy5zbGljZSgwLCAyMDAwKSB8fCBcIlwiLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZG93bmxvYWRBdXRvU3VidGl0bGVzVnR0KHBhcmFtczoge1xuICBqb2JJZDogc3RyaW5nO1xuICB1cmw6IHN0cmluZztcbiAgbG9nPzogKG1lc3NhZ2U6IHN0cmluZykgPT4gdm9pZDtcbn0pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgY29uc3QgeyBqb2JJZCwgdXJsLCBsb2cgfSA9IHBhcmFtcztcbiAgY29uc3QgcGF0aHMgPSBnZXRKb2JTdG9yYWdlUGF0aHMoam9iSWQpO1xuXG4gIGNvbnN0IGFyZ3MgPSBbXG4gICAgXCItLXNraXAtZG93bmxvYWRcIixcbiAgICBcIi0tbm8td2FybmluZ3NcIixcbiAgICBcIi0taWdub3JlLWVycm9yc1wiLFxuICAgIFwiLS1uby1wbGF5bGlzdFwiLFxuICAgIFwiLS13cml0ZS1hdXRvLXN1YnNcIixcbiAgICBcIi0tc3ViLWxhbmdzXCIsXG4gICAgXCJwdC4qLGVuLiosZXMuKlwiLFxuICAgIFwiLS1zdWItZm9ybWF0XCIsXG4gICAgXCJ2dHRcIixcbiAgICBcIi0tb3V0cHV0XCIsXG4gICAgcGF0aHMuc291cmNlVGVtcGxhdGUsXG4gICAgdXJsLFxuICBdO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgcnVuWXREbHAoYXJncywgcGF0aHMuam9iRGlyKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIkZhbGhhIGRlc2NvbmhlY2lkYSBhbyBiYWl4YXIgbGVnZW5kYS5cIjtcbiAgICBsb2c/LihgTGVnZW5kYXMgYXV0b23DoXRpY2FzIGluZGlzcG9uw612ZWlzIG5vIG1vbWVudG8gKCR7bWVzc2FnZX0pLiBTZWd1aW5kbyBjb20gZmFsbGJhY2sgcG9yIGVuZXJnaWEuYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCB7IHJlYWRkaXIgfSA9IGF3YWl0IGltcG9ydChcIm5vZGU6ZnMvcHJvbWlzZXNcIik7XG4gIGNvbnN0IGVudHJpZXMgPSBhd2FpdCByZWFkZGlyKHBhdGhzLmpvYkRpcik7XG5cbiAgY29uc3Qgc3VidGl0bGVDYW5kaWRhdGVzID0gZW50cmllc1xuICAgIC5maWx0ZXIoKGVudHJ5KSA9PiBlbnRyeS5zdGFydHNXaXRoKFwic291cmNlLlwiKSAmJiBlbnRyeS5lbmRzV2l0aChcIi52dHRcIikpXG4gICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IHJhbmsgPSAobmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmIChuYW1lLmluY2x1ZGVzKFwiLnB0XCIpKSByZXR1cm4gMDtcbiAgICAgICAgaWYgKG5hbWUuaW5jbHVkZXMoXCIuZW5cIikpIHJldHVybiAxO1xuICAgICAgICByZXR1cm4gMjtcbiAgICAgIH07XG4gICAgICByZXR1cm4gcmFuayhhKSAtIHJhbmsoYik7XG4gICAgfSk7XG5cbiAgaWYgKHN1YnRpdGxlQ2FuZGlkYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2c/LihcIk5lbmh1bWEgbGVnZW5kYSBhdXRvbcOhdGljYSBkaXNwb27DrXZlbCBubyBZb3VUdWJlIHBhcmEgZXN0ZSB2w61kZW9cIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBzdWJ0aXRsZVBhdGggPSBwYXRoLmpvaW4ocGF0aHMuam9iRGlyLCBzdWJ0aXRsZUNhbmRpZGF0ZXNbMF0pO1xuICBsb2c/LihgTGVnZW5kYSBhdXRvbcOhdGljYSBlbmNvbnRyYWRhOiAke3N1YnRpdGxlQ2FuZGlkYXRlc1swXX1gKTtcblxuICByZXR1cm4gc3VidGl0bGVQYXRoO1xufVxuIl0sIm5hbWVzIjpbImV4ZWNGaWxlIiwicGF0aCIsInByb21pc2lmeSIsImZpbmREb3dubG9hZGVkU291cmNlVmlkZW8iLCJnZXRKb2JTdG9yYWdlUGF0aHMiLCJleGVjRmlsZUFzeW5jIiwiUFlUSE9OX0FSR1NfUFJFRklYIiwiWU9VVFVCRV9FWFRSQUNUT1JfQVJHUyIsInBhcnNlSnNvbkZyb21PdXRwdXQiLCJyYXciLCJmaXJzdEJyYWNlIiwiaW5kZXhPZiIsIkVycm9yIiwiSlNPTiIsInBhcnNlIiwic2xpY2UiLCJydW5ZdERscCIsImFyZ3MiLCJ3b3JraW5nRGlyZWN0b3J5IiwicmVzdWx0IiwiY3dkIiwibWF4QnVmZmVyIiwic3Rkb3V0Iiwic3RkZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwiZmV0Y2hWaWRlb0luZm8iLCJ1cmwiLCJqb2JJZCIsImpvYkRpciIsImRvd25sb2FkVmlkZW9Gcm9tWW91dHViZSIsInBhcmFtcyIsInZpZGVvSWQiLCJsb2ciLCJwYXRocyIsImluZm8iLCJkb3dubG9hZEFyZ3MiLCJzb3VyY2VUZW1wbGF0ZSIsInNvdXJjZVZpZGVvUGF0aCIsInNwbGl0IiwibWFwIiwibGluZSIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwiZmluZCIsImluY2x1ZGVzIiwic2VwIiwiZHVyYXRpb25TZWMiLCJOdW1iZXIiLCJkdXJhdGlvbiIsInRpdGxlIiwiY2hhbm5lbE5hbWUiLCJ1cGxvYWRlciIsInRodW1ibmFpbFVybCIsInRodW1ibmFpbCIsImNhbm9uaWNhbFVybCIsIndlYnBhZ2VfdXJsIiwiaXNGaW5pdGUiLCJ2aWRlbyIsImtleXdvcmRzIiwiQXJyYXkiLCJpc0FycmF5IiwidGFncyIsImRlc2NyaXB0aW9uIiwiZG93bmxvYWRBdXRvU3VidGl0bGVzVnR0IiwicmVhZGRpciIsImVudHJpZXMiLCJzdWJ0aXRsZUNhbmRpZGF0ZXMiLCJlbnRyeSIsInN0YXJ0c1dpdGgiLCJlbmRzV2l0aCIsInNvcnQiLCJhIiwiYiIsInJhbmsiLCJuYW1lIiwibGVuZ3RoIiwic3VidGl0bGVQYXRoIiwiam9pbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/ytdlp.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&page=%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjobs%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&page=%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjobs%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_almeidagabriel_Documents_CANA_app_api_jobs_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/jobs/[id]/route.ts */ \"(rsc)/./app/api/jobs/[id]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/jobs/[id]/route\",\n        pathname: \"/api/jobs/[id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/jobs/[id]/route\"\n    },\n    resolvedPagePath: \"/Users/almeidagabriel/Documents/CANA/app/api/jobs/[id]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_almeidagabriel_Documents_CANA_app_api_jobs_id_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZqb2JzJTJGJTVCaWQlNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmpvYnMlMkYlNUJpZCU1RCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmpvYnMlMkYlNUJpZCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsbWVpZGFnYWJyaWVsJTJGRG9jdW1lbnRzJTJGQ0FOQSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZhbG1laWRhZ2FicmllbCUyRkRvY3VtZW50cyUyRkNBTkEmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ2U7QUFDNUY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9hbG1laWRhZ2FicmllbC9Eb2N1bWVudHMvQ0FOQS9hcHAvYXBpL2pvYnMvW2lkXS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvam9icy9baWRdL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvam9icy9baWRdXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9qb2JzL1tpZF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYWxtZWlkYWdhYnJpZWwvRG9jdW1lbnRzL0NBTkEvYXBwL2FwaS9qb2JzL1tpZF0vcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&page=%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjobs%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:child_process":
/*!*************************************!*\
  !*** external "node:child_process" ***!
  \*************************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:child_process");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/ffmpeg-static","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&page=%2Fapi%2Fjobs%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fjobs%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falmeidagabriel%2FDocuments%2FCANA&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();